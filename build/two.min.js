(function(){function q(n,b,d){if(n===b)return 0!==n||1/n==1/b;if(null==n||null==b)return n===b;n._chain&&(n=n._wrapped);b._chain&&(b=b._wrapped);if(n.isEqual&&e.isFunction(n.isEqual))return n.isEqual(b);if(b.isEqual&&e.isFunction(b.isEqual))return b.isEqual(n);var c=a.call(n);if(c!=a.call(b))return!1;switch(c){case "[object String]":return n==String(b);case "[object Number]":return n!=+n?b!=+b:0==n?1/n==1/b:n==+b;case "[object Date]":case "[object Boolean]":return+n==+b;case "[object RegExp]":return n.source==
b.source&&n.global==b.global&&n.multiline==b.multiline&&n.ignoreCase==b.ignoreCase}if("object"!=typeof n||"object"!=typeof b)return!1;for(var f=d.length;f--;)if(d[f]==n)return!0;d.push(n);var f=0,m=!0;if("[object Array]"==c){if(f=n.length,m=f==b.length)for(;f--&&(m=f in n==f in b&&q(n[f],b[f],d)););}else{if("constructor"in n!="constructor"in b||n.constructor!=b.constructor)return!1;for(var j in n)if(e.has(n,j)&&(f++,!(m=e.has(b,j)&&q(n[j],b[j],d))))break;if(m){for(j in b)if(e.has(b,j)&&!f--)break;
m=!f}}d.pop();return m}var k=this,l=k._,p={},j=Array.prototype,c=Object.prototype,b=j.slice,f=j.unshift,a=c.toString,d=c.hasOwnProperty,x=j.forEach,u=j.map,s=j.reduce,m=j.reduceRight,B=j.filter,I=j.every,r=j.some,v=j.indexOf,t=j.lastIndexOf,c=Array.isArray,w=Object.keys,z=Function.prototype.bind,e=function(n){return new J(n)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=e),exports._=e):k._=e;e.VERSION="1.3.3";var y=e.each=e.forEach=function(n,
a,b){if(null!=n)if(x&&n.forEach===x)n.forEach(a,b);else if(n.length===+n.length)for(var d=0,c=n.length;d<c&&!(d in n&&a.call(b,n[d],d,n)===p);d++);else for(d in n)if(e.has(n,d)&&a.call(b,n[d],d,n)===p)break};e.map=e.collect=function(n,a,e){var b=[];if(null==n)return b;if(u&&n.map===u)return n.map(a,e);y(n,function(n,d,c){b[b.length]=a.call(e,n,d,c)});n.length===+n.length&&(b.length=n.length);return b};e.reduce=e.foldl=e.inject=function(n,a,b,d){var c=2<arguments.length;null==n&&(n=[]);if(s&&n.reduce===
s)return d&&(a=e.bind(a,d)),c?n.reduce(a,b):n.reduce(a);y(n,function(n,e,f){c?b=a.call(d,b,n,e,f):(b=n,c=!0)});if(!c)throw new TypeError("Reduce of empty array with no initial value");return b};e.reduceRight=e.foldr=function(n,a,b,d){var c=2<arguments.length;null==n&&(n=[]);if(m&&n.reduceRight===m)return d&&(a=e.bind(a,d)),c?n.reduceRight(a,b):n.reduceRight(a);var f=e.toArray(n).reverse();d&&!c&&(a=e.bind(a,d));return c?e.reduce(f,a,b,d):e.reduce(f,a)};e.find=e.detect=function(a,e,b){var d;D(a,function(a,
n,c){if(e.call(b,a,n,c))return d=a,!0});return d};e.filter=e.select=function(a,e,b){var d=[];if(null==a)return d;if(B&&a.filter===B)return a.filter(e,b);y(a,function(a,n,c){e.call(b,a,n,c)&&(d[d.length]=a)});return d};e.reject=function(a,e,b){var d=[];if(null==a)return d;y(a,function(a,n,c){e.call(b,a,n,c)||(d[d.length]=a)});return d};e.every=e.all=function(a,e,b){var d=!0;if(null==a)return d;if(I&&a.every===I)return a.every(e,b);y(a,function(a,n,c){if(!(d=d&&e.call(b,a,n,c)))return p});return!!d};
var D=e.some=e.any=function(a,b,d){b||(b=e.identity);var c=!1;if(null==a)return c;if(r&&a.some===r)return a.some(b,d);y(a,function(a,n,e){if(c||(c=b.call(d,a,n,e)))return p});return!!c};e.include=e.contains=function(a,e){var b=!1;return null==a?b:v&&a.indexOf===v?-1!=a.indexOf(e):b=D(a,function(a){return a===e})};e.invoke=function(a,d){var c=b.call(arguments,2);return e.map(a,function(a){return(e.isFunction(d)?d||a:a[d]).apply(a,c)})};e.pluck=function(a,b){return e.map(a,function(a){return a[b]})};
e.max=function(a,b,d){if(!b&&e.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&e.isEmpty(a))return-Infinity;var c={computed:-Infinity};y(a,function(a,n,e){n=b?b.call(d,a,n,e):a;n>=c.computed&&(c={value:a,computed:n})});return c.value};e.min=function(a,b,d){if(!b&&e.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&e.isEmpty(a))return Infinity;var c={computed:Infinity};y(a,function(a,n,e){n=b?b.call(d,a,n,e):a;n<c.computed&&(c={value:a,computed:n})});return c.value};e.shuffle=
function(a){var b=[],e;y(a,function(a,n){e=Math.floor(Math.random()*(n+1));b[n]=b[e];b[e]=a});return b};e.sortBy=function(a,b,d){var c=e.isFunction(b)?b:function(a){return a[b]};return e.pluck(e.map(a,function(a,n,b){return{value:a,criteria:c.call(d,a,n,b)}}).sort(function(a,n){var b=a.criteria,e=n.criteria;return void 0===b?1:void 0===e?-1:b<e?-1:b>e?1:0}),"value")};e.groupBy=function(a,b){var d={},c=e.isFunction(b)?b:function(a){return a[b]};y(a,function(a,n){var b=c(a,n);(d[b]||(d[b]=[])).push(a)});
return d};e.sortedIndex=function(a,b,d){d||(d=e.identity);for(var c=0,f=a.length;c<f;){var m=c+f>>1;d(a[m])<d(b)?c=m+1:f=m}return c};e.toArray=function(a){return!a?[]:e.isArray(a)||e.isArguments(a)?b.call(a):a.toArray&&e.isFunction(a.toArray)?a.toArray():e.values(a)};e.size=function(a){return e.isArray(a)?a.length:e.keys(a).length};e.first=e.head=e.take=function(a,e,d){return null!=e&&!d?b.call(a,0,e):a[0]};e.initial=function(a,e,d){return b.call(a,0,a.length-(null==e||d?1:e))};e.last=function(a,
e,d){return null!=e&&!d?b.call(a,Math.max(a.length-e,0)):a[a.length-1]};e.rest=e.tail=function(a,e,d){return b.call(a,null==e||d?1:e)};e.compact=function(a){return e.filter(a,function(a){return!!a})};e.flatten=function(a,b){return e.reduce(a,function(a,n){if(e.isArray(n))return a.concat(b?n:e.flatten(n));a[a.length]=n;return a},[])};e.without=function(a){return e.difference(a,b.call(arguments,1))};e.uniq=e.unique=function(a,b,d){d=d?e.map(a,d):a;var c=[];3>a.length&&(b=!0);e.reduce(d,function(d,f,
m){if(b?e.last(d)!==f||!d.length:!e.include(d,f))d.push(f),c.push(a[m]);return d},[]);return c};e.union=function(){return e.uniq(e.flatten(arguments,!0))};e.intersection=e.intersect=function(a){var d=b.call(arguments,1);return e.filter(e.uniq(a),function(a){return e.every(d,function(b){return 0<=e.indexOf(b,a)})})};e.difference=function(a){var d=e.flatten(b.call(arguments,1),!0);return e.filter(a,function(a){return!e.include(d,a)})};e.zip=function(){for(var a=b.call(arguments),d=e.max(e.pluck(a,"length")),
c=Array(d),f=0;f<d;f++)c[f]=e.pluck(a,""+f);return c};e.indexOf=function(a,b,d){if(null==a)return-1;var c;if(d)return d=e.sortedIndex(a,b),a[d]===b?d:-1;if(v&&a.indexOf===v)return a.indexOf(b);d=0;for(c=a.length;d<c;d++)if(d in a&&a[d]===b)return d;return-1};e.lastIndexOf=function(a,b){if(null==a)return-1;if(t&&a.lastIndexOf===t)return a.lastIndexOf(b);for(var e=a.length;e--;)if(e in a&&a[e]===b)return e;return-1};e.range=function(a,b,e){1>=arguments.length&&(b=a||0,a=0);e=arguments[2]||1;for(var d=
Math.max(Math.ceil((b-a)/e),0),c=0,f=Array(d);c<d;)f[c++]=a,a+=e;return f};var E=function(){};e.bind=function(a,d){var c,f;if(a.bind===z&&z)return z.apply(a,b.call(arguments,1));if(!e.isFunction(a))throw new TypeError;f=b.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(d,f.concat(b.call(arguments)));E.prototype=a.prototype;var e=new E,m=a.apply(e,f.concat(b.call(arguments)));return Object(m)===m?m:e}};e.bindAll=function(a){var d=b.call(arguments,1);0==d.length&&(d=e.functions(a));
y(d,function(b){a[b]=e.bind(a[b],a)});return a};e.memoize=function(a,b){var d={};b||(b=e.identity);return function(){var c=b.apply(this,arguments);return e.has(d,c)?d[c]:d[c]=a.apply(this,arguments)}};e.delay=function(a,e){var d=b.call(arguments,2);return setTimeout(function(){return a.apply(null,d)},e)};e.defer=function(a){return e.delay.apply(e,[a,1].concat(b.call(arguments,1)))};e.throttle=function(a,b){var d,c,f,m,j,w,k=e.debounce(function(){j=m=!1},b);return function(){d=this;c=arguments;f||
(f=setTimeout(function(){f=null;j&&a.apply(d,c);k()},b));m?j=!0:w=a.apply(d,c);k();m=!0;return w}};e.debounce=function(a,b,e){var d;return function(){var c=this,f=arguments;e&&!d&&a.apply(c,f);clearTimeout(d);d=setTimeout(function(){d=null;e||a.apply(c,f)},b)}};e.once=function(a){var b=!1,e;return function(){if(b)return e;b=!0;return e=a.apply(this,arguments)}};e.wrap=function(a,e){return function(){var d=[a].concat(b.call(arguments,0));return e.apply(this,d)}};e.compose=function(){var a=arguments;
return function(){for(var b=arguments,e=a.length-1;0<=e;e--)b=[a[e].apply(this,b)];return b[0]}};e.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};e.keys=w||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],d;for(d in a)e.has(a,d)&&(b[b.length]=d);return b};e.values=function(a){return e.map(a,e.identity)};e.functions=e.methods=function(a){var b=[],d;for(d in a)e.isFunction(a[d])&&b.push(d);return b.sort()};e.extend=function(a){y(b.call(arguments,
1),function(b){for(var e in b)a[e]=b[e]});return a};e.pick=function(a){var d={};y(e.flatten(b.call(arguments,1)),function(b){b in a&&(d[b]=a[b])});return d};e.defaults=function(a){y(b.call(arguments,1),function(b){for(var e in b)null==a[e]&&(a[e]=b[e])});return a};e.clone=function(a){return!e.isObject(a)?a:e.isArray(a)?a.slice():e.extend({},a)};e.tap=function(a,b){b(a);return a};e.isEqual=function(a,b){return q(a,b,[])};e.isEmpty=function(a){if(null==a)return!0;if(e.isArray(a)||e.isString(a))return 0===
a.length;for(var b in a)if(e.has(a,b))return!1;return!0};e.isElement=function(a){return!!(a&&1==a.nodeType)};e.isArray=c||function(b){return"[object Array]"==a.call(b)};e.isObject=function(a){return a===Object(a)};e.isArguments=function(b){return"[object Arguments]"==a.call(b)};e.isArguments(arguments)||(e.isArguments=function(a){return!(!a||!e.has(a,"callee"))});e.isFunction=function(b){return"[object Function]"==a.call(b)};e.isString=function(b){return"[object String]"==a.call(b)};e.isNumber=function(b){return"[object Number]"==
a.call(b)};e.isFinite=function(a){return e.isNumber(a)&&isFinite(a)};e.isNaN=function(a){return a!==a};e.isBoolean=function(b){return!0===b||!1===b||"[object Boolean]"==a.call(b)};e.isDate=function(b){return"[object Date]"==a.call(b)};e.isRegExp=function(b){return"[object RegExp]"==a.call(b)};e.isNull=function(a){return null===a};e.isUndefined=function(a){return void 0===a};e.has=function(a,b){return d.call(a,b)};e.noConflict=function(){k._=l;return this};e.identity=function(a){return a};e.times=
function(a,b,e){for(var d=0;d<a;d++)b.call(e,d)};e.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};e.result=function(a,b){if(null==a)return null;var d=a[b];return e.isFunction(d)?d.call(a):d};e.mixin=function(a){y(e.functions(a),function(d){var c=e[d]=a[d];J.prototype[d]=function(){var a=b.call(arguments);f.call(a,this._wrapped);return N(c.apply(e,a),this._chain)}})};var H=0;e.uniqueId=
function(a){var b=H++;return a?a+b:b};e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var O=/.^/,M={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},P;for(P in M)M[M[P]]=P;var V=/\\|'|\r|\n|\t|\u2028|\u2029/g,W=/\\(\\|'|r|n|t|u2028|u2029)/g,Q=function(a){return a.replace(W,function(a,b){return M[b]})};e.template=function(a,b,d){d=e.defaults(d||{},e.templateSettings);a="__p+='"+a.replace(V,function(a){return"\\"+M[a]}).replace(d.escape||
O,function(a,b){return"'+\n_.escape("+Q(b)+")+\n'"}).replace(d.interpolate||O,function(a,b){return"'+\n("+Q(b)+")+\n'"}).replace(d.evaluate||O,function(a,b){return"';\n"+Q(b)+"\n;__p+='"})+"';\n";d.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var c=new Function(d.variable||"obj","_",a);if(b)return c(b,e);b=function(a){return c.call(this,a,e)};b.source="function("+(d.variable||"obj")+"){\n"+a+"}";return b};
e.chain=function(a){return e(a).chain()};var J=function(a){this._wrapped=a};e.prototype=J.prototype;var N=function(a,b){return b?e(a).chain():a};e.mixin(e);y("pop push reverse shift sort splice unshift".split(" "),function(a){var b=j[a];J.prototype[a]=function(){var e=this._wrapped;b.apply(e,arguments);var d=e.length;("shift"==a||"splice"==a)&&0===d&&delete e[0];return N(e,this._chain)}});y(["concat","join","slice"],function(a){var b=j[a];J.prototype[a]=function(){return N(b.apply(this._wrapped,arguments),
this._chain)}});J.prototype.chain=function(){this._chain=!0;return this};J.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};
(function(){var q=[].slice,k=/\s+/,l=function(c,b,f,a){if(!f)return!0;if("object"===typeof f)for(var d in f)c[b].apply(c,[d,f[d]].concat(a));else if(k.test(f)){f=f.split(k);d=0;for(var j=f.length;d<j;d++)c[b].apply(c,[f[d]].concat(a))}else return!0},p=function(c,b,f){var a;c=-1;var d=b.length;switch(f.length){case 0:for(;++c<d;)(a=b[c]).callback.call(a.ctx);break;case 1:for(;++c<d;)(a=b[c]).callback.call(a.ctx,f[0]);break;case 2:for(;++c<d;)(a=b[c]).callback.call(a.ctx,f[0],f[1]);break;case 3:for(;++c<
d;)(a=b[c]).callback.call(a.ctx,f[0],f[1],f[2]);break;default:for(;++c<d;)(a=b[c]).callback.apply(a.ctx,f)}},j=Backbone.Events={on:function(c,b,f){if(!l(this,"on",c,[b,f])||!b)return this;this._events||(this._events={});(this._events[c]||(this._events[c]=[])).push({callback:b,context:f,ctx:f||this});return this},once:function(c,b,f){if(!l(this,"once",c,[b,f])||!b)return this;var a=this,d=_.once(function(){a.off(c,d);b.apply(this,arguments)});d._callback=b;this.on(c,d,f);return this},off:function(c,
b,f){var a,d,j,k,s,m,B,p;if(!this._events||!l(this,"off",c,[b,f]))return this;if(!c&&!b&&!f)return this._events={},this;k=c?[c]:_.keys(this._events);s=0;for(m=k.length;s<m;s++)if(c=k[s],a=this._events[c]){j=[];if(b||f){B=0;for(p=a.length;B<p;B++)d=a[B],(b&&b!==(d.callback._callback||d.callback)||f&&f!==d.context)&&j.push(d)}this._events[c]=j}return this},trigger:function(c){if(!this._events)return this;var b=q.call(arguments,1);if(!l(this,"trigger",c,b))return this;var f=this._events[c],a=this._events.all;
f&&p(this,f,b);a&&p(this,a,arguments);return this},listenTo:function(c,b,f){var a=this._listeners||(this._listeners={}),d=c._listenerId||(c._listenerId=_.uniqueId("l"));a[d]=c;c.on(b,f||this,this);return this},stopListening:function(c,b,f){var a=this._listeners;if(a){if(c)c.off(b,f,this),!b&&!f&&delete a[c._listenerId];else{for(var d in a)a[d].off(null,null,this);this._listeners={}}return this}}};j.bind=j.on;j.unbind=j.off})();(function(){for(var q=0,k=["ms","moz","webkit","o"],l=0;l<k.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[k[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[k[l]+"CancelAnimationFrame"]||window[k[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(k){var j=(new Date).getTime(),c=Math.max(0,16-(j-q)),b=window.setTimeout(function(){k(j+c)},c);q=j+c;return b});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(k){clearTimeout(k)})})();(function(){function q(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a);this.trigger(m.Events.resize,b,a)}var k=this,l=k.Two||{},p=Math.sin,j=Math.cos,c=Math.atan2,b=Math.sqrt,f=Math.abs,a=Math.PI,d=2*a,x=a/2,u=Math.pow,s={hasEventListeners:_.isFunction(k.addEventListener),bind:function(a,b,e,d){this.hasEventListeners?a.addEventListener(b,e,!!d):a.attachEvent("on"+b,e);return this},unbind:function(a,b,e,d){this.hasEventListeners?
a.removeEventListeners(b,e,!!d):a.detachEvent("on"+b,e);return this}},m=k.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:m.Types.svg,autostart:!1});this.type=a.type;this.renderer=new m[this.type](this);this.playing=a.autostart;this.frameCount=0;a.fullscreen?(a=_.bind(q,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),s.bind(window,"resize",a),a()):(this.renderer.setSize(a.width,a.height),this.width=
a.width,this.height=a.height);this.scene=new m.Group;this.renderer.add(this.scene);m.Instances.push(this)};_.extend(m,{Array:k.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){k.Two=l;return this},Utils:{Curve:{CollinearityEpsilon:u(10,-30),RecursionLimit:32,
CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},subdivide:function(b,j,e,k,x,s,u,l,B){var p=m.Utils.Curve.CollinearityEpsilon,q=m.Utils.Curve.CuspLimit,r=m.Utils.Curve.Tolerance;B=B||0;var I=(b+e)/2,v=(j+k)/2,t=(e+x)/2,n=(k+s)/2,R=(x+u)/2,S=(s+l)/2,T=(I+t)/2,U=(v+n)/2,t=(t+R)/2,n=(n+S)/2,F=(T+t)/2,G=(U+n)/2;if(0<B){var A=u-b,C=l-j,K=f((e-u)*C-(k-l)*A),L=f((x-u)*C-(s-l)*A);if(K>p&&L>p&&(K+L)*(K+L)<=r.distance*(A*A+C*C)){if(r.angle<r.epsilon)return[new m.Vector(F,G)];A=c(s-k,x-e);p=f(A-
c(k-j,e-b));A=f(c(l-s,u-x)-A);p>=a&&(p=d-p);A>=a&&(A=d-A);if(p+A<r.angle)return[new m.Vector(F,G)];if(0!==q){if(p>q)return[new m.Vector(e,k)];if(A>q)return[new m.Vector(x,s)]}}}else if(K>p)if(K*K<=r.distance*(A*A+C*C)){if(r.angle<r.epsilon)return[new m.Vector(F,G)];p=f(c(s-k,x-e)-c(k-j,e-b));p>=a&&(p=d-p);if(p<r.angle)return[new m.Vector(e,k),new m.Vector(x,s)];if(0!==q&&p>q)return[new m.Vector(e,k)]}else if(L>p){if(L*L<=r.distance*(A*A+C*C)){if(r.angle<r.epsilon)return[new m.Vector(F,G)];p=f(c(l-
s,u-x)-c(s-k,x-e));p>=a&&(p=d-p);if(p<r.angle)return[new m.Vector(e,k),new m.Vector(x,s)];if(0!==q&&p>q)return[new m.Vector2(x,s)]}}else if(A=F-(b+u)/2,C=G-(j+l)/2,A*A+C*C<=r.distance)return[new m.Vector(F,G)];return m.Utils.subdivide(b,j,I,v,T,U,F,G,B+1).concat(m.Utils.subdivide(F,G,t,n,R,S,u,l,B+1))},getCurveFromPoints:function(a,b){for(var e=[],d=a.length,c=d-1,f=0;f<d;f++){var m=a[f],j={x:m.x,y:m.y};e.push(j);var m=b?t(f-1,d):Math.max(f-1,0),k=b?t(f+1,d):Math.min(f+1,c);v(a[m],j,a[k]);!j.u.x&&
!j.u.y&&(j.u.x=j.x,j.u.y=j.y);!j.v.x&&!j.v.y&&(j.v.x=j.x,j.v.y=j.y)}return e},getControlPoints:function(b,d,e){var c=r(b,d),f=r(e,d);b=B(b,d);e=B(e,d);var m=(c+f)/2;if(1E-4>b||1E-4>e)return d.u={x:d.x,y:d.y},d.v={x:d.x,y:d.y},d;b*=0.33;e*=0.33;m=f<c?m+x:m-x;c={x:d.x+j(m)*b,y:d.y+p(m)*b};m-=a;f={x:d.x+j(m)*e,y:d.y+p(m)*e};d.u=c;d.v=f;return d},angleBetween:function(a,b){return c(a.y-b.y,a.x-b.x)},distanceBetweenSquared:function(a,b){var d=a.x-b.x,c=a.y-b.y;return d*d+c*c},distanceBetween:function(a,
d){return b(I(a,d))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Error:function(a){this.name="two.js";this.message=a}}});m.Utils.Error.prototype=Error();m.Utils.Error.prototype.constructor=m.Utils.Error;var B=m.Utils.distanceBetween,I=m.Utils.distanceBetweenSquared,r=m.Utils.angleBetween,v=m.Utils.getControlPoints,t=m.Utils.mod;_.extend(m.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);return this},play:function(){this.playing=!0;return this.trigger(m.Events.play)},
pause:function(){this.playing=!1;return this.trigger(m.Events.pause)},update:function(){this.frameCount++;var a=this.width,b=this.height,d=this.renderer;(a!==d.width||b!==d.height)&&d.setSize(a,b);return this.trigger(m.Events.update,this.frameCount)},render:function(){this.renderer.render();return this.trigger(m.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);return this},makeLine:function(a,b,d,c){d=(d-a)/2;c=(c-b)/2;var f=[new m.Vector(-d,
-c),new m.Vector(d,c)],f=(new m.Polygon(f)).noFill();f.translation.set(a+d,b+c);this.scene.add(f);return f},makeRectangle:function(a,b,d,c){d/=2;c/=2;c=[new m.Vector(d,c),new m.Vector(-d,c),new m.Vector(-d,-c),new m.Vector(d,-c)];c=new m.Polygon(c,!0);c.translation.set(a,b);this.scene.add(c);return c},makeCircle:function(a,b,d){return this.makeEllipse(a,b,d,d)},makeEllipse:function(a,b,e,c){var f=m.Resolution,k=_.map(_.range(f),function(a){var b=a/f*d;a=e*j(b);b=c*p(b);return new m.Vector(a,b)},this),
k=new m.Polygon(k,!0,!0);k.translation.set(a,b);this.scene.add(k);return k},makeCurve:function(a){var b=arguments.length,d=a;if(!_.isArray(a))for(var d=[],c=0;c<b;c+=2){var f=arguments[c];if(!_.isNumber(f))break;d.push(new m.Vector(f,arguments[c+1]))}var b=arguments[b-1],d=new m.Polygon(d,!(_.isBoolean(b)&&b),!0),b=d.getBoundingClientRect(),j=b.left+b.width/2,k=b.top+b.height/2;_.each(d.vertices,function(a){a.x-=j;a.y-=k});d.translation.set(j,k);this.scene.add(d);return d},makePolygon:function(a){var b=
arguments.length,d=a;if(!_.isArray(a))for(var d=[],c=0;c<b;c+=2){var f=arguments[c];if(!_.isNumber(f))break;d.push(new m.Vector(f,arguments[c+1]))}b=arguments[b-1];d=new m.Polygon(d,!(_.isBoolean(b)&&b));d.center();this.scene.add(d);return d},makeGroup:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));var d=new m.Group;this.scene.add(d);d.add(b);return d}});(function(){_.each(m.Instances,function(a){a.playing&&a.update().render()});requestAnimationFrame(arguments.callee)})()})();(function(){var q=Two.Vector=function(k,l){k=k||0;l=l||0;Object.defineProperty(this,"x",{get:function(){return k},set:function(l){k=l;this.trigger("change","x")}});Object.defineProperty(this,"y",{get:function(){return l},set:function(k){l=k;this.trigger("change","y")}})};_.extend(q,{});_.extend(q.prototype,Backbone.Events,{set:function(k,l){this.x=k;this.y=l;return this},copy:function(k){this.x=k.x;this.y=k.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new q(this.x,
this.y)},add:function(k,l){this.x=k.x+l.x;this.y=k.y+l.y;return this},addSelf:function(k){this.x+=k.x;this.y+=k.y;return this},sub:function(k,l){this.x=k.x-l.x;this.y=k.y-l.y;return this},subSelf:function(k){this.x-=k.x;this.y-=k.y;return this},multiplySelf:function(k){this.x*=k.x;this.y*=k.y;return this},multiplyScalar:function(k){this.x*=k;this.y*=k;return this},divideScalar:function(k){k?(this.x/=k,this.y/=k):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(k){return this.x*
k.x+this.y*k.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(k){return Math.sqrt(this.distanceToSquared(k))},distanceToSquared:function(k){var l=this.x-k.x;k=this.y-k.y;return l*l+k*k},setLength:function(k){return this.normalize().multiplyScalar(k)},equals:function(k){return 1E-4>this.distanceTo(k)},lerp:function(k,l){return this.set((k.x-this.x)*
l+this.x,(k.y-this.y)*l+this.y)},isZero:function(){return 1E-4>this.length()}})})();(function(){_.range(6);var q=Math.cos,k=Math.sin,l=Math.tan,p=Two.Matrix=function(j,c,b,f,a,d){this.elements=new Two.Array(9);var k=j;_.isArray(k)||(k=_.toArray(arguments));this.identity().set(k)};_.extend(p,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(j,c){if(3>=c.length){var b=c[0]||0,f=c[1]||0,a=c[2]||0;return{x:j[0]*b+j[1]*f+j[2]*a,y:j[3]*b+j[4]*f+j[5]*a,z:j[6]*b+j[7]*f+j[8]*a}}var b=j[0],f=j[1],a=j[2],d=j[3],k=j[4],u=j[5],s=j[6],m=j[7],l=j[8],p=c[0],r=c[1],q=c[2],t=c[3],w=c[4],z=c[5],e=c[6],
y=c[7],D=c[8];return[b*p+f*t+a*e,b*r+f*w+a*y,b*q+f*z+a*D,d*p+k*t+u*e,d*r+k*w+u*y,d*q+k*z+u*D,s*p+m*t+l*e,s*r+m*w+l*y,s*q+m*z+l*D]}});_.extend(p.prototype,{set:function(j,c,b,f,a,d){var k=j;_.isArray(k)||(k=_.toArray(arguments));_.each(k,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this},identity:function(){this.set(p.Identity);return this},multiply:function(j,c,b,f,a,d,k,u,s){var m=arguments,l=m.length;if(1>=l)return _.each(this.elements,function(a,b){this.elements[b]=a*j},this),
this;if(3>=l)return j=j||0,c=c||0,b=b||0,a=this.elements,{x:a[0]*j+a[1]*c+a[2]*b,y:a[3]*j+a[4]*c+a[5]*b,z:a[6]*j+a[7]*c+a[8]*b};l=this.elements;A0=l[0];A1=l[1];A2=l[2];A3=l[3];A4=l[4];A5=l[5];A6=l[6];A7=l[7];A8=l[8];B0=m[0];B1=m[1];B2=m[2];B3=m[3];B4=m[4];B5=m[5];B6=m[6];B7=m[7];B8=m[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*B6;this.elements[4]=A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=
A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this},scale:function(j,c){1>=arguments.length&&(c=j);return this.multiply(j,0,0,0,c,0,0,0,1)},rotate:function(j){var c=q(j);j=k(j);return this.multiply(c,-j,0,j,c,0,0,0,1)},translate:function(j,c){return this.multiply(1,0,j,0,1,c,0,0,1)},skewX:function(j){j=l(j);return this.multiply(1,j,0,0,1,0,0,0,1)},skewY:function(j){j=l(j);return this.multiply(1,0,0,j,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},
toArray:function(j){var c=this.elements,b=parseFloat(c[0].toFixed(3)),f=parseFloat(c[1].toFixed(3)),a=parseFloat(c[2].toFixed(3)),d=parseFloat(c[3].toFixed(3)),k=parseFloat(c[4].toFixed(3)),u=parseFloat(c[5].toFixed(3));if(j){j=parseFloat(c[6].toFixed(3));var s=parseFloat(c[7].toFixed(3)),c=parseFloat(c[8].toFixed(3));return[b,d,j,f,k,s,a,u,c]}return[b,d,f,k,a,u]},clone:function(){var j=this.elements[0],c=this.elements[1],b=this.elements[2],f=this.elements[3],a=this.elements[4],d=this.elements[5];
g=this.elements[6];h=this.elements[7];i=this.elements[8];return new Two.Matrix(j,c,b,f,a,d,g,h,i)}})})();(function(){function q(c){var b={},f=c.id,a=c.translation,d=c.rotation,k=c.scale,u=c.stroke,s=c.linewidth,m=c.fill,l=c.opacity,q=c.visible,r=c.cap,v=c.join,t=c.miter,w=c.curved,z=c.closed,e=c.vertices;f&&(b.id=j.Identifier+f);a&&(_.isNumber(k)&&_.isNumber(d))&&(b.transform="matrix("+c._matrix.toString()+")");u&&(b.stroke=u);m&&(b.fill=m);l&&(b["stroke-opacity"]=b["fill-opacity"]=l);b.visibility=q?"visible":"hidden";r&&(b["stroke-linecap"]=r);v&&(b["stroke-linejoin"]=v);t&&(b["stroke-miterlimit"]=
t);s&&(b["stroke-width"]=s);e&&(b.d=p.toString(e,z,w));return b}var k=Two.Utils.getCurveFromPoints,l=Two.Utils.mod,p={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(c,b){var f=c.toLowerCase(),a=document.createElementNS(this.ns,f);"svg"===f&&(b=_.defaults(b||{},{version:this.version}));_.isObject(b)&&this.setAttributes(a,b);return a},setAttributes:function(c,b){_.each(b,function(b,a){this.setAttribute(a,b)},c);return this},removeAttributes:function(c,
b){_.each(b,function(b){this.removeAttribute(b)},c);return this},toString:function(c,b,f){var a=c.length,d=a-1;if(!f)return _.map(c,function(a,c){var f;f=(0>=c?"M":"L")+(" "+a.x.toFixed(3)+" "+a.y.toFixed(3));c>=d&&b&&(f+=" Z");return f}).join(" ");var j=k(c,b);return _.map(j,function(c,f){var m,k=b?l(f-1,a):Math.max(f-1,0),p=b?l(f+1,a):Math.min(f+1,d);m=j[k];var p=j[p],k=m.v.x.toFixed(3),q=m.v.y.toFixed(3),v=c.u.x.toFixed(3),t=c.u.y.toFixed(3),w=c.x.toFixed(3),z=c.y.toFixed(3);m=0>=f?"M "+w+" "+
z:"C "+k+" "+q+" "+v+" "+t+" "+w+" "+z;f>=d&&b&&(k=c.v.x.toFixed(3),q=c.v.y.toFixed(3),v=p.u.x.toFixed(3),t=p.u.y.toFixed(3),w=p.x.toFixed(3),z=p.y.toFixed(3),m=m+(" C "+k+" "+q+" "+v+" "+t+" "+w+" "+z)+" Z");return m}).join(" ")}},j=Two[Two.Types.svg]=function(){this.count=0;this.domElement=p.createElement("svg");this.elements=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(j,{Identifier:"two-"});_.extend(j.prototype,
Backbone.Events,{setSize:function(c,b){this.width=c;this.height=b;p.setAttributes(this.domElement,{width:c,height:b});return this},add:function(c){var b=c,f=this.elements,a=this.domElement;_.isArray(c)||(b=_.map(arguments,function(a){return a}));_.each(b,function(b){var c;c=b instanceof Two.Group;if(_.isUndefined(b.id)){var j=this.count;this.count++;b.id=j}c?(c="g",_.isUndefined(b.parent)&&(b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),b=q(b),delete b.stroke,
delete b.fill,delete b["fill-opacity"],delete b["stroke-opacity"],delete b["stroke-linecap"],delete b["stroke-linejoin"],delete b["stroke-miterlimit"],delete b["stroke-width"]):(c="path",b=q(b));b=p.createElement(c,b);a.appendChild(b);f.push(b)},this);return this},update:function(c,b,f,a,d){var j=this.elements,k=j[c];switch(b){case Two.Properties.hierarchy:_.each(f,function(a){k.appendChild(j[a])});break;case Two.Properties.demotion:_.each(f,function(a){k.removeChild(j[a])});break;default:a:{c=b;
switch(c){case "matrix":c="transform";f="matrix("+f.toString()+")";break;case "visible":c="visibility";f=f?"visible":"hidden";break;case "cap":c="stroke-linecap";break;case "join":c="stroke-linejoin";break;case "miter":c="stroke-miterlimit";break;case "linewidth":c="stroke-width";break;case "vertices":c="d";f=p.toString(f,a,d);break;case "opacity":p.setAttributes(k,{"stroke-opacity":f,"fill-opacity":f});break a}k.setAttribute(c,f)}}return this},render:function(){this.unveil();return this}})})();(function(){var q=Two.Utils.getCurveFromPoints,k=Two.Utils.mod,l=function(b){_.each(b,function(b,a){this[a]=b},this);this.children={}};_.extend(l.prototype,{appendChild:function(b){var c=b.parent,a=b.id;_.isUndefined(c)||delete c.children[a];this.children[a]=b;b.parent=this;return this},removeChild:function(b){delete this.children[b.id];return this},render:function(b){var c=this.matrix;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);_.each(this.children,function(a){a.render(b)});b.restore();return this}});
var p=function(b){_.each(b,function(b,a){this[a]=b},this)};_.extend(p.prototype,{render:function(b){var c=this.matrix,a=this.stroke,d=this.linewidth,j=this.fill,l=this.opacity,s=this.cap,m=this.join,p=this.miter,q=this.curved,r=this.closed,v=this.commands,t=v.length,w=t-1;if(!this.visible)return this;b.save();c&&b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);j&&(b.fillStyle=j);a&&(b.strokeStyle=a);d&&(b.lineWidth=d);p&&(b.miterLimit=p);m&&(b.lineJoin=m);s&&(b.lineCap=s);_.isNumber(l)&&(b.globalAlpha=
l);b.beginPath();_.each(v,function(a,d){var c=a.x.toFixed(3),f=a.y.toFixed(3);if(q){var j=r?k(d-1,t):Math.max(d-1,0),m=r?k(d+1,t):Math.min(d+1,w),l=v[j],m=v[m],j=l.v.x.toFixed(3),l=l.v.y.toFixed(3),s=a.u.x.toFixed(3),p=a.u.y.toFixed(3);0>=d?b.moveTo(c,f):(b.bezierCurveTo(j,l,s,p,c,f),d>=w&&r&&(j=a.v.x.toFixed(3),l=a.v.y.toFixed(3),s=m.u.x.toFixed(3),p=m.u.y.toFixed(3),c=m.x.toFixed(3),f=m.y.toFixed(3),b.bezierCurveTo(j,l,s,p,c,f)))}else 0>=d?b.moveTo(c,f):b.lineTo(c,f)});r&&!q&&b.closePath();b.fill();
b.stroke();b.restore()}});var j={toArray:function(b,c,a){return!c?_.map(b,function(a){return{x:a.x,y:a.y}}):q(b,a)}},c=Two[Two.Types.canvas]=function(){this.count=0;this.domElement=document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.elements=[];this.stage=null};_.extend(c,{});_.extend(c,{Group:l,Element:p,getStyles:function(b){var c={},a=b.id,d=b._matrix,k=b.stroke,l=b.linewidth,s=b.fill,m=b.opacity,p=b.visible,q=b.cap,r=b.join,v=b.miter,t=b.curved,w=b.closed;b=b.vertices;
a&&(c.id=a);_.isObject(d)&&(c.matrix=d.toArray());k&&(c.stroke=k);s&&(c.fill=s);_.isNumber(m)&&(c.opacity=m);q&&(c.cap=q);r&&(c.join=r);v&&(c.miter=v);l&&(c.linewidth=l);b&&(c.commands=j.toArray(b,t,w));c.visible=!!p;c.curved=!!t;c.closed=!!w;return c},setStyles:function(b,c,a,d,k){switch(c){case "matrix":c="matrix";a=a.toArray();break;case "vertices":c="commands",b.curved=k,b.closed=d,a=j.toArray(a,b.curved,b.closed)}b[c]=a},Utils:j});_.extend(c.prototype,Backbone.Events,{setSize:function(b,c){this.width=
this.domElement.width=b;this.height=this.domElement.height=c;_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});return this},add:function(b){constructor=Object.getPrototypeOf(this).constructor;var c=b,a=this.elements,d=constructor.Group,j=constructor.Element,k=constructor.getStyles;_.isArray(b)||(c=_.map(arguments,function(a){return a}));_.each(c,function(b){var c;c=b instanceof Two.Group;var f=_.isNull(this.stage);if(_.isUndefined(b.id)){var l=this.count;this.count++;
b.id=l}c?(c=k.call(this,b),delete c.stroke,delete c.fill,delete c.opacity,delete c.cap,delete c.join,delete c.miter,delete c.linewidth,c=new d(c),f&&(this.stage=c,this.stage.object=b,b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):c=new j(k.call(this,b));a.push(c);f||this.stage.appendChild(c)},this);return this},update:function(b,c,a,d,j,k){var l=Object.getPrototypeOf(this).constructor,m=this.elements,p=m[b];switch(c){case Two.Properties.hierarchy:_.each(a,
function(a){p.appendChild(m[a])});break;case Two.Properties.demotion:_.each(a,function(a){p.removeChild(m[a]);this.elements[a]=null},this);default:l.setStyles.call(this,p,c,a,d,j,k)}return this},render:function(){if(_.isNull(this.stage))return this;this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);return this}})})();(function(){var q=Two[Two.Types.canvas],k=Two.Matrix.Multiply,l=Two[Two.Types.canvas].Utils.toArray,p=Two.Utils.mod,j=function(a){q.Group.call(this,a)};_.extend(j.prototype,q.Group.prototype,{appendChild:function(){q.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},updateTexture:function(a){_.each(this.children,function(b){b.updateTexture(a)});return this},updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;
if(!b)return this;this._matrix=k(this.matrix,b);this._scale=this.scale*a;_.each(this.children,function(a){a.updateMatrix(this)},this);return this},render:function(a,b){_.each(this.children,function(c){c.render(a,b)})}});var c=function(a){q.Element.call(this,a)};_.extend(c.prototype,q.Element.prototype,{updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=k(this.matrix,b);this._scale=this.scale*a;
return this},updateTexture:function(a){b.updateTexture(a,this);return this},render:function(a,b){if(!this.visible||!this.opacity||!this.buffer)return this;a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordsBuffer);a.vertexAttribPointer(b.textureCoords,2,a.FLOAT,!1,0,0);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniformMatrix3fv(b.matrix,!1,this._matrix);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.vertexAttribPointer(b.position,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,6);return this}});var b={canvas:document.createElement("canvas"),
uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(a,b,c){var f=Infinity,j=-Infinity,k=Infinity,l=-Infinity;_.each(a,function(a){var b=a.x,d=a.y,p;k=Math.min(d,k);f=Math.min(b,f);j=Math.max(b,j);l=Math.max(d,l);c&&(b=a.u.x,d=a.u.y,p=a.v.x,a=a.v.y,k=Math.min(d,a,k),f=Math.min(b,p,f),j=Math.max(b,p,j),l=Math.max(d,a,l))});_.isNumber(b)&&(k-=b,f-=b,j+=b,l+=b);a=j-f;b=l-k;var p={x:Math.abs(f),y:Math.abs(k)};return{top:k,left:f,right:j,bottom:l,width:a,height:b,centroid:p}},getTriangles:function(a){var b=
a.top,c=a.left,f=a.right;a=a.bottom;return new Two.Array([c,b,f,b,c,a,c,a,f,b,f,a])},updateCanvas:function(a){var b=a.commands,c=this.canvas,f=this.ctx,j=a._scale,k=a.stroke,l=a.linewidth*j,q=a.fill,r=a.opacity,v=a.cap,t=a.join,w=a.miter,z=a.curved,e=a.closed,y=b.length,D=y-1;c.width=Math.max(Math.ceil(a.rect.width*j),1);c.height=Math.max(Math.ceil(a.rect.height*j),1);a=a.rect.centroid;var E=a.x*j,H=a.y*j;f.clearRect(0,0,c.width,c.height);q&&(f.fillStyle=q);k&&(f.strokeStyle=k);l&&(f.lineWidth=l);
w&&(f.miterLimit=w);t&&(f.lineJoin=t);v&&(f.lineCap=v);_.isNumber(r)&&(f.globalAlpha=r);f.beginPath();_.each(b,function(a,c){var k=(a.x*j+E).toFixed(3),m=(a.y*j+H).toFixed(3);if(z){var l=e?p(c-1,y):Math.max(c-1,0),q=e?p(c+1,y):Math.min(c+1,D),x=b[l],q=b[q],l=(x.v.x*j+E).toFixed(3),x=(x.v.y*j+H).toFixed(3),r=(a.u.x*j+E).toFixed(3),n=(a.u.y*j+H).toFixed(3);0>=c?f.moveTo(k,m):(f.bezierCurveTo(l,x,r,n,k,m),c>=D&&e&&(l=(a.v.x*j+E).toFixed(3),x=(a.v.y*j+H).toFixed(3),r=(q.u.x*j+E).toFixed(3),n=(q.u.y*j+
H).toFixed(3),k=(q.x*j+E).toFixed(3),m=(q.y*j+H).toFixed(3),f.bezierCurveTo(l,x,r,n,k,m)))}else 0>=c?f.moveTo(k,m):f.lineTo(k,m)});e&&!z&&f.closePath();f.fill();f.stroke()},updateTexture:function(a,b){this.updateCanvas(b);b.texture&&a.deleteTexture(b.texture);a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);b.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,c){_.isObject(b.buffer)&&a.deleteBuffer(b.buffer);b.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.buffer);a.enableVertexAttribArray(c.position);a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.textureCoordsBuffer)&&a.deleteBuffer(b.textureCoordsBuffer);b.textureCoordsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,
b.textureCoordsBuffer);a.enableVertexAttribArray(c.textureCoords);a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){var c=a.createProgram();_.each(b,function(b){a.attachShader(c,b)});a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw error=a.getProgramInfoLog(c),new Two.Utils.Error("unable to link program: "+error);return c}},shaders:{create:function(a,b,c){c=a.createShader(a[c]);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a=
a.getShaderInfoLog(c),new Two.Utils.Error("unable to compile shader "+c+": "+a);return c},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 a_position;\nattribute vec2 a_textureCoords;\n\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\n\nvarying vec2 v_textureCoords;\n\nvoid main() {\n   vec2 projected = (u_matrix * vec3(a_position, 1)).xy;\n   vec2 normal = projected / u_resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n   v_textureCoords = a_textureCoords;\n}",
fragment:"precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_textureCoords;\n\nvoid main() {\n  gl_FragColor = texture2D(u_image, v_textureCoords);\n}"}};b.ctx=b.canvas.getContext("2d");var f=Two[Two.Types.webgl]=function(a){this.count=0;this.domElement=document.createElement("canvas");this.elements=[];this.stage=null;a=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1});a=this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",
a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var c=b.shaders.create(a,b.shaders.vertex,b.shaders.types.vertex),f=b.shaders.create(a,b.shaders.fragment,b.shaders.types.fragment);this.program=b.program.create(a,[c,f]);a.useProgram(this.program);this.program.position=a.getAttribLocation(this.program,"a_position");this.program.matrix=a.getUniformLocation(this.program,"u_matrix");this.program.textureCoords=a.getAttribLocation(this.program,"a_textureCoords");
a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)};_.extend(f,{Group:j,Element:c,getStyles:function(a){var c={},f=a.id,j=a._matrix,k=a.stroke,m=a.linewidth,p=a.fill,q=a.opacity,r=a.visible,v=a.cap,t=a.join,w=a.miter,z=a.curved,e=a.closed;a=a.vertices;f&&(c.id=f);_.isObject(j)&&(c.matrix=c._matrix=j.toArray(!0),c.scale=c._scale=1);k&&(c.stroke=k);p&&(c.fill=p);_.isNumber(q)&&(c.opacity=
q);v&&(c.cap=v);t&&(c.join=t);w&&(c.miter=w);m&&(c.linewidth=m);a&&(c.vertices=l(a,z,e),c.commands=c.vertices,c.rect=b.getBoundingClientRect(c.commands,c.linewidth,c.curved),c.triangles=b.getTriangles(c.rect));c.visible=!!r;c.curved=!!z;c.closed=!!e;return c},setStyles:function(a,c,f,j,k,m){var p=!1;/matrix/.test(c)?(a[c]=f.toArray(!0),_.isNumber(j)&&(p=a.scale!==j,a.scale=j),a.updateMatrix()):/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(c)?(a[c]=f,a.rect=b.getBoundingClientRect(a.commands,
a.linewidth,a.curved),a.triangles=b.getTriangles(a.rect),b.updateBuffer(this.ctx,a,this.program),p=!0):"vertices"===c?(_.isUndefined(j)||(a.closed=j),_.isUndefined(k)||(a.curved=k),m?a.commands=l(f,a.curved,a.closed):(a.vertices=l(f,a.curved,a.closed),a.commands=a.vertices),a.rect=b.getBoundingClientRect(a.vertices,a.linewidth,a.curved),a.triangles=b.getTriangles(a.rect),b.updateBuffer(this.ctx,a,this.program),p=!0):a[c]=f;p&&a.updateTexture(this.ctx)}});_.extend(f.prototype,Backbone.Events,q.prototype,
{setSize:function(a,b){q.prototype.setSize.apply(this,arguments);this.ctx.viewport(0,0,a,b);var c=this.ctx.getUniformLocation(this.program,"u_resolution");this.ctx.uniform2f(c,a,b);return this},render:function(){if(_.isNull(this.stage))return this;this.stage.render(this.ctx,this.program);return this}})})();(function(){var q=Two.Shape=function(k){this._matrix=new Two.Matrix;var l=_.bind(function(){var k=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",k,this.scale)},this);this._rotation="rotation";Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(k){this._rotation=k;l()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(k){this._scale=k;l()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,l);if(k)return this;q.MakeGetterSetter(this,q.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.join=this.cap="round";this.miter=1};_.extend(q,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(k,l){_.isArray(l)||(l=[l]);_.each(l,function(l){var j="_"+l;Object.defineProperty(k,
l,{get:function(){return this[j]},set:function(c){this[j]=c;this.trigger(Two.Events.change,this.id,l,c,this)}})})}});_.extend(q.prototype,Backbone.Events,{addTo:function(k){k.add(this);return this},noFill:function(){this.fill="none";return this},noStroke:function(){this.stroke="none";return this},clone:function(){var k=new q;k.translation.copy(this.translation);_.each(q.Properties,function(l){k[l]=this[l]},this);return this}})})();(function(){var q=Two.Group=function(){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;q.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(q,{MakeGetterSetter:function(k,l){_.isArray(l)||(l=[l]);_.each(l,function(l){var j="_"+l;Object.defineProperty(k,l,{get:function(){return this[j]},set:function(c){this[j]=c;_.each(this.children,function(b){b[l]=c})}})})}});_.extend(q.prototype,
Two.Shape.prototype,{add:function(k){var l=k,p=this.children,j=this.parent,c=[];_.isArray(k)||(l=_.toArray(arguments));var b=_.bind(function(b,a,c,j,k,l){this.trigger(Two.Events.change,b,a,c,j,k,l)},this);_.each(l,function(f){var a=f.id,d=f.parent;_.isUndefined(a)&&(j.add(f),a=f.id);_.isUndefined(p[a])&&(d&&delete d.children[a],p[a]=f,f.parent=this,f.unbind(Two.Events.change).bind(Two.Events.change,b),c.push(a))},this);0<c.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,c);
return this},center:function(){var k=this.getBoundingClientRect();k.centroid={x:k.left+k.width/2,y:k.top+k.height/2};_.each(this.children,function(l){l.translation.subSelf(k.centroid)});this.translation.copy(k.centroid);return this},remove:function(k){var l=k,p=this.children,j=this.parent,c=[];if(0>=arguments.length&&j)return j.remove(this),this;_.isArray(k)||(l=_.toArray(arguments));_.each(l,function(b){var f=b.id;f in p&&(delete p[f],b.unbind(Two.Events.change),c.push(f))});0<c.length&&this.trigger(Two.Events.change,
this.id,Two.Properties.demotion,c);return this},getBoundingClientRect:function(){var k=Infinity,l=-Infinity,p=Infinity,j=-Infinity;_.each(this.children,function(b){b=b.getBoundingClientRect();p=Math.min(b.top,p);k=Math.min(b.left,k);l=Math.max(b.right,l);j=Math.max(b.bottom,j)},this);var c=this._matrix.multiply(k,p,1),b=this._matrix.multiply(l,j,1);return{top:c.y,left:c.x,right:b.x,bottom:b.y,width:b.x-c.x,height:b.y-c.y}},noFill:function(){_.each(this.children,function(k){k.noFill()});return this},
noStroke:function(){_.each(this.children,function(k){k.noStroke()});return this}})})();(function(){var q=Math.min,k=Math.max,l=Math.round,p=Two.Polygon=function(j,c,b){Two.Shape.call(this);c=!!c;b=!!b;var f=0,a=1,d=!1,p=j.slice(0),u=_.bind(function(){var j,k;if(d){j=this.vertices.length;j-=1;k=l(f*j);j=l(a*j);for(p.length=0;k<j+1;k++){var q=this.vertices[k];p.push(new Two.Vector(q.x,q.y))}}this.trigger(Two.Events.change,this.id,"vertices",p,c,b,d);d=!1},this);Object.defineProperty(this,"closed",{get:function(){return c},set:function(a){c=!!a;u()}});Object.defineProperty(this,"curved",
{get:function(){return b},set:function(a){b=!!a;u()}});Object.defineProperty(this,"beginning",{get:function(){return f},set:function(a){f=q(k(a,0),1);d=!0;u()}});Object.defineProperty(this,"ending",{get:function(){return a},set:function(b){a=q(k(b,0),1);d=!0;u()}});this.vertices=j.slice(0);_.each(this.vertices,function(a){a.bind(Two.Events.change,u)},this);u()};_.extend(p,{});_.extend(p.prototype,Two.Shape.prototype,{clone:function(){var j=_.map(this.vertices,function(b){return new Two.Vector(b.x,
b.y)}),c=new p(j,this.closed,this.curved);_.each(Two.Shape.Properties,function(b){c[b]=this[b]},this);c.translation.copy(this.translation);c.rotation=this.rotation;c.scale=this.scale;return c},center:function(){var j=this.getBoundingClientRect();j.centroid={x:j.left+j.width/2,y:j.top+j.height/2};_.each(this.vertices,function(c){c.subSelf(j.centroid)});this.translation.addSelf(j.centroid);return this},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(){var j=
this.linewidth,c=Infinity,b=-Infinity,f=Infinity,a=-Infinity;_.each(this.vertices,function(d){var j=d.x;d=d.y;f=Math.min(d,f);c=Math.min(j,c);b=Math.max(j,b);a=Math.max(d,a)});var f=f-j,c=c-j,b=b+j,a=a+j,j=this._matrix.multiply(c,f,1),d=this._matrix.multiply(b,a,1);return{top:j.y,left:j.x,right:d.x,bottom:d.y,width:d.x-j.x,height:d.y-j.y}}})})();
