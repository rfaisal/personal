(function(){function p(a,b,c){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a._chain&&(a=a._wrapped);b._chain&&(b=b._wrapped);if(a.isEqual&&e.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&e.isFunction(b.isEqual))return b.isEqual(a);var f=k.call(a);if(f!=k.call(b))return!1;switch(f){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==
b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var d=c.length;d--;)if(c[d]==a)return!0;c.push(a);var d=0,g=!0;if("[object Array]"==f){if(d=a.length,g=d==b.length)for(;d--&&(g=d in a==d in b&&p(a[d],b[d],c)););}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(e.has(a,h)&&(d++,!(g=e.has(b,h)&&p(a[h],b[h],c))))break;if(g){for(h in b)if(e.has(b,h)&&!d--)break;
g=!d}}c.pop();return g}var a=this,b=a._,c={},d=Array.prototype,g=Object.prototype,h=d.slice,f=d.unshift,k=g.toString,n=g.hasOwnProperty,q=d.forEach,r=d.map,s=d.reduce,j=d.reduceRight,l=d.filter,m=d.every,t=d.some,u=d.indexOf,w=d.lastIndexOf,g=Array.isArray,y=Object.keys,v=Function.prototype.bind,e=function(a){return new E(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=e),exports._=e):a._=e;e.VERSION="1.3.3";var z=e.each=e.forEach=function(a,
b,f){if(null!=a)if(q&&a.forEach===q)a.forEach(b,f);else if(a.length===+a.length)for(var d=0,g=a.length;d<g&&!(d in a&&b.call(f,a[d],d,a)===c);d++);else for(d in a)if(e.has(a,d)&&b.call(f,a[d],d,a)===c)break};e.map=e.collect=function(a,b,e){var c=[];if(null==a)return c;if(r&&a.map===r)return a.map(b,e);z(a,function(a,A,f){c[c.length]=b.call(e,a,A,f)});a.length===+a.length&&(c.length=a.length);return c};e.reduce=e.foldl=e.inject=function(a,b,c,f){var d=2<arguments.length;null==a&&(a=[]);if(s&&a.reduce===
s)return f&&(b=e.bind(b,f)),d?a.reduce(b,c):a.reduce(b);z(a,function(a,e,A){d?c=b.call(f,c,a,e,A):(c=a,d=!0)});if(!d)throw new TypeError("Reduce of empty array with no initial value");return c};e.reduceRight=e.foldr=function(a,b,c,f){var d=2<arguments.length;null==a&&(a=[]);if(j&&a.reduceRight===j)return f&&(b=e.bind(b,f)),d?a.reduceRight(b,c):a.reduceRight(b);var g=e.toArray(a).reverse();f&&!d&&(b=e.bind(b,f));return d?e.reduce(g,b,c,f):e.reduce(g,b)};e.find=e.detect=function(a,b,e){var c;F(a,function(a,
A,f){if(b.call(e,a,A,f))return c=a,!0});return c};e.filter=e.select=function(a,b,e){var c=[];if(null==a)return c;if(l&&a.filter===l)return a.filter(b,e);z(a,function(a,f,A){b.call(e,a,f,A)&&(c[c.length]=a)});return c};e.reject=function(a,b,e){var c=[];if(null==a)return c;z(a,function(a,f,A){b.call(e,a,f,A)||(c[c.length]=a)});return c};e.every=e.all=function(a,b,e){var f=!0;if(null==a)return f;if(m&&a.every===m)return a.every(b,e);z(a,function(a,A,d){if(!(f=f&&b.call(e,a,A,d)))return c});return!!f};
var F=e.some=e.any=function(a,b,f){b||(b=e.identity);var d=!1;if(null==a)return d;if(t&&a.some===t)return a.some(b,f);z(a,function(a,e,A){if(d||(d=b.call(f,a,e,A)))return c});return!!d};e.include=e.contains=function(a,b){var e=!1;return null==a?e:u&&a.indexOf===u?-1!=a.indexOf(b):e=F(a,function(a){return a===b})};e.invoke=function(a,b){var c=h.call(arguments,2);return e.map(a,function(a){return(e.isFunction(b)?b||a:a[b]).apply(a,c)})};e.pluck=function(a,b){return e.map(a,function(a){return a[b]})};
e.max=function(a,b,c){if(!b&&e.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&e.isEmpty(a))return-Infinity;var f={computed:-Infinity};z(a,function(a,e,d){e=b?b.call(c,a,e,d):a;e>=f.computed&&(f={value:a,computed:e})});return f.value};e.min=function(a,b,c){if(!b&&e.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&e.isEmpty(a))return Infinity;var f={computed:Infinity};z(a,function(a,e,d){e=b?b.call(c,a,e,d):a;e<f.computed&&(f={value:a,computed:e})});return f.value};e.shuffle=
function(a){var b=[],e;z(a,function(a,c){e=Math.floor(Math.random()*(c+1));b[c]=b[e];b[e]=a});return b};e.sortBy=function(a,b,c){var f=e.isFunction(b)?b:function(a){return a[b]};return e.pluck(e.map(a,function(a,b,e){return{value:a,criteria:f.call(c,a,b,e)}}).sort(function(a,b){var e=a.criteria,c=b.criteria;return void 0===e?1:void 0===c?-1:e<c?-1:e>c?1:0}),"value")};e.groupBy=function(a,b){var c={},f=e.isFunction(b)?b:function(a){return a[b]};z(a,function(a,b){var e=f(a,b);(c[e]||(c[e]=[])).push(a)});
return c};e.sortedIndex=function(a,b,c){c||(c=e.identity);for(var f=0,d=a.length;f<d;){var g=f+d>>1;c(a[g])<c(b)?f=g+1:d=g}return f};e.toArray=function(a){return!a?[]:e.isArray(a)||e.isArguments(a)?h.call(a):a.toArray&&e.isFunction(a.toArray)?a.toArray():e.values(a)};e.size=function(a){return e.isArray(a)?a.length:e.keys(a).length};e.first=e.head=e.take=function(a,b,e){return null!=b&&!e?h.call(a,0,b):a[0]};e.initial=function(a,b,e){return h.call(a,0,a.length-(null==b||e?1:b))};e.last=function(a,
b,e){return null!=b&&!e?h.call(a,Math.max(a.length-b,0)):a[a.length-1]};e.rest=e.tail=function(a,b,e){return h.call(a,null==b||e?1:b)};e.compact=function(a){return e.filter(a,function(a){return!!a})};e.flatten=function(a,b){return e.reduce(a,function(a,c){if(e.isArray(c))return a.concat(b?c:e.flatten(c));a[a.length]=c;return a},[])};e.without=function(a){return e.difference(a,h.call(arguments,1))};e.uniq=e.unique=function(a,b,c){c=c?e.map(a,c):a;var f=[];3>a.length&&(b=!0);e.reduce(c,function(c,d,
g){if(b?e.last(c)!==d||!c.length:!e.include(c,d))c.push(d),f.push(a[g]);return c},[]);return f};e.union=function(){return e.uniq(e.flatten(arguments,!0))};e.intersection=e.intersect=function(a){var b=h.call(arguments,1);return e.filter(e.uniq(a),function(a){return e.every(b,function(b){return 0<=e.indexOf(b,a)})})};e.difference=function(a){var b=e.flatten(h.call(arguments,1),!0);return e.filter(a,function(a){return!e.include(b,a)})};e.zip=function(){for(var a=h.call(arguments),b=e.max(e.pluck(a,"length")),
c=Array(b),f=0;f<b;f++)c[f]=e.pluck(a,""+f);return c};e.indexOf=function(a,b,c){if(null==a)return-1;var f;if(c)return c=e.sortedIndex(a,b),a[c]===b?c:-1;if(u&&a.indexOf===u)return a.indexOf(b);c=0;for(f=a.length;c<f;c++)if(c in a&&a[c]===b)return c;return-1};e.lastIndexOf=function(a,b){if(null==a)return-1;if(w&&a.lastIndexOf===w)return a.lastIndexOf(b);for(var e=a.length;e--;)if(e in a&&a[e]===b)return e;return-1};e.range=function(a,b,e){1>=arguments.length&&(b=a||0,a=0);e=arguments[2]||1;for(var c=
Math.max(Math.ceil((b-a)/e),0),f=0,d=Array(c);f<c;)d[f++]=a,a+=e;return d};var R=function(){};e.bind=function(a,b){var c,f;if(a.bind===v&&v)return v.apply(a,h.call(arguments,1));if(!e.isFunction(a))throw new TypeError;f=h.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,f.concat(h.call(arguments)));R.prototype=a.prototype;var e=new R,d=a.apply(e,f.concat(h.call(arguments)));return Object(d)===d?d:e}};e.bindAll=function(a){var b=h.call(arguments,1);0==b.length&&(b=e.functions(a));
z(b,function(b){a[b]=e.bind(a[b],a)});return a};e.memoize=function(a,b){var c={};b||(b=e.identity);return function(){var f=b.apply(this,arguments);return e.has(c,f)?c[f]:c[f]=a.apply(this,arguments)}};e.delay=function(a,b){var e=h.call(arguments,2);return setTimeout(function(){return a.apply(null,e)},b)};e.defer=function(a){return e.delay.apply(e,[a,1].concat(h.call(arguments,1)))};e.throttle=function(a,b){var c,f,d,g,h,m,k=e.debounce(function(){h=g=!1},b);return function(){c=this;f=arguments;d||
(d=setTimeout(function(){d=null;h&&a.apply(c,f);k()},b));g?h=!0:m=a.apply(c,f);k();g=!0;return m}};e.debounce=function(a,b,e){var c;return function(){var f=this,d=arguments;e&&!c&&a.apply(f,d);clearTimeout(c);c=setTimeout(function(){c=null;e||a.apply(f,d)},b)}};e.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}};e.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments,0));return b.apply(this,c)}};e.compose=function(){var a=arguments;
return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};e.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};e.keys=y||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)e.has(a,c)&&(b[b.length]=c);return b};e.values=function(a){return e.map(a,e.identity)};e.functions=e.methods=function(a){var b=[],c;for(c in a)e.isFunction(a[c])&&b.push(c);return b.sort()};e.extend=function(a){z(h.call(arguments,
1),function(b){for(var c in b)a[c]=b[c]});return a};e.pick=function(a){var b={};z(e.flatten(h.call(arguments,1)),function(c){c in a&&(b[c]=a[c])});return b};e.defaults=function(a){z(h.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])});return a};e.clone=function(a){return!e.isObject(a)?a:e.isArray(a)?a.slice():e.extend({},a)};e.tap=function(a,b){b(a);return a};e.isEqual=function(a,b){return p(a,b,[])};e.isEmpty=function(a){if(null==a)return!0;if(e.isArray(a)||e.isString(a))return 0===
a.length;for(var b in a)if(e.has(a,b))return!1;return!0};e.isElement=function(a){return!!(a&&1==a.nodeType)};e.isArray=g||function(a){return"[object Array]"==k.call(a)};e.isObject=function(a){return a===Object(a)};e.isArguments=function(a){return"[object Arguments]"==k.call(a)};e.isArguments(arguments)||(e.isArguments=function(a){return!(!a||!e.has(a,"callee"))});e.isFunction=function(a){return"[object Function]"==k.call(a)};e.isString=function(a){return"[object String]"==k.call(a)};e.isNumber=function(a){return"[object Number]"==
k.call(a)};e.isFinite=function(a){return e.isNumber(a)&&isFinite(a)};e.isNaN=function(a){return a!==a};e.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==k.call(a)};e.isDate=function(a){return"[object Date]"==k.call(a)};e.isRegExp=function(a){return"[object RegExp]"==k.call(a)};e.isNull=function(a){return null===a};e.isUndefined=function(a){return void 0===a};e.has=function(a,b){return n.call(a,b)};e.noConflict=function(){a._=b;return this};e.identity=function(a){return a};e.times=
function(a,b,c){for(var e=0;e<a;e++)b.call(c,e)};e.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};e.result=function(a,b){if(null==a)return null;var c=a[b];return e.isFunction(c)?c.call(a):c};e.mixin=function(a){z(e.functions(a),function(b){var c=e[b]=a[b];E.prototype[b]=function(){var a=h.call(arguments);f.call(a,this._wrapped);return J(c.apply(e,a),this._chain)}})};var S=0;e.uniqueId=
function(a){var b=S++;return a?a+b:b};e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/.^/,I={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},L;for(L in I)I[I[L]]=L;var T=/\\|'|\r|\n|\t|\u2028|\u2029/g,U=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(a){return a.replace(U,function(a,b){return I[b]})};e.template=function(a,b,c){c=e.defaults(c||{},e.templateSettings);a="__p+='"+a.replace(T,function(a){return"\\"+I[a]}).replace(c.escape||
K,function(a,b){return"'+\n_.escape("+M(b)+")+\n'"}).replace(c.interpolate||K,function(a,b){return"'+\n("+M(b)+")+\n'"}).replace(c.evaluate||K,function(a,b){return"';\n"+M(b)+"\n;__p+='"})+"';\n";c.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var f=new Function(c.variable||"obj","_",a);if(b)return f(b,e);b=function(a){return f.call(this,a,e)};b.source="function("+(c.variable||"obj")+"){\n"+a+"}";return b};
e.chain=function(a){return e(a).chain()};var E=function(a){this._wrapped=a};e.prototype=E.prototype;var J=function(a,b){return b?e(a).chain():a};e.mixin(e);z("pop push reverse shift sort splice unshift".split(" "),function(a){var b=d[a];E.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var e=c.length;("shift"==a||"splice"==a)&&0===e&&delete c[0];return J(c,this._chain)}});z(["concat","join","slice"],function(a){var b=d[a];E.prototype[a]=function(){return J(b.apply(this._wrapped,arguments),
this._chain)}});E.prototype.chain=function(){this._chain=!0;return this};E.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};
(function(){var p=[].slice,a=/\s+/,b=function(b,c,f,d){if(!f)return!0;if("object"===typeof f)for(var n in f)b[c].apply(b,[n,f[n]].concat(d));else if(a.test(f)){f=f.split(a);n=0;for(var q=f.length;n<q;n++)b[c].apply(b,[f[n]].concat(d))}else return!0},c=function(a,b,c){var d;a=-1;var n=b.length;switch(c.length){case 0:for(;++a<n;)(d=b[a]).callback.call(d.ctx);break;case 1:for(;++a<n;)(d=b[a]).callback.call(d.ctx,c[0]);break;case 2:for(;++a<n;)(d=b[a]).callback.call(d.ctx,c[0],c[1]);break;case 3:for(;++a<
n;)(d=b[a]).callback.call(d.ctx,c[0],c[1],c[2]);break;default:for(;++a<n;)(d=b[a]).callback.apply(d.ctx,c)}},d=Backbone.Events={on:function(a,c,f){if(!b(this,"on",a,[c,f])||!c)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:c,context:f,ctx:f||this});return this},once:function(a,c,f){if(!b(this,"once",a,[c,f])||!c)return this;var d=this,n=_.once(function(){d.off(a,n);c.apply(this,arguments)});n._callback=c;this.on(a,n,f);return this},off:function(a,
c,f){var d,n,q,r,s,j,l,m;if(!this._events||!b(this,"off",a,[c,f]))return this;if(!a&&!c&&!f)return this._events={},this;r=a?[a]:_.keys(this._events);s=0;for(j=r.length;s<j;s++)if(a=r[s],d=this._events[a]){q=[];if(c||f){l=0;for(m=d.length;l<m;l++)n=d[l],(c&&c!==(n.callback._callback||n.callback)||f&&f!==n.context)&&q.push(n)}this._events[a]=q}return this},trigger:function(a){if(!this._events)return this;var d=p.call(arguments,1);if(!b(this,"trigger",a,d))return this;var f=this._events[a],k=this._events.all;
f&&c(this,f,d);k&&c(this,k,arguments);return this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),n=a._listenerId||(a._listenerId=_.uniqueId("l"));d[n]=a;a.on(b,c||this,this);return this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a)a.off(b,c,this),!b&&!c&&delete d[a._listenerId];else{for(var n in d)d[n].off(null,null,this);this._listeners={}}return this}}};d.bind=d.on;d.unbind=d.off})();(function(){for(var p=0,a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),g=Math.max(0,16-(b-p)),h=window.setTimeout(function(){a(b+g)},g);p=b+g;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();(function(){var p=this;previousTessellation=p.tessellation;tessellation=p.tessellation={noConflict:function(){p.tessellation=previousTessellation;return this}};tessellation.cmp=function(a,b){return a.y==b.y?a.x-b.x:a.y-b.y};tessellation.equals=function(a,b){return a.x==b.x&&a.y==b.y};tessellation.Edge=function(){this.q=this.p=null;2==arguments.length?arguments[0].y>arguments[1].y?(this.q=arguments[0],this.p=arguments[1]):arguments[0].y==arguments[1].y?arguments[0].x>arguments[1].x?(this.q=arguments[0],
this.p=arguments[1]):arguments[0].x==arguments[1].x?alert("Invalid tessellation.edge constructor call: repeated points!"):(this.p=arguments[0],this.q=arguments[1]):(this.p=arguments[0],this.q=arguments[1]):alert("Invalid tessellation.Edge constructor call!");this.p&&!_.isArray(this.p.edges)&&(this.p.edges=[]);this.q&&!_.isArray(this.q.edges)&&(this.q.edges=[]);this.q.edges.push(this)};tessellation.Triangle=function(a,b,c){this.points=[null,null,null];this.neighbors=[null,null,null];this.interior=
!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1];3==arguments.length&&(this.points[0]=a,this.points[1]=b,this.points[2]=c)};tessellation.Triangle.prototype.GetPoint=function(a){return this.points[a]};tessellation.Triangle.prototype.GetNeighbor=function(a){return this.neighbors[a]};tessellation.Triangle.prototype.ContainsP=function(){for(var a=!0,b=0;b<arguments.length;++b)a=a&&(arguments[b].equals(this.points[0])||arguments[b].equals(this.points[1])||arguments[b].equals(this.points[2]));
return a};tessellation.Triangle.prototype.ContainsE=function(){for(var a=!0,b=0;b<arguments.length;++b)a=a&&this.ContainsP(arguments[b].p,arguments[b].q);return a};tessellation.Triangle.prototype.IsInterior=function(){0!=arguments.length&&(this.interior=arguments[0]);return this.interior};tessellation.Triangle.prototype.MarkNeighbor=function(){var a;if(3==arguments.length){var b=arguments[0],c=arguments[1];a=arguments[2];b.equals(this.points[2])&&c.equals(this.points[1])||b.equals(this.points[1])&&
c.equals(this.points[2])?this.neighbors[0]=a:b.equals(this.points[0])&&c.equals(this.points[2])||b.equals(this.points[2])&&c.equals(this.points[0])?this.neighbors[1]=a:b.equals(this.points[0])&&c.equals(this.points[1])||b.equals(this.points[1])&&c.equals(this.points[0])?this.neighbors[2]=a:alert("Invalid tessellation.Triangle.MarkNeighbor call (1)!")}else 1==arguments.length?(a=arguments[0],a.ContainsP(this.points[1],this.points[2])?(this.neighbors[0]=a,a.MarkNeighbor(this.points[1],this.points[2],
this)):a.ContainsP(this.points[0],this.points[2])?(this.neighbors[1]=a,a.MarkNeighbor(this.points[0],this.points[2],this)):a.ContainsP(this.points[0],this.points[1])&&(this.neighbors[2]=a,a.MarkNeighbor(this.points[0],this.points[1],this))):alert("Invalid tessellation.Triangle.MarkNeighbor call! (2)")};tessellation.Triangle.prototype.ClearNeigbors=function(){this.neighbors[0]=null;this.neighbors[1]=null;this.neighbors[2]=null};tessellation.Triangle.prototype.ClearDelunayEdges=function(){this.delaunay_edge[0]=
!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};tessellation.Triangle.prototype.PointCW=function(a){return a.equals(this.points[0])?this.points[2]:a.equals(this.points[1])?this.points[0]:a.equals(this.points[2])?this.points[1]:null};tessellation.Triangle.prototype.PointCCW=function(a){return a.equals(this.points[0])?this.points[1]:a.equals(this.points[1])?this.points[2]:a.equals(this.points[2])?this.points[0]:null};tessellation.Triangle.prototype.NeighborCW=function(a){return a.equals(this.points[0])?
this.neighbors[1]:a.equals(this.points[1])?this.neighbors[2]:this.neighbors[0]};tessellation.Triangle.prototype.NeighborCCW=function(a){return a.equals(this.points[0])?this.neighbors[2]:a.equals(this.points[1])?this.neighbors[0]:this.neighbors[1]};tessellation.Triangle.prototype.GetConstrainedEdgeCW=function(a){return a.equals(this.points[0])?this.constrained_edge[1]:a.equals(this.points[1])?this.constrained_edge[2]:this.constrained_edge[0]};tessellation.Triangle.prototype.GetConstrainedEdgeCCW=function(a){return a.equals(this.points[0])?
this.constrained_edge[2]:a.equals(this.points[1])?this.constrained_edge[0]:this.constrained_edge[1]};tessellation.Triangle.prototype.SetConstrainedEdgeCW=function(a,b){a.equals(this.points[0])?this.constrained_edge[1]=b:a.equals(this.points[1])?this.constrained_edge[2]=b:this.constrained_edge[0]=b};tessellation.Triangle.prototype.SetConstrainedEdgeCCW=function(a,b){a.equals(this.points[0])?this.constrained_edge[2]=b:a.equals(this.points[1])?this.constrained_edge[0]=b:this.constrained_edge[1]=b};tessellation.Triangle.prototype.GetDelaunayEdgeCW=
function(a){return a.equals(this.points[0])?this.delaunay_edge[1]:a.equals(this.points[1])?this.delaunay_edge[2]:this.delaunay_edge[0]};tessellation.Triangle.prototype.GetDelaunayEdgeCCW=function(a){return a.equals(this.points[0])?this.delaunay_edge[2]:a.equals(this.points[1])?this.delaunay_edge[0]:this.delaunay_edge[1]};tessellation.Triangle.prototype.SetDelaunayEdgeCW=function(a,b){a.equals(this.points[0])?this.delaunay_edge[1]=b:a.equals(this.points[1])?this.delaunay_edge[2]=b:this.delaunay_edge[0]=
b};tessellation.Triangle.prototype.SetDelaunayEdgeCCW=function(a,b){a.equals(this.points[0])?this.delaunay_edge[2]=b:a.equals(this.points[1])?this.delaunay_edge[0]=b:this.delaunay_edge[1]=b};tessellation.Triangle.prototype.NeighborAcross=function(a){return a.equals(this.points[0])?this.neighbors[0]:a.equals(this.points[1])?this.neighbors[1]:this.neighbors[2]};tessellation.Triangle.prototype.OppositePoint=function(a,b){var c=a.PointCW(b);return this.PointCW(c)};tessellation.Triangle.prototype.Legalize=
function(){if(1==arguments.length)this.Legalize(this.points[0],arguments[0]);else if(2==arguments.length){var a=arguments[0],b=arguments[1];a.equals(this.points[0])?(this.points[1]=this.points[0],this.points[0]=this.points[2],this.points[2]=b):a.equals(this.points[1])?(this.points[2]=this.points[1],this.points[1]=this.points[0],this.points[0]=b):a.equals(this.points[2])?(this.points[0]=this.points[2],this.points[2]=this.points[1],this.points[1]=b):alert("Invalid tessellation.Triangle.Legalize call!")}else alert("Invalid tessellation.Triangle.Legalize call!")};
tessellation.Triangle.prototype.Index=function(a){return a.equals(this.points[0])?0:a.equals(this.points[1])?1:a.equals(this.points[2])?2:-1};tessellation.Triangle.prototype.EdgeIndex=function(a,b){if(a.equals(this.points[0])){if(b.equals(this.points[1]))return 2;if(b.equals(this.points[2]))return 1}else if(a.equals(this.points[1])){if(b.equals(this.points[2]))return 0;if(b.equals(this.points[0]))return 2}else if(a.equals(this.points[2])){if(b.equals(this.points[0]))return 1;if(b.equals(this.points[1]))return 0}return-1};
tessellation.Triangle.prototype.MarkConstrainedEdge=function(){if(1==arguments.length)"number"==typeof arguments[0]?this.constrained_edge[arguments[0]]=!0:this.MarkConstrainedEdge(arguments[0].p,arguments[0].q);else if(2==arguments.length){var a=arguments[0],b=arguments[1];if(b.equals(this.points[0])&&a.equals(this.points[1])||b.equals(this.points[1])&&a.equals(this.points[0]))this.constrained_edge[2]=!0;else if(b.equals(this.points[0])&&a.equals(this.points[2])||b.equals(this.points[2])&&a.equals(this.points[0]))this.constrained_edge[1]=
!0;else if(b.equals(this.points[1])&&a.equals(this.points[2])||b.equals(this.points[2])&&a.equals(this.points[1]))this.constrained_edge[0]=!0}else alert("Invalid tessellation.Triangle.MarkConstrainedEdge call!")};tessellation.PI_3div4=3*Math.PI/4;tessellation.PI_2=Math.PI/2;tessellation.EPSILON=1E-12;tessellation.kAlpha=0.3;tessellation.Orientation={CW:1,CCW:-1,COLLINEAR:0};tessellation.Orient2d=function(a,b,c){a=(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x);return a>-tessellation.EPSILON&&a<tessellation.EPSILON?
tessellation.Orientation.COLLINEAR:0<a?tessellation.Orientation.CCW:tessellation.Orientation.CW};tessellation.InScanArea=function(a,b,c,d){var g=d.x;d=d.y;var h=a.x-g;a=a.y-d;return h*(b.y-d)-(b.x-g)*a<=tessellation.EPSILON||(c.x-g)*a-h*(c.y-d)<=tessellation.EPSILON?!1:!0};tessellation.Node=function(){this.prev=this.next=this.triangle=this.point=null;this.value=0;1==arguments.length?(this.point=arguments[0],this.value=this.point.x):2==arguments.length?(this.point=arguments[0],this.triangle=arguments[1],
this.value=this.point.x):alert("Invalid tessellation.Node constructor call!")};tessellation.AdvancingFront=function(a,b){this.head=a;this.tail=b;this.search_node=a};tessellation.AdvancingFront.prototype.search=function(){return this.search_node};tessellation.AdvancingFront.prototype.set_search=function(a){this.search_node=a};tessellation.AdvancingFront.prototype.FindSearchNode=function(){return this.search_node};tessellation.AdvancingFront.prototype.LocateNode=function(a){var b=this.search_node;if(a<
b.value)for(;null!=(b=b.prev);){if(a>=b.value)return this.search_node=b}else for(;null!=(b=b.next);)if(a<b.value)return this.search_node=b.prev;return null};tessellation.AdvancingFront.prototype.LocatePoint=function(a){var b=a.x,c=this.FindSearchNode(b),d=c.point.x;if(b==d)if(c.prev&&a.equals(c.prev.point))c=c.prev;else if(c.next&&a.equals(c.next.point))c=c.next;else{if(!a.equals(c.point))return alert("Invalid tessellation.AdvancingFront.LocatePoint call!"),null}else if(b<d)for(;null!=(c=c.prev)&&
!a.equals(c.point););else for(;null!=(c=c.next)&&!a.equals(c.point););null!=c&&(this.search_node=c);return c};tessellation.Basin=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};tessellation.Basin.prototype.Clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};tessellation.EdgeEvent=function(){this.constrained_edge=null;this.right=!1};tessellation.SweepContext=function(a){this.triangles=[];this.map=
[];this.points=a;this.edges=[];this.af_tail=this.af_middle_=this.af_head=this.tail=this.head=this.front=null;this.basin=new tessellation.Basin;this.edge_event=new tessellation.EdgeEvent;this.InitEdges(this.points)};tessellation.SweepContext.prototype.AddHole=function(a){this.InitEdges(a);for(var b in a)this.points.push(a[b])};tessellation.SweepContext.prototype.point_count=function(){return this.points.length};tessellation.SweepContext.prototype.GetTriangles=function(){return this.triangles};tessellation.SweepContext.prototype.GetMap=
function(){return this.map};tessellation.SweepContext.prototype.InitTriangulation=function(){var a=this.points[0].x,b=this.points[0].x,c=this.points[0].y,d=this.points[0].y,g;for(g in this.points){var h=this.points[g];h.x>a&&(a=h.x);h.x<b&&(b=h.x);h.y>c&&(c=h.y);h.y<d&&(d=h.y)}c=tessellation.kAlpha*(c-d);this.head=new Two.Vector(a+tessellation.kAlpha*(a-b),d-c);this.tail=new Two.Vector(b-c,d-c);this.points.sort(tessellation.cmp)};tessellation.SweepContext.prototype.InitEdges=function(a){for(var b=
0;b<a.length;++b)this.edges.push(new tessellation.Edge(a[b],a[(b+1)%a.length]))};tessellation.SweepContext.prototype.GetPoint=function(a){return this.points[a]};tessellation.SweepContext.prototype.AddToMap=function(a){this.map.push(a)};tessellation.SweepContext.prototype.LocateNode=function(a){return this.front.LocateNode(a.x)};tessellation.SweepContext.prototype.CreateAdvancingFront=function(){var a,b,c;c=new tessellation.Triangle(this.points[0],this.tail,this.head);this.map.push(c);a=new tessellation.Node(c.GetPoint(1),
c);b=new tessellation.Node(c.GetPoint(0),c);c=new tessellation.Node(c.GetPoint(2));this.front=new tessellation.AdvancingFront(a,c);a.next=b;b.next=c;b.prev=a;c.prev=b};tessellation.SweepContext.prototype.RemoveNode=function(){};tessellation.SweepContext.prototype.MapTriangleToNodes=function(a){for(var b=0;3>b;++b)if(null==a.GetNeighbor(b)){var c=this.front.LocatePoint(a.PointCW(a.GetPoint(b)));null!=c&&(c.triangle=a)}};tessellation.SweepContext.prototype.RemoveFromMap=function(a){for(var b in this.map)if(this.map[b]==
a){delete this.map[b];break}};tessellation.SweepContext.prototype.MeshClean=function(a){if(null!=a&&!a.IsInterior()){a.IsInterior(!0);this.triangles.push(a);for(var b=0;3>b;++b)a.constrained_edge[b]||this.MeshClean(a.GetNeighbor(b))}};tessellation.sweep={};tessellation.sweep.Triangulate=function(a){a.InitTriangulation();a.CreateAdvancingFront();tessellation.sweep.SweepPoints(a);tessellation.sweep.FinalizationPolygon(a)};tessellation.sweep.SweepPoints=function(a){for(var b=1;b<a.point_count();++b)for(var c=
a.GetPoint(b),d=tessellation.sweep.PointEvent(a,c),g=0;g<c.edges.length;++g)tessellation.sweep.EdgeEvent(a,c.edges[g],d)};tessellation.sweep.FinalizationPolygon=function(a){for(var b=a.front.head.next.triangle,c=a.front.head.next.point;!b.GetConstrainedEdgeCW(c);)b=b.NeighborCCW(c);a.MeshClean(b)};tessellation.sweep.PointEvent=function(a,b){var c=a.LocateNode(b),d=tessellation.sweep.NewFrontTriangle(a,b,c);b.x<=c.point.x+tessellation.EPSILON&&tessellation.sweep.Fill(a,c);tessellation.sweep.FillAdvancingFront(a,
d);return d};tessellation.sweep.EdgeEvent=function(){var a;if(3==arguments.length){a=arguments[0];var b=arguments[1],c=arguments[2];a.edge_event.constrained_edge=b;a.edge_event.right=b.p.x>b.q.x;tessellation.sweep.IsEdgeSideOfTriangle(c.triangle,b.p,b.q)||(tessellation.sweep.FillEdgeEvent(a,b,c),tessellation.sweep.EdgeEvent(a,b.p,b.q,c.triangle,b.q))}else if(5==arguments.length){a=arguments[0];var b=arguments[1],c=arguments[2],d=arguments[3],g=arguments[4];if(!tessellation.sweep.IsEdgeSideOfTriangle(d,
b,c)){var h=d.PointCCW(g),h=tessellation.Orient2d(c,h,b);if(h==tessellation.Orientation.COLLINEAR)alert("tessellation.sweep.EdgeEvent: Collinear not supported!");else{var f=d.PointCW(g),f=tessellation.Orient2d(c,f,b);f==tessellation.Orientation.COLLINEAR?alert("tessellation.sweep.EdgeEvent: Collinear not supported!"):h==f?(d=h==tessellation.Orientation.CW?d.NeighborCCW(g):d.NeighborCW(g),tessellation.sweep.EdgeEvent(a,b,c,d,g)):tessellation.sweep.FlipEdgeEvent(a,b,c,d,g)}}}else alert("Invalid tessellation.sweep.EdgeEvent call!")};
tessellation.sweep.IsEdgeSideOfTriangle=function(a,b,c){var d=a.EdgeIndex(b,c);return-1!=d?(a.MarkConstrainedEdge(d),a=a.GetNeighbor(d),null!=a&&a.MarkConstrainedEdge(b,c),!0):!1};tessellation.sweep.NewFrontTriangle=function(a,b,c){var d=new tessellation.Triangle(b,c.point,c.next.point);d.MarkNeighbor(c.triangle);a.AddToMap(d);b=new tessellation.Node(b);b.next=c.next;b.prev=c;c.next.prev=b;c.next=b;tessellation.sweep.Legalize(a,d)||a.MapTriangleToNodes(d);return b};tessellation.sweep.Fill=function(a,
b){var c=new tessellation.Triangle(b.prev.point,b.point,b.next.point);c.MarkNeighbor(b.prev.triangle);c.MarkNeighbor(b.triangle);a.AddToMap(c);b.prev.next=b.next;b.next.prev=b.prev;tessellation.sweep.Legalize(a,c)||a.MapTriangleToNodes(c)};tessellation.sweep.FillAdvancingFront=function(a,b){for(var c=b.next,d;null!=c.next;){d=tessellation.sweep.HoleAngle(c);if(d>tessellation.PI_2||d<-tessellation.PI_2)break;tessellation.sweep.Fill(a,c);c=c.next}for(c=b.prev;null!=c.prev;){d=tessellation.sweep.HoleAngle(c);
if(d>tessellation.PI_2||d<-tessellation.PI_2)break;tessellation.sweep.Fill(a,c);c=c.prev}null!=b.next&&null!=b.next.next&&(d=tessellation.sweep.BasinAngle(b),d<tessellation.PI_3div4&&tessellation.sweep.FillBasin(a,b))};tessellation.sweep.BasinAngle=function(a){return Math.atan2(a.point.y-a.next.next.point.y,a.point.x-a.next.next.point.x)};tessellation.sweep.HoleAngle=function(a){var b=a.next.point.x-a.point.x,c=a.next.point.y-a.point.y,d=a.prev.point.x-a.point.x;a=a.prev.point.y-a.point.y;return Math.atan2(b*
a-c*d,b*d+c*a)};tessellation.sweep.Legalize=function(a,b){for(var c=0;3>c;++c)if(!b.delaunay_edge[c]){var d=b.GetNeighbor(c);if(null!=d){var g=b.GetPoint(c),h=d.OppositePoint(b,g),f=d.Index(h);if(d.constrained_edge[f]||d.delaunay_edge[f])b.constrained_edge[c]=d.constrained_edge[f];else if(tessellation.sweep.Incircle(g,b.PointCCW(g),b.PointCW(g),h))return b.delaunay_edge[c]=!0,d.delaunay_edge[f]=!0,tessellation.sweep.RotateTrianglePair(b,g,d,h),(g=!tessellation.sweep.Legalize(a,b))&&a.MapTriangleToNodes(b),
(g=!tessellation.sweep.Legalize(a,d))&&a.MapTriangleToNodes(d),b.delaunay_edge[c]=!1,d.delaunay_edge[f]=!1,!0}}return!1};tessellation.sweep.Incircle=function(a,b,c,d){var g=a.x-d.x;a=a.y-d.y;var h=b.x-d.x;b=b.y-d.y;var f=g*b-h*a;if(0>=f)return!1;var k=c.x-d.x;c=c.y-d.y;d=k*a-g*c;return 0>=d?!1:0<(g*g+a*a)*(h*c-k*b)+(h*h+b*b)*d+(k*k+c*c)*f};tessellation.sweep.RotateTrianglePair=function(a,b,c,d){var g,h,f,k;g=a.NeighborCCW(b);h=a.NeighborCW(b);f=c.NeighborCCW(d);k=c.NeighborCW(d);var n,q,r,s;n=a.GetConstrainedEdgeCCW(b);
q=a.GetConstrainedEdgeCW(b);r=c.GetConstrainedEdgeCCW(d);s=c.GetConstrainedEdgeCW(d);var j,l,m,t;j=a.GetDelaunayEdgeCCW(b);l=a.GetDelaunayEdgeCW(b);m=c.GetDelaunayEdgeCCW(d);t=c.GetDelaunayEdgeCW(d);a.Legalize(b,d);c.Legalize(d,b);c.SetDelaunayEdgeCCW(b,j);a.SetDelaunayEdgeCW(b,l);a.SetDelaunayEdgeCCW(d,m);c.SetDelaunayEdgeCW(d,t);c.SetConstrainedEdgeCCW(b,n);a.SetConstrainedEdgeCW(b,q);a.SetConstrainedEdgeCCW(d,r);c.SetConstrainedEdgeCW(d,s);a.ClearNeigbors();c.ClearNeigbors();g&&c.MarkNeighbor(g);
h&&a.MarkNeighbor(h);f&&a.MarkNeighbor(f);k&&c.MarkNeighbor(k);a.MarkNeighbor(c)};tessellation.sweep.FillBasin=function(a,b){a.basin.left_node=tessellation.Orient2d(b.point,b.next.point,b.next.next.point)==tessellation.Orientation.CCW?b.next.next:b.next;for(a.basin.bottom_node=a.basin.left_node;null!=a.basin.bottom_node.next&&a.basin.bottom_node.point.y>=a.basin.bottom_node.next.point.y;)a.basin.bottom_node=a.basin.bottom_node.next;if(a.basin.bottom_node!=a.basin.left_node){for(a.basin.right_node=
a.basin.bottom_node;null!=a.basin.right_node.next&&a.basin.right_node.point.y<a.basin.right_node.next.point.y;)a.basin.right_node=a.basin.right_node.next;a.basin.right_node!=a.basin.bottom_node&&(a.basin.width=a.basin.right_node.point.x-a.basin.left_node.point.x,a.basin.left_highest=a.basin.left_node.point.y>a.basin.right_node.point.y,tessellation.sweep.FillBasinReq(a,a.basin.bottom_node))}};tessellation.sweep.FillBasinReq=function(a,b){if(!tessellation.sweep.IsShallow(a,b)){tessellation.sweep.Fill(a,
b);var c;if(!(b.prev==a.basin.left_node&&b.next==a.basin.right_node)){if(b.prev==a.basin.left_node){c=tessellation.Orient2d(b.point,b.next.point,b.next.next.point);if(c==tessellation.Orientation.CW)return;b=b.next}else if(b.next==a.basin.right_node){c=tessellation.Orient2d(b.point,b.prev.point,b.prev.prev.point);if(c==tessellation.Orientation.CCW)return;b=b.prev}else b=b.prev.point.y<b.next.point.y?b.prev:b.next;tessellation.sweep.FillBasinReq(a,b)}}};tessellation.sweep.IsShallow=function(a,b){return a.basin.width>
(a.basin.left_highest?a.basin.left_node.point.y-b.point.y:a.basin.right_node.point.y-b.point.y)?!0:!1};tessellation.sweep.FillEdgeEvent=function(a,b,c){a.edge_event.right?tessellation.sweep.FillRightAboveEdgeEvent(a,b,c):tessellation.sweep.FillLeftAboveEdgeEvent(a,b,c)};tessellation.sweep.FillRightAboveEdgeEvent=function(a,b,c){for(;c.next.point.x<b.p.x;)tessellation.Orient2d(b.q,c.next.point,b.p)==tessellation.Orientation.CCW?tessellation.sweep.FillRightBelowEdgeEvent(a,b,c):c=c.next};tessellation.sweep.FillRightBelowEdgeEvent=
function(a,b,c){c.point.x<b.p.x&&(tessellation.Orient2d(c.point,c.next.point,c.next.next.point)==tessellation.Orientation.CCW?tessellation.sweep.FillRightConcaveEdgeEvent(a,b,c):(tessellation.sweep.FillRightConvexEdgeEvent(a,b,c),tessellation.sweep.FillRightBelowEdgeEvent(a,b,c)))};tessellation.sweep.FillRightConcaveEdgeEvent=function(a,b,c){tessellation.sweep.Fill(a,c.next);c.next.point!=b.p&&(tessellation.Orient2d(b.q,c.next.point,b.p)==tessellation.Orientation.CCW&&tessellation.Orient2d(c.point,
c.next.point,c.next.next.point)==tessellation.Orientation.CCW)&&tessellation.sweep.FillRightConcaveEdgeEvent(a,b,c)};tessellation.sweep.FillRightConvexEdgeEvent=function(a,b,c){tessellation.Orient2d(c.next.point,c.next.next.point,c.next.next.next.point)==tessellation.Orientation.CCW?tessellation.sweep.FillRightConcaveEdgeEvent(a,b,c.next):tessellation.Orient2d(b.q,c.next.next.point,b.p)==tessellation.Orientation.CCW&&tessellation.sweep.FillRightConvexEdgeEvent(a,b,c.next)};tessellation.sweep.FillLeftAboveEdgeEvent=
function(a,b,c){for(;c.prev.point.x>b.p.x;)tessellation.Orient2d(b.q,c.prev.point,b.p)==tessellation.Orientation.CW?tessellation.sweep.FillLeftBelowEdgeEvent(a,b,c):c=c.prev};tessellation.sweep.FillLeftBelowEdgeEvent=function(a,b,c){c.point.x>b.p.x&&(tessellation.Orient2d(c.point,c.prev.point,c.prev.prev.point)==tessellation.Orientation.CW?tessellation.sweep.FillLeftConcaveEdgeEvent(a,b,c):(tessellation.sweep.FillLeftConvexEdgeEvent(a,b,c),tessellation.sweep.FillLeftBelowEdgeEvent(a,b,c)))};tessellation.sweep.FillLeftConvexEdgeEvent=
function(a,b,c){tessellation.Orient2d(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)==tessellation.Orientation.CW?tessellation.sweep.FillLeftConcaveEdgeEvent(a,b,c.prev):tessellation.Orient2d(b.q,c.prev.prev.point,b.p)==tessellation.Orientation.CW&&tessellation.sweep.FillLeftConvexEdgeEvent(a,b,c.prev)};tessellation.sweep.FillLeftConcaveEdgeEvent=function(a,b,c){tessellation.sweep.Fill(a,c.prev);c.prev.point!=b.p&&(tessellation.Orient2d(b.q,c.prev.point,b.p)==tessellation.Orientation.CW&&
tessellation.Orient2d(c.point,c.prev.point,c.prev.prev.point)==tessellation.Orientation.CW)&&tessellation.sweep.FillLeftConcaveEdgeEvent(a,b,c)};tessellation.sweep.FlipEdgeEvent=function(a,b,c,d,g){var h=d.NeighborAcross(g);if(null==h)alert("[BUG:FIXME] FLIP failed due to missing triangle!");else{var f=h.OppositePoint(d,g);if(tessellation.InScanArea(g,d.PointCCW(g),d.PointCW(g),f))if(tessellation.sweep.RotateTrianglePair(d,g,h,f),a.MapTriangleToNodes(d),a.MapTriangleToNodes(h),g==c&&f==b)c==a.edge_event.constrained_edge.q&&
b==a.edge_event.constrained_edge.p&&(d.MarkConstrainedEdge(b,c),h.MarkConstrainedEdge(b,c),tessellation.sweep.Legalize(a,d),tessellation.sweep.Legalize(a,h));else{var k=tessellation.Orient2d(c,f,b);d=tessellation.sweep.NextFlipTriangle(a,k,d,h,g,f);tessellation.sweep.FlipEdgeEvent(a,b,c,d,g)}else f=tessellation.sweep.NextFlipPoint(b,c,h,f),tessellation.sweep.FlipScanEdgeEvent(a,b,c,d,h,f),tessellation.sweep.EdgeEvent(a,b,c,d,g)}};tessellation.sweep.NextFlipTriangle=function(a,b,c,d,g,h){if(b==tessellation.Orientation.CCW)return b=
d.EdgeIndex(g,h),d.delaunay_edge[b]=!0,tessellation.sweep.Legalize(a,d),d.ClearDelunayEdges(),c;b=c.EdgeIndex(g,h);c.delaunay_edge[b]=!0;tessellation.sweep.Legalize(a,c);c.ClearDelunayEdges();return d};tessellation.sweep.NextFlipPoint=function(a,b,c,d){a=tessellation.Orient2d(b,d,a);if(a==tessellation.Orientation.CW)return c.PointCCW(d);if(a==tessellation.Orientation.CCW)return c.PointCW(d);alert("[Unsupported] tessellation.sweep.NextFlipPoint: opposing point on constrained edge!")};tessellation.sweep.FlipScanEdgeEvent=
function(a,b,c,d,g,h){var f=g.NeighborAcross(h);null==f?alert("[BUG:FIXME] FLIP failed due to missing triangle"):(g=f.OppositePoint(g,h),tessellation.InScanArea(c,d.PointCCW(c),d.PointCW(c),g)?tessellation.sweep.FlipEdgeEvent(a,c,g,f,g):(g=tessellation.sweep.NextFlipPoint(b,c,f,g),tessellation.sweep.FlipScanEdgeEvent(a,b,c,d,f,g)))}})();(function(){function p(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a);this.trigger(j.Events.resize,b,a)}var a=this,b=a.Two||{},c=Math.sin,d=Math.cos,g=Math.atan2,h=Math.sqrt,f=Math.abs,k=Math.PI,n=2*k,q=k/2,r=Math.pow,s={hasEventListeners:_.isFunction(a.addEventListener),bind:function(a,b,c,f){this.hasEventListeners?a.addEventListener(b,c,!!f):a.attachEvent("on"+b,c);return this},unbind:function(a,b,c,f){this.hasEventListeners?
a.removeEventListeners(b,c,!!f):a.detachEvent("on"+b,c);return this}},j=a.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:j.Types.svg,autostart:!1});this.type=a.type;this.renderer=new j[this.type](this);this.playing=a.autostart;this.frameCount=0;a.fullscreen?(a=_.bind(p,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),s.bind(window,"resize",a),a()):(this.renderer.setSize(a.width,a.height),this.width=
a.width,this.height=a.height);this.scene=new j.Group;this.renderer.add(this.scene);j.Instances.push(this)};_.extend(j,{Array:a.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){a.Two=b;return this},Utils:{Curve:{CollinearityEpsilon:r(10,-30),RecursionLimit:32,
CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},decoupleShapes:function(a,b,c){c=c||0;for(var f=0,d=a.length;f<d;f++)if(b||!(f>=d-1))for(var m=v(f+1,d),g=a[f],h=a[m],k=d-1;k>f+1;k--)if(!(k>=d-1)){var j=v(k+1,d),t=w(g,h,a[k],a[j]);if(t)return f=[t],t=[t.clone()],_.range(d),d=a.slice(0,m).concat(f,a.slice(j,d)),a=a.slice(m,j).concat(t),[y(d,b,c+1),y(a,b,c+1)]}return[a]},solveSegmentIntersection:function(a,b,c,f){var d=(f.x-c.x)*(a.y-c.y)-(f.y-c.y)*(a.x-c.x),m=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*
(a.x-c.x);c=(f.y-c.y)*(b.x-a.x)-(f.x-c.x)*(b.y-a.y);return 0!=c&&(d/=c,m/=c,0<=d&&1>=d&&0<=m&&1>=m)?new j.Vector(a.x+d*(b.x-a.x),a.y+d*(b.y-a.y)):null},subdivide:function(a,b,c,d,m,h,t,u,q){var l=j.Utils.Curve.CollinearityEpsilon,s=j.Utils.Curve.CuspLimit,r=j.Utils.Curve.Tolerance;q=q||0;var w=(a+c)/2,v=(b+d)/2,y=(c+m)/2,p=(d+h)/2,N=(m+t)/2,O=(h+u)/2,P=(w+y)/2,Q=(v+p)/2,y=(y+N)/2,p=(p+O)/2,C=(P+y)/2,D=(Q+p)/2;if(0<q){var x=t-a,B=u-b,G=f((c-t)*B-(d-u)*x),H=f((m-t)*B-(h-u)*x);if(G>l&&H>l&&(G+H)*(G+
H)<=r.distance*(x*x+B*B)){if(r.angle<r.epsilon)return[new j.Vector(C,D)];x=g(h-d,m-c);l=f(x-g(d-b,c-a));x=f(g(u-h,t-m)-x);l>=k&&(l=n-l);x>=k&&(x=n-x);if(l+x<r.angle)return[new j.Vector(C,D)];if(0!==s){if(l>s)return[new j.Vector(c,d)];if(x>s)return[new j.Vector(m,h)]}}}else if(G>l)if(G*G<=r.distance*(x*x+B*B)){if(r.angle<r.epsilon)return[new j.Vector(C,D)];l=f(g(h-d,m-c)-g(d-b,c-a));l>=k&&(l=n-l);if(l<r.angle)return[new j.Vector(c,d),new j.Vector(m,h)];if(0!==s&&l>s)return[new j.Vector(c,d)]}else if(H>
l){if(H*H<=r.distance*(x*x+B*B)){if(r.angle<r.epsilon)return[new j.Vector(C,D)];l=f(g(u-h,t-m)-g(h-d,m-c));l>=k&&(l=n-l);if(l<r.angle)return[new j.Vector(c,d),new j.Vector(m,h)];if(0!==s&&l>s)return[new j.Vector2(m,h)]}}else if(x=C-(a+t)/2,B=D-(b+u)/2,x*x+B*B<=r.distance)return[new j.Vector(C,D)];return j.Utils.subdivide(a,b,w,v,P,Q,C,D,q+1).concat(j.Utils.subdivide(C,D,y,p,N,O,t,u,q+1))},getCurveFromPoints:function(a,b){for(var c=[],d=a.length,f=d-1,m=0;m<d;m++){var h=a[m],g={x:h.x,y:h.y};c.push(g);
var h=b?v(m-1,d):Math.max(m-1,0),k=b?v(m+1,d):Math.min(m+1,f);u(a[h],g,a[k]);!g.u.x&&!g.u.y&&(g.u.x=g.x,g.u.y=g.y);!g.v.x&&!g.v.y&&(g.v.x=g.x,g.v.y=g.y)}return c},getControlPoints:function(a,b,f){var m=t(a,b),h=t(f,b);a=l(a,b);f=l(f,b);var g=(m+h)/2;if(1E-4>a||1E-4>f)return b.u={x:b.x,y:b.y},b.v={x:b.x,y:b.y},b;a*=0.33;f*=0.33;g=h<m?g+q:g-q;m={x:b.x+d(g)*a,y:b.y+c(g)*a};g-=k;h={x:b.x+d(g)*f,y:b.y+c(g)*f};b.u=m;b.v=h;return b},angleBetween:function(a,b){return g(a.y-b.y,a.x-b.x)},distanceBetweenSquared:function(a,
b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},distanceBetween:function(a,b){return h(m(a,b))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Error:function(a){this.name="two.js";this.message=a}}});j.Utils.Error.prototype=Error();j.Utils.Error.prototype.constructor=j.Utils.Error;var l=j.Utils.distanceBetween,m=j.Utils.distanceBetweenSquared,t=j.Utils.angleBetween,u=j.Utils.getControlPoints,w=j.Utils.solveSegmentIntersection,y=j.Utils.decoupleShapes,v=j.Utils.mod;_.extend(j.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);
return this},play:function(){this.playing=!0;return this.trigger(j.Events.play)},pause:function(){this.playing=!1;return this.trigger(j.Events.pause)},update:function(){this.frameCount++;var a=this.width,b=this.height,c=this.renderer;(a!==c.width||b!==c.height)&&c.setSize(a,b);return this.trigger(j.Events.update,this.frameCount)},render:function(){this.renderer.render();return this.trigger(j.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);
return this},makeLine:function(a,b,c,d){c=(c-a)/2;d=(d-b)/2;var f=[new j.Vector(-c,-d),new j.Vector(c,d)],f=(new j.Polygon(f)).noFill();f.translation.set(a+c,b+d);this.scene.add(f);return f},makeRectangle:function(a,b,c,d){c/=2;d/=2;d=[new j.Vector(c,d),new j.Vector(-c,d),new j.Vector(-c,-d),new j.Vector(c,-d)];d=new j.Polygon(d,!0);d.translation.set(a,b);this.scene.add(d);return d},makeCircle:function(a,b,c){return this.makeEllipse(a,b,c,c)},makeEllipse:function(a,b,f,m){var g=j.Resolution,h=_.map(_.range(g),
function(a){var b=a/g*n;a=f*d(b);b=m*c(b);return new j.Vector(a,b)},this),h=new j.Polygon(h,!0,!0);h.translation.set(a,b);this.scene.add(h);return h},makeCurve:function(a){var b=arguments.length,c=a;if(!_.isArray(a))for(var c=[],d=0;d<b;d+=2){var f=arguments[d];if(!_.isNumber(f))break;c.push(new j.Vector(f,arguments[d+1]))}var b=arguments[b-1],c=new j.Polygon(c,!(_.isBoolean(b)&&b),!0),b=c.getBoundingClientRect(),m=b.left+b.width/2,h=b.top+b.height/2;_.each(c.vertices,function(a){a.x-=m;a.y-=h});
c.translation.set(m,h);this.scene.add(c);return c},makePolygon:function(a){var b=arguments.length,c=a;if(!_.isArray(a))for(var c=[],d=0;d<b;d+=2){var f=arguments[d];if(!_.isNumber(f))break;c.push(new j.Vector(f,arguments[d+1]))}var b=arguments[b-1],c=new j.Polygon(c,!(_.isBoolean(b)&&b)),b=c.getBoundingClientRect(),m=b.left+b.width/2,h=b.top+b.height/2;_.each(c.vertices,function(a){a.x-=m;a.y-=h});c.translation.set(m,h);this.scene.add(c);return c},makeGroup:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));
var c=new j.Group;this.scene.add(c);c.add(b);return c}});(function(){_.each(j.Instances,function(a){a.playing&&a.update().render()});requestAnimationFrame(arguments.callee)})()})();(function(){var p=Two.Vector=function(a,b){a=a||0;b=b||0;Object.defineProperty(this,"x",{get:function(){return a},set:function(b){a=b;this.trigger("change","x")}});Object.defineProperty(this,"y",{get:function(){return b},set:function(a){b=a;this.trigger("change","y")}})};_.extend(p,{});_.extend(p.prototype,Backbone.Events,{set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new p(this.x,
this.y)},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*
a.x+this.y*a.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return 1E-4>this.distanceTo(a)},lerp:function(a,b){return this.set((a.x-this.x)*
b+this.x,(a.y-this.y)*b+this.y)},isZero:function(){return 1E-4>this.length()}})})();(function(){_.range(6);var p=Math.cos,a=Math.sin,b=Math.tan,c=Two.Matrix=function(a,b,c,f,k,n){this.elements=new Two.Array(9);var q=a;_.isArray(q)||(q=_.toArray(arguments));this.identity().set(q)};_.extend(c,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(a,b){var c=a[0],f=a[1],k=a[2],n=a[3],q=a[4],r=a[5],s=a[6],j=a[7],l=a[8],m=b[0],t=b[1],u=b[2],w=b[3],y=b[4],v=b[5],e=b[6],p=b[7],F=b[8];return[c*m+f*w+k*e,c*t+f*y+k*p,c*u+f*v+k*F,n*m+q*w+r*e,n*t+q*y+r*p,n*u+q*v+r*F,s*m+j*w+l*e,s*t+j*y+l*p,s*u+j*v+
l*F]}});_.extend(c.prototype,{set:function(a,b,c,f,k,n){var q=a;_.isArray(q)||(q=_.toArray(arguments));_.each(q,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this},identity:function(){this.set(c.Identity);return this},multiply:function(a,b,c,f,k,n,q,r,s){var j=arguments,l=j.length;if(1>=l)return _.each(this.elements,function(b,c){this.elements[c]=b*a},this),this;if(3>=l)return a=a||0,b=b||0,c=c||0,k=this.elements,{x:k[0]*a+k[1]*b+k[2]*c,y:k[3]*a+k[4]*b+k[5]*c,z:k[6]*a+k[7]*b+k[8]*
c};l=this.elements;A0=l[0];A1=l[1];A2=l[2];A3=l[3];A4=l[4];A5=l[5];A6=l[6];A7=l[7];A8=l[8];B0=j[0];B1=j[1];B2=j[2];B3=j[3];B4=j[4];B5=j[5];B6=j[6];B7=j[7];B8=j[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*B6;this.elements[4]=A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this},scale:function(a,
b){1>=arguments.length&&(b=a);return this.multiply(a,0,0,0,b,0,0,0,1)},rotate:function(b){var c=p(b);b=a(b);return this.multiply(c,-b,0,b,c,0,0,0,1)},translate:function(a,b){return this.multiply(1,0,a,0,1,b,0,0,1)},skewX:function(a){a=b(a);return this.multiply(1,a,0,0,1,0,0,0,1)},skewY:function(a){a=b(a);return this.multiply(1,0,0,a,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},toArray:function(a){var b=this.elements,c=parseFloat(b[0].toFixed(3)),f=parseFloat(b[1].toFixed(3)),k=
parseFloat(b[2].toFixed(3)),n=parseFloat(b[3].toFixed(3)),q=parseFloat(b[4].toFixed(3)),r=parseFloat(b[5].toFixed(3));if(a){a=parseFloat(b[6].toFixed(3));var s=parseFloat(b[7].toFixed(3)),b=parseFloat(b[8].toFixed(3));return[c,n,a,f,q,s,k,r,b]}return[c,n,f,q,k,r]},clone:function(){return new Two.Matrix(this.elements.slice(0))}})})();(function(){function p(a){var b={},c=a.id,n=a.translation,q=a.rotation,r=a.scale,s=a.stroke,j=a.linewidth,l=a.fill,m=a.opacity,t=a.visible,u=a.cap,w=a.join,p=a.miter,v=a.curved,e=a.closed;a=a.vertices;c&&(b.id=g.Identifier+c);n&&(_.isNumber(r)&&_.isNumber(q))&&(b.transform="translate("+n.x+","+n.y+") scale("+r+") rotate("+q+")");s&&(b.stroke=s);l&&(b.fill=l);m&&(b["stroke-opacity"]=b["fill-opacity"]=m);b.visibility=t?"visible":"hidden";u&&(b["stroke-linecap"]=u);w&&(b["stroke-linejoin"]=w);p&&(b["stroke-miterlimit"]=
p);j&&(b["stroke-width"]=j);a&&(b.d=d.toString(a,e,v));return b}var a=0,b=Two.Utils.getCurveFromPoints,c=Two.Utils.mod,d={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(a,b){var c=a.toLowerCase(),d=document.createElementNS(this.ns,c);"svg"===c&&(b=_.defaults(b||{},{version:this.version}));_.isObject(b)&&this.setAttributes(d,b);return d},setAttributes:function(a,b){_.each(b,function(a,b){this.setAttribute(b,a)},a);return this},removeAttributes:function(a,
b){_.each(b,function(a){this.removeAttribute(a)},a);return this},toString:function(a,d,g){var n=a.length,q=n-1;if(!g)return _.map(a,function(a,b){var c;c=(0>=b?"M":"L")+(" "+a.x.toFixed(3)+" "+a.y.toFixed(3));b>=q&&d&&(c+=" Z");return c}).join(" ");var r=b(a,d);return _.map(r,function(a,b){var g,m=d?c(b-1,n):Math.max(b-1,0),h=d?c(b+1,n):Math.min(b+1,q);g=r[m];var h=r[h],m=g.v.x.toFixed(3),k=g.v.y.toFixed(3),w=a.u.x.toFixed(3),p=a.u.y.toFixed(3),v=a.x.toFixed(3),e=a.y.toFixed(3);g=0>=b?"M "+v+" "+
e:"C "+m+" "+k+" "+w+" "+p+" "+v+" "+e;b>=q&&d&&(m=a.v.x.toFixed(3),k=a.v.y.toFixed(3),w=h.u.x.toFixed(3),p=h.u.y.toFixed(3),v=h.x.toFixed(3),e=h.y.toFixed(3),g=g+(" C "+m+" "+k+" "+w+" "+p+" "+v+" "+e)+" Z");return g}).join(" ")}},g=Two[Two.Types.svg]=function(){this.domElement=d.createElement("svg");this.elements=[];this.commands=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(g,{Identifier:"two-"});_.extend(g.prototype,
Backbone.Events,{setSize:function(a,b){this.width=a;this.height=b;d.setAttributes(this.domElement,{width:a,height:b});return this},add:function(b){var c=b,g=this.elements,n=this.domElement;_.isArray(b)||(c=_.map(arguments,function(a){return a}));_.each(c,function(b){var c;c=b instanceof Two.Group;if(_.isUndefined(b.id)){var f=a;a++;b.id=f}c?(c="g",_.isUndefined(b.parent)&&(b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),b=p(b),delete b.stroke,delete b.fill,
delete b["fill-opacity"],delete b["stroke-opacity"],delete b["stroke-linecap"],delete b["stroke-linejoin"],delete b["stroke-miterlimit"],delete b["stroke-width"]):(c="path",b=p(b));b=d.createElement(c,b);n.appendChild(b);g.push(b)},this);return this},update:function(a,b,c){this.commands.push(arguments);return this},render:function(){this.unveil();var a=this.elements;_.each(this.commands,function(b){var c=b[1],g=b[2],q=b[3],r=b[4],s=a[b[0]];switch(c){case Two.Properties.hierarchy:_.each(g,function(b){s.appendChild(a[b])});
break;case Two.Properties.demotion:_.each(g,function(b){s.removeChild(a[b])});break;default:a:{b=c;switch(b){case "matrix":b="transform";g="matrix("+g.toString()+")";break;case "visible":b="visibility";g=g?"visible":"hidden";break;case "cap":b="stroke-linecap";break;case "join":b="stroke-linejoin";break;case "miter":b="stroke-miterlimit";break;case "linewidth":b="stroke-width";break;case "vertices":b="d";g=d.toString(g,q,r);break;case "opacity":d.setAttributes(s,{"stroke-opacity":opacity,"fill-opacity":opacity});
break a}s.setAttribute(b,g)}}},this);this.commands.length=0;return this}})})();(function(){var p=0,a=Two.Utils.getCurveFromPoints,b=Two.Utils.mod,c=function(a){_.each(a,function(a,b){this[b]=a},this);this.children={}};_.extend(c.prototype,{appendChild:function(a){var b=a.parent,c=a.id;_.isUndefined(b)||delete b.children[c];this.children[c]=a;a.parent=this;return this},removeChild:function(a){delete this.children[a.id];return this},render:function(a){var b=this.matrix;a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);_.each(this.children,function(b){b.render(a)});a.restore();
return this}});var d=function(a){_.each(a,function(a,b){this[b]=a},this)};_.extend(d.prototype,{render:function(a){var c=this.matrix,d=this.stroke,g=this.linewidth,h=this.fill,s=this.opacity,j=this.cap,l=this.join,m=this.miter,t=this.curved,u=this.closed,w=this.commands,p=w.length,v=p-1;if(!this.visible)return this;a.save();c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);h&&(a.fillStyle=h);d&&(a.strokeStyle=d);g&&(a.lineWidth=g);m&&(a.miterLimit=m);l&&(a.lineJoin=l);j&&(a.lineCap=j);_.isNumber(s)&&
(a.globalAlpha=s);a.beginPath();_.each(w,function(c,d){var m=c.x.toFixed(3),g=c.y.toFixed(3);if(t){var h=u?b(d-1,p):Math.max(d-1,0),k=u?b(d+1,p):Math.min(d+1,v),j=w[h],k=w[k],h=j.v.x.toFixed(3),j=j.v.y.toFixed(3),l=c.u.x.toFixed(3),n=c.u.y.toFixed(3);0>=d?a.moveTo(m,g):(a.bezierCurveTo(h,j,l,n,m,g),d>=v&&u&&(h=c.v.x.toFixed(3),j=c.v.y.toFixed(3),l=k.u.x.toFixed(3),n=k.u.y.toFixed(3),m=k.x.toFixed(3),g=k.y.toFixed(3),a.bezierCurveTo(h,j,l,n,m,g)))}else 0>=d?a.moveTo(m,g):a.lineTo(m,g)});u&&!t&&a.closePath();
a.fill();a.stroke();a.restore()}});var g={toArray:function(b,c,d){return!c?_.map(b,function(a){return{x:a.x,y:a.y}}):a(b,d)}},h=Two[Two.Types.canvas]=function(){this.domElement=document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.elements=[];this.stage=null};_.extend(h,{});_.extend(h,{Group:c,Element:d,getStyles:function(a){var b={},c=a.id,d=a._matrix,h=a.stroke,s=a.linewidth,j=a.fill,l=a.opacity,m=a.visible,t=a.cap,u=a.join,p=a.miter,y=a.curved,v=a.closed;a=a.vertices;
c&&(b.id=c);_.isObject(d)&&(b.matrix=d.toArray());h&&(b.stroke=h);j&&(b.fill=j);_.isNumber(l)&&(b.opacity=l);t&&(b.cap=t);u&&(b.join=u);p&&(b.miter=p);s&&(b.linewidth=s);a&&(b.commands=g.toArray(a,y,v));b.visible=!!m;b.curved=!!y;b.closed=!!v;return b},setStyles:function(a,b,c){switch(b){case "matrix":b="matrix";c=c.toArray();break;case "vertices":b="commands",c=g.toArray(c,a.curved,a.closed)}a[b]=c}});_.extend(h.prototype,Backbone.Events,{setSize:function(a,b){this.width=this.domElement.width=a;
this.height=this.domElement.height=b;_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});return this},add:function(a){constructor=Object.getPrototypeOf(this).constructor;var b=a,c=this.elements,d=constructor.Group,g=constructor.Element,h=constructor.getStyles;_.isArray(a)||(b=_.map(arguments,function(a){return a}));_.each(b,function(a){var b;b=a instanceof Two.Group;var f=_.isNull(this.stage);if(_.isUndefined(a.id)){var t=p;p++;a.id=t}b?(b=h.call(this,a),delete b.stroke,
delete b.fill,delete b.opacity,delete b.cap,delete b.join,delete b.miter,delete b.linewidth,b=new d(b),f&&(this.stage=b,this.stage.object=a,a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):b=new g(h.call(this,a));c.push(b);f||this.stage.appendChild(b)},this);return this},update:function(a,b,c){var d=Object.getPrototypeOf(this).constructor,g=this.elements,h=g[a];switch(b){case Two.Properties.hierarchy:_.each(c,function(a){h.appendChild(g[a])});break;case Two.Properties.demotion:_.each(c,
function(a){h.removeChild(g[a]);this.elements[a]=null},this);default:d.setStyles.call(this,h,b,c)}return this},render:function(){if(_.isNull(this.stage))return this;this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);return this}})})();(function(){function p(a){var b=[];_.each(a,function(a){_.isArray(a)&&_.isArray(a[0])?b=b.concat(p(a)):b.push(a)});return b}var a=Two[Two.Types.canvas],b=Two.Utils.getCurveFromPoints,c=Two.Matrix.Multiply,d=Two.Utils.decoupleShapes,g={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",
chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",
deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",
lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",
mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",
pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",transparent:"#000",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",
wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:'#9ACD32"'},h="(?:\\+|-)?\\d+",f="(?:\\+|-)?\\d*\\.\\d+",k="(?:"+h+")|(?:"+f+")",h="("+h+")",f="("+f+")",k="("+k+")",f=k+"%",n=RegExp(["^hsl(a?)\\(",k,",",f,",",f,"(,",k,")?\\)$"].join("\\s*?")),q=RegExp(["^rgb(a?)\\(",h,",",h,",",h,"(,",k,")?\\)$"].join("\\s*?")),r=RegExp(["^rgb(a?)\\(",f,",",f,",",f,"(,",k,")?\\)$"].join("\\s*?")),s=/^,\s*/,j=[function(a){function b(c,d){var f=a.match(c);if(f&&1!==!!f[1]+!!f[5]){var e=
_.isUndefined(f[5])?1:f[5].replace(s,"");return{r:Math.min(1,Math.max(0,f[2]/d)),g:Math.min(1,Math.max(0,f[3]/d)),b:Math.min(1,Math.max(0,f[4]/d)),a:Math.min(1,Math.max(e,0))}}}a=a.replace(/^\s+|\s+$/g,"");var c=b(q,255);return c?c:b(r,100)},function(a){var b=a.toLowerCase();b in g&&(a=g[b]);if(a.match(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)){a=a.replace(/^#/,"");var b=a.length/3,c=Math.pow(16,b)-1;return{r:parseInt(a.slice(0,b),16)/c,g:parseInt(a.slice(1*b,2*b),16)/c,b:parseInt(a.slice(2*b),16)/c,
a:1}}},function(a){var b=a.replace(/^\s+|\s+$/g,"").match(n);if(!b||1===!!b[1]+!!b[5])return null;a=(b[2]%360+360)%360/360;var c=Math.max(0,Math.min(parseInt(b[3],10)/100,1)),d=Math.max(0,Math.min(parseInt(b[4],10)/100,1)),b=b[5];if(0!=c)var f=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},g=0.5>d?d*(1+c):d+c-d*c,e=2*d-g;c=_.isUndefined(b)||_.isNull(b)?1:b.replace(s,"");return{r:f(e,g,a+1/3),g:f(e,g,a),b:f(e,g,a-1/3),a:c}}],h=function(b){a.Group.call(this,
b)};_.extend(h.prototype,a.Group.prototype,{appendChild:function(){a.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},updateMatrix:function(a){a=a||this.parent&&this.parent.matrix;if(!a)return this;this._matrix=c(this.matrix,a);_.each(this.children,function(a){a.updateMatrix(this._matrix)},this);return this},render:function(a,b,c,d){_.each(this.children,function(f){f.render(a,b,c,d)})}});k=function(b){a.Element.call(this,b)};_.extend(k.prototype,a.Element.prototype,
{updateMatrix:function(a){a=a||this.parent&&this.parent.matrix;if(!a)return this;this._matrix=c(this.matrix,a);this._linewidth=this.linewidth*this._matrix[0];return this},render:function(a,b,c,d){if(!this.visible||!this.fillBuffer||!this.strokeBuffer)return this;0<this.fill.a&&(a.bindBuffer(a.ARRAY_BUFFER,this.fillBuffer),a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0),a.uniformMatrix3fv(c,!1,this._matrix),a.uniform4f(d,this.fill.r,this.fill.g,this.fill.b,this.fill.a),a.drawArrays(a.TRIANGLES,0,this.triangleAmount));
if(0>=this._linewidth||0>=this.stroke.a)return this;a.bindBuffer(a.ARRAY_BUFFER,this.strokeBuffer);a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0);a.uniformMatrix3fv(c,!1,this._matrix);a.uniform4f(d,this.stroke.r,this.stroke.g,this.stroke.b,this.stroke.a);a.lineWidth(this._linewidth);a.drawArrays(a.LINES,0,this.vertexAmount);return this}});var l={updateBuffer:function(a,b,c){_.isObject(b.fillBuffer)&&a.deleteBuffer(b.fillBuffer);b.fillBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.fillBuffer);a.enableVertexAttribArray(c);
a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.strokeBuffer)&&a.deleteBuffer(b.strokeBuffer);b.strokeBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.strokeBuffer);a.enableVertexAttribArray(c);a.bufferData(a.ARRAY_BUFFER,b.vertices,a.STATIC_DRAW)},interpret:function(a){for(var b=0,c=j.length;b<c;b++){var d=j[b](a);if(d)return d}return{r:0,g:0,b:0,a:0}},toArray:function(a,c,d){if(!c)return a;var f=b(a,d),g=f.length,h=g-1,e=[];_.each(f,function(a,b){if(d||!d&&b<h){var c=f[(b+
1)%g],c=Two.Utils.subdivide(a.x,a.y,a.v.x,a.v.y,c.u.x,c.u.y,c.x,c.y);e=e.concat(c)}});return e},tessellate:function(a,b,c,f,g){a=p(d(a,c));var h=[],e=[],j=0,k=0;_.each(a,function(a){a=new tessellation.SweepContext(a);tessellation.sweep.Triangulate(a);j+=6*a.triangles.length;_.each(a.triangles,function(a){var b=a.points;a=b[0];var c=b[1],b=b[2];h.push(a.x,a.y,c.x,c.y,b.x,b.y)});k+=4*a.edges.length;_.each(a.edges,function(a){var b=a.p;a=a.q;e.push(b.x,b.y,a.x,a.y)})});f=f&&j<=f.length?f:new Two.Array(j);
g=g&&k<=g.length?g:new Two.Array(k);f.set(h);g.set(e);return{triangles:f,vertices:g,triangleAmount:j/2,vertexAmount:k/2}},program:{create:function(a,b){var c=a.createProgram();_.each(b,function(b){a.attachShader(c,b)});a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw error=a.getProgramInfoLog(c),new Two.Utils.Error("unable to link program: "+error);return c}},shaders:{create:function(a,b,c){c=a.createShader(a[c]);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a=
a.getShaderInfoLog(c),new Two.Utils.Error("unable to compile shader "+c+": "+a);return c},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 position;\nuniform mat3 matrix;\nuniform vec2 resolution;\n\nvoid main() {\n   vec2 projected = (matrix * vec3(position, 1)).xy;\n   vec2 normal = projected / resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n}",fragment:"precision mediump float;\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}"}},
f=Two[Two.Types.webgl]=function(a){this.domElement=document.createElement("canvas");this.elements=[];this.stage=null;a=_.defaults(a||{},{antialias:!0,alpha:!1,premultipliedAlpha:!1});this.domElement.style.background="#efefef";this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");a=l.shaders.create(this.ctx,l.shaders.vertex,l.shaders.types.vertex);var b=
l.shaders.create(this.ctx,l.shaders.fragment,l.shaders.types.fragment);this.program=l.program.create(this.ctx,[a,b]);this.ctx.useProgram(this.program);this.positionLocation=this.ctx.getAttribLocation(this.program,"position");this.colorLocation=this.ctx.getUniformLocation(this.program,"color");this.matrixLocation=this.ctx.getUniformLocation(this.program,"matrix");this.ctx.enable(this.ctx.BLEND);this.ctx.disable(this.ctx.DEPTH_TEST);this.ctx.blendFunc(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA)};
_.extend(f,{Group:h,Element:k,getStyles:function(a){var b={},c=a.id,d=a._matrix,f=a.stroke,g=a.linewidth,e=a.fill,h=a.opacity,j=a.visible,k=a.cap,n=a.join,p=a.miter,s=a.curved,q=a.closed;a=a.vertices;c&&(b.id=c);_.isObject(d)&&(b.matrix=b._matrix=d.toArray(!0));f&&(b.stroke=l.interpret(f));e&&(b.fill=l.interpret(e));_.isNumber(h)&&(b.opacity=h);k&&(b.cap=k);n&&(b.join=n);p&&(b.miter=p);g&&(b.linewidth=g,b._linewidth=g*b._matrix[0]);a&&(a=l.toArray(a,s,q),c=l.tessellate(a,s,q),b.triangles=c.triangles,
b.vertices=c.vertices,b.vertexAmount=c.vertexAmount,b.triangleAmount=c.triangleAmount);b.visible=!!j;b.curved=!!s;b.closed=!!q;return b},setStyles:function(a,b,c){switch(b){case "matrix":b="matrix";c=c.toArray(!0);break;case "linewidth":b="linewidth";a._linewidth=c*a._matrix[0];break;case "stroke":c=l.interpret(c);break;case "fill":c=l.interpret(c);break;case "vertices":b="triangles";c=l.toArray(c,a.curved,a.closed);var d=l.tessellate(c,a.curved,a.closed,a.triangles,a.vertices);c=d.triangles;a.vertices=
d.vertices;a.vertexAmount=d.vertexAmount;a.triangleAmount=d.triangleAmount}a[b]=c;"triangles"===b&&l.updateBuffer(this.ctx,a,this.positionLocation);"matrix"===b&&a.updateMatrix()}});_.extend(f.prototype,Backbone.Events,a.prototype,{setSize:function(b,c){a.prototype.setSize.apply(this,arguments);this.ctx.viewport(0,0,b,c);var d=this.ctx.getUniformLocation(this.program,"resolution");this.ctx.uniform2f(d,b,c);return this},render:function(){if(_.isNull(this.stage))return this;var a=this.ctx;a.clearColor(1,
1,1,0);a.clear(a.COLOR_BUFFER_BIT);this.stage.render(a,this.positionLocation,this.matrixLocation,this.colorLocation);return this}})})();(function(){var p=Two.Shape=function(a){this._matrix=new Two.Matrix;var b=_.debounce(_.bind(function(){var a=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",a)},this),0);this._rotation="rotation";Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a;b()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(a){this._scale=a;b()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,b);if(a)return this;p.MakeGetterSetter(this,p.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.miter=this.join=this.cap="round"};_.extend(p,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(a,b){_.isArray(b)||(b=[b]);_.each(b,function(b){var d="_"+b;Object.defineProperty(a,
b,{get:function(){return this[d]},set:function(a){this[d]=a;this.trigger(Two.Events.change,this.id,b,a,this)}})})}});_.extend(p.prototype,Backbone.Events,{addTo:function(a){a.add(this);return this},noFill:function(){this.fill="none";return this},noStroke:function(){this.stroke="none";return this},clone:function(){var a=new p;a.translation.copy(this.translation);_.each(p.Properties,function(b){a[b]=this[b]},this);return this}})})();(function(){var p=Two.Group=function(){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;p.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(p,{MakeGetterSetter:function(a,b){_.isArray(b)||(b=[b]);_.each(b,function(b){var d="_"+b;Object.defineProperty(a,b,{get:function(){return this[d]},set:function(a){this[d]=a;_.each(this.children,function(d){d[b]=a})}})})}});_.extend(p.prototype,
Two.Shape.prototype,{add:function(a){var b=a,c=this.children,d=this.parent,g=[];_.isArray(a)||(b=_.toArray(arguments));var h=_.bind(function(a,b,c,d,g){this.trigger(Two.Events.change,a,b,c,d,g)},this);_.each(b,function(a){var b=a.id,n=a.parent;_.isUndefined(b)&&(d.add(a),b=a.id);_.isUndefined(c[b])&&(n&&delete n.children[b],c[b]=a,a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,h),g.push(b))},this);0<g.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,g);return this},
remove:function(a){var b=a,c=this.children,d=this.parent,g=[];if(0>=arguments.length&&d)return d.remove(this),this;_.isArray(a)||(b=_.toArray(arguments));_.each(b,function(a){var b=a.id;b in c&&(delete c[b],a.unbind(Two.Events.change),g.push(b))});0<g.length&&this.trigger(Two.Events.change,this.id,Two.Properties.demotion,g);return this},getBoundingClientRect:function(){var a=Infinity,b=-Infinity,c=Infinity,d=-Infinity;_.each(this.children,function(f){f=f.getBoundingClientRect();c=Math.min(f.top,c);
a=Math.min(f.left,a);b=Math.max(f.right,b);d=Math.max(f.bottom,d)},this);var g=this._matrix.multiply(a,c,1),h=this._matrix.multiply(b,d,1);return{top:g.y,left:g.x,right:h.x,bottom:h.y,width:h.x-g.x,height:h.y-g.y}},noFill:function(){_.each(this.children,function(a){a.noFill()});return this},noStroke:function(){_.each(this.children,function(a){a.noStroke()});return this}})})();(function(){var p=Math.min,a=Math.max,b=Math.round,c=Two.Polygon=function(c,g,h){Two.Shape.call(this);g=!!g;h=!!h;var f=0,k=1,n=!1,q=c.slice(0),r=_.debounce(_.bind(function(){var a,c;if(n){a=this.vertices.length;a-=1;c=b(f*a);a=b(k*a);for(q.length=0;c<a+1;c++){var d=this.vertices[c];q.push(new Two.Vector(d.x,d.y))}n=!1}this.trigger(Two.Events.change,this.id,"vertices",q,this.closed,this.curved)},this),0);Object.defineProperty(this,"closed",{get:function(){return g},set:function(a){g=!!a;r()}});Object.defineProperty(this,
"curved",{get:function(){return h},set:function(a){h=!!a;r()}});Object.defineProperty(this,"beginning",{get:function(){return f},set:function(b){f=p(a(b,0),1);n=!0;r()}});Object.defineProperty(this,"ending",{get:function(){return k},set:function(b){k=p(a(b,0),1);n=!0;r()}});this.vertices=c.slice(0);_.each(this.vertices,function(a){a.bind(Two.Events.change,r)},this);r()};_.extend(c,{});_.extend(c.prototype,Two.Shape.prototype,{clone:function(){var a=_.map(this.vertices,function(a){return new Two.Vector(a.x,
a.y)}),b=new c(a,this.closed,this.curved);_.each(Two.Shape.Properties,function(a){b[a]=this[a]},this);b.translation.copy(this.translation);b.rotation=this.rotation;b.scale=this.scale;return b},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(){var a=this.linewidth,b=Infinity,c=-Infinity,f=Infinity,k=-Infinity;_.each(this.vertices,function(a){var d=a.x;a=a.y;f=Math.min(a,f);b=Math.min(d,b);c=Math.max(d,c);k=Math.max(a,k)});var f=f-a,
b=b-a,c=c+a,k=k+a,a=this._matrix.multiply(b,f,1),n=this._matrix.multiply(c,k,1);return{top:a.y,left:a.x,right:n.x,bottom:n.y,width:n.x-a.x,height:n.y-a.y}}})})();
