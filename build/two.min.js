(function(){function q(r,u,b){if(r===u)return 0!==r||1/r==1/u;if(null==r||null==u)return r===u;r._chain&&(r=r._wrapped);u._chain&&(u=u._wrapped);if(r.isEqual&&d.isFunction(r.isEqual))return r.isEqual(u);if(u.isEqual&&d.isFunction(u.isEqual))return u.isEqual(r);var e=a.call(r);if(e!=a.call(u))return!1;switch(e){case "[object String]":return r==String(u);case "[object Number]":return r!=+r?u!=+u:0==r?1/r==1/u:r==+u;case "[object Date]":case "[object Boolean]":return+r==+u;case "[object RegExp]":return r.source==
u.source&&r.global==u.global&&r.multiline==u.multiline&&r.ignoreCase==u.ignoreCase}if("object"!=typeof r||"object"!=typeof u)return!1;for(var c=b.length;c--;)if(b[c]==r)return!0;b.push(r);var c=0,f=!0;if("[object Array]"==e){if(c=r.length,f=c==u.length)for(;c--&&(f=c in r==c in u&&q(r[c],u[c],b)););}else{if("constructor"in r!="constructor"in u||r.constructor!=u.constructor)return!1;for(var p in r)if(d.has(r,p)&&(c++,!(f=d.has(u,p)&&q(r[p],u[p],b))))break;if(f){for(p in u)if(d.has(u,p)&&!c--)break;
f=!c}}b.pop();return f}var k=this,l=k._,n={},j=Array.prototype,f=Object.prototype,c=j.slice,b=j.unshift,a=f.toString,e=f.hasOwnProperty,p=j.forEach,C=j.map,z=j.reduce,m=j.reduceRight,s=j.filter,J=j.every,B=j.some,w=j.indexOf,t=j.lastIndexOf,f=Array.isArray,v=Object.keys,x=Function.prototype.bind,d=function(a){return new K(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=d),exports._=d):k._=d;d.VERSION="1.3.3";var y=d.each=d.forEach=function(a,
b,e){if(null!=a)if(p&&a.forEach===p)a.forEach(b,e);else if(a.length===+a.length)for(var c=0,f=a.length;c<f&&!(c in a&&b.call(e,a[c],c,a)===n);c++);else for(c in a)if(d.has(a,c)&&b.call(e,a[c],c,a)===n)break};d.map=d.collect=function(a,d,b){var e=[];if(null==a)return e;if(C&&a.map===C)return a.map(d,b);y(a,function(a,r,c){e[e.length]=d.call(b,a,r,c)});a.length===+a.length&&(e.length=a.length);return e};d.reduce=d.foldl=d.inject=function(a,b,e,c){var f=2<arguments.length;null==a&&(a=[]);if(z&&a.reduce===
z)return c&&(b=d.bind(b,c)),f?a.reduce(b,e):a.reduce(b);y(a,function(a,r,d){f?e=b.call(c,e,a,r,d):(e=a,f=!0)});if(!f)throw new TypeError("Reduce of empty array with no initial value");return e};d.reduceRight=d.foldr=function(a,b,e,c){var f=2<arguments.length;null==a&&(a=[]);if(m&&a.reduceRight===m)return c&&(b=d.bind(b,c)),f?a.reduceRight(b,e):a.reduceRight(b);var p=d.toArray(a).reverse();c&&!f&&(b=d.bind(b,c));return f?d.reduce(p,b,e,c):d.reduce(p,b)};d.find=d.detect=function(a,d,b){var e;E(a,function(a,
r,c){if(d.call(b,a,r,c))return e=a,!0});return e};d.filter=d.select=function(a,d,b){var e=[];if(null==a)return e;if(s&&a.filter===s)return a.filter(d,b);y(a,function(a,r,c){d.call(b,a,r,c)&&(e[e.length]=a)});return e};d.reject=function(a,d,b){var e=[];if(null==a)return e;y(a,function(a,r,c){d.call(b,a,r,c)||(e[e.length]=a)});return e};d.every=d.all=function(a,d,b){var e=!0;if(null==a)return e;if(J&&a.every===J)return a.every(d,b);y(a,function(a,r,c){if(!(e=e&&d.call(b,a,r,c)))return n});return!!e};
var E=d.some=d.any=function(a,b,e){b||(b=d.identity);var c=!1;if(null==a)return c;if(B&&a.some===B)return a.some(b,e);y(a,function(a,r,d){if(c||(c=b.call(e,a,r,d)))return n});return!!c};d.include=d.contains=function(a,d){var b=!1;return null==a?b:w&&a.indexOf===w?-1!=a.indexOf(d):b=E(a,function(a){return a===d})};d.invoke=function(a,b){var e=c.call(arguments,2);return d.map(a,function(a){return(d.isFunction(b)?b||a:a[b]).apply(a,e)})};d.pluck=function(a,b){return d.map(a,function(a){return a[b]})};
d.max=function(a,b,e){if(!b&&d.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&d.isEmpty(a))return-Infinity;var c={computed:-Infinity};y(a,function(a,d,r){d=b?b.call(e,a,d,r):a;d>=c.computed&&(c={value:a,computed:d})});return c.value};d.min=function(a,b,e){if(!b&&d.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&d.isEmpty(a))return Infinity;var c={computed:Infinity};y(a,function(a,d,r){d=b?b.call(e,a,d,r):a;d<c.computed&&(c={value:a,computed:d})});return c.value};d.shuffle=
function(a){var d=[],b;y(a,function(a,r){b=Math.floor(Math.random()*(r+1));d[r]=d[b];d[b]=a});return d};d.sortBy=function(a,b,e){var c=d.isFunction(b)?b:function(a){return a[b]};return d.pluck(d.map(a,function(a,d,r){return{value:a,criteria:c.call(e,a,d,r)}}).sort(function(a,d){var r=a.criteria,b=d.criteria;return void 0===r?1:void 0===b?-1:r<b?-1:r>b?1:0}),"value")};d.groupBy=function(a,b){var e={},c=d.isFunction(b)?b:function(a){return a[b]};y(a,function(a,d){var b=c(a,d);(e[b]||(e[b]=[])).push(a)});
return e};d.sortedIndex=function(a,b,e){e||(e=d.identity);for(var c=0,f=a.length;c<f;){var p=c+f>>1;e(a[p])<e(b)?c=p+1:f=p}return c};d.toArray=function(a){return!a?[]:d.isArray(a)||d.isArguments(a)?c.call(a):a.toArray&&d.isFunction(a.toArray)?a.toArray():d.values(a)};d.size=function(a){return d.isArray(a)?a.length:d.keys(a).length};d.first=d.head=d.take=function(a,d,b){return null!=d&&!b?c.call(a,0,d):a[0]};d.initial=function(a,d,b){return c.call(a,0,a.length-(null==d||b?1:d))};d.last=function(a,
d,b){return null!=d&&!b?c.call(a,Math.max(a.length-d,0)):a[a.length-1]};d.rest=d.tail=function(a,d,b){return c.call(a,null==d||b?1:d)};d.compact=function(a){return d.filter(a,function(a){return!!a})};d.flatten=function(a,b){return d.reduce(a,function(a,e){if(d.isArray(e))return a.concat(b?e:d.flatten(e));a[a.length]=e;return a},[])};d.without=function(a){return d.difference(a,c.call(arguments,1))};d.uniq=d.unique=function(a,b,e){e=e?d.map(a,e):a;var c=[];3>a.length&&(b=!0);d.reduce(e,function(e,f,
p){if(b?d.last(e)!==f||!e.length:!d.include(e,f))e.push(f),c.push(a[p]);return e},[]);return c};d.union=function(){return d.uniq(d.flatten(arguments,!0))};d.intersection=d.intersect=function(a){var b=c.call(arguments,1);return d.filter(d.uniq(a),function(a){return d.every(b,function(b){return 0<=d.indexOf(b,a)})})};d.difference=function(a){var b=d.flatten(c.call(arguments,1),!0);return d.filter(a,function(a){return!d.include(b,a)})};d.zip=function(){for(var a=c.call(arguments),b=d.max(d.pluck(a,"length")),
e=Array(b),f=0;f<b;f++)e[f]=d.pluck(a,""+f);return e};d.indexOf=function(a,b,e){if(null==a)return-1;var c;if(e)return e=d.sortedIndex(a,b),a[e]===b?e:-1;if(w&&a.indexOf===w)return a.indexOf(b);e=0;for(c=a.length;e<c;e++)if(e in a&&a[e]===b)return e;return-1};d.lastIndexOf=function(a,d){if(null==a)return-1;if(t&&a.lastIndexOf===t)return a.lastIndexOf(d);for(var b=a.length;b--;)if(b in a&&a[b]===d)return b;return-1};d.range=function(a,d,b){1>=arguments.length&&(d=a||0,a=0);b=arguments[2]||1;for(var e=
Math.max(Math.ceil((d-a)/b),0),c=0,f=Array(e);c<e;)f[c++]=a,a+=b;return f};var F=function(){};d.bind=function(a,b){var e,f;if(a.bind===x&&x)return x.apply(a,c.call(arguments,1));if(!d.isFunction(a))throw new TypeError;f=c.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(b,f.concat(c.call(arguments)));F.prototype=a.prototype;var d=new F,p=a.apply(d,f.concat(c.call(arguments)));return Object(p)===p?p:d}};d.bindAll=function(a){var b=c.call(arguments,1);0==b.length&&(b=d.functions(a));
y(b,function(b){a[b]=d.bind(a[b],a)});return a};d.memoize=function(a,b){var e={};b||(b=d.identity);return function(){var c=b.apply(this,arguments);return d.has(e,c)?e[c]:e[c]=a.apply(this,arguments)}};d.delay=function(a,d){var b=c.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},d)};d.defer=function(a){return d.delay.apply(d,[a,1].concat(c.call(arguments,1)))};d.throttle=function(a,b){var e,c,f,p,m,j,v=d.debounce(function(){m=p=!1},b);return function(){e=this;c=arguments;f||
(f=setTimeout(function(){f=null;m&&a.apply(e,c);v()},b));p?m=!0:j=a.apply(e,c);v();p=!0;return j}};d.debounce=function(a,d,b){var e;return function(){var c=this,f=arguments;b&&!e&&a.apply(c,f);clearTimeout(e);e=setTimeout(function(){e=null;b||a.apply(c,f)},d)}};d.once=function(a){var d=!1,b;return function(){if(d)return b;d=!0;return b=a.apply(this,arguments)}};d.wrap=function(a,d){return function(){var b=[a].concat(c.call(arguments,0));return d.apply(this,b)}};d.compose=function(){var a=arguments;
return function(){for(var d=arguments,b=a.length-1;0<=b;b--)d=[a[b].apply(this,d)];return d[0]}};d.after=function(a,d){return 0>=a?d():function(){if(1>--a)return d.apply(this,arguments)}};d.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],e;for(e in a)d.has(a,e)&&(b[b.length]=e);return b};d.values=function(a){return d.map(a,d.identity)};d.functions=d.methods=function(a){var b=[],e;for(e in a)d.isFunction(a[e])&&b.push(e);return b.sort()};d.extend=function(a){y(c.call(arguments,
1),function(b){for(var d in b)a[d]=b[d]});return a};d.pick=function(a){var b={};y(d.flatten(c.call(arguments,1)),function(d){d in a&&(b[d]=a[d])});return b};d.defaults=function(a){y(c.call(arguments,1),function(b){for(var d in b)null==a[d]&&(a[d]=b[d])});return a};d.clone=function(a){return!d.isObject(a)?a:d.isArray(a)?a.slice():d.extend({},a)};d.tap=function(a,b){b(a);return a};d.isEqual=function(a,b){return q(a,b,[])};d.isEmpty=function(a){if(null==a)return!0;if(d.isArray(a)||d.isString(a))return 0===
a.length;for(var b in a)if(d.has(a,b))return!1;return!0};d.isElement=function(a){return!!(a&&1==a.nodeType)};d.isArray=f||function(b){return"[object Array]"==a.call(b)};d.isObject=function(a){return a===Object(a)};d.isArguments=function(b){return"[object Arguments]"==a.call(b)};d.isArguments(arguments)||(d.isArguments=function(a){return!(!a||!d.has(a,"callee"))});d.isFunction=function(b){return"[object Function]"==a.call(b)};d.isString=function(b){return"[object String]"==a.call(b)};d.isNumber=function(b){return"[object Number]"==
a.call(b)};d.isFinite=function(a){return d.isNumber(a)&&isFinite(a)};d.isNaN=function(a){return a!==a};d.isBoolean=function(b){return!0===b||!1===b||"[object Boolean]"==a.call(b)};d.isDate=function(b){return"[object Date]"==a.call(b)};d.isRegExp=function(b){return"[object RegExp]"==a.call(b)};d.isNull=function(a){return null===a};d.isUndefined=function(a){return void 0===a};d.has=function(a,b){return e.call(a,b)};d.noConflict=function(){k._=l;return this};d.identity=function(a){return a};d.times=
function(a,b,d){for(var e=0;e<a;e++)b.call(d,e)};d.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};d.result=function(a,b){if(null==a)return null;var e=a[b];return d.isFunction(e)?e.call(a):e};d.mixin=function(a){y(d.functions(a),function(e){var f=d[e]=a[e];K.prototype[e]=function(){var a=c.call(arguments);b.call(a,this._wrapped);return O(f.apply(d,a),this._chain)}})};var I=0;d.uniqueId=
function(a){var b=I++;return a?a+b:b};d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/.^/,N={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},Q;for(Q in N)N[N[Q]]=Q;var V=/\\|'|\r|\n|\t|\u2028|\u2029/g,W=/\\(\\|'|r|n|t|u2028|u2029)/g,R=function(a){return a.replace(W,function(a,b){return N[b]})};d.template=function(a,b,e){e=d.defaults(e||{},d.templateSettings);a="__p+='"+a.replace(V,function(a){return"\\"+N[a]}).replace(e.escape||
P,function(a,b){return"'+\n_.escape("+R(b)+")+\n'"}).replace(e.interpolate||P,function(a,b){return"'+\n("+R(b)+")+\n'"}).replace(e.evaluate||P,function(a,b){return"';\n"+R(b)+"\n;__p+='"})+"';\n";e.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var c=new Function(e.variable||"obj","_",a);if(b)return c(b,d);b=function(a){return c.call(this,a,d)};b.source="function("+(e.variable||"obj")+"){\n"+a+"}";return b};
d.chain=function(a){return d(a).chain()};var K=function(a){this._wrapped=a};d.prototype=K.prototype;var O=function(a,b){return b?d(a).chain():a};d.mixin(d);y("pop push reverse shift sort splice unshift".split(" "),function(a){var b=j[a];K.prototype[a]=function(){var d=this._wrapped;b.apply(d,arguments);var e=d.length;("shift"==a||"splice"==a)&&0===e&&delete d[0];return O(d,this._chain)}});y(["concat","join","slice"],function(a){var b=j[a];K.prototype[a]=function(){return O(b.apply(this._wrapped,arguments),
this._chain)}});K.prototype.chain=function(){this._chain=!0;return this};K.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};
(function(){var q=[].slice,k=/\s+/,l=function(f,c,b,a){if(!b)return!0;if("object"===typeof b)for(var e in b)f[c].apply(f,[e,b[e]].concat(a));else if(k.test(b)){b=b.split(k);e=0;for(var p=b.length;e<p;e++)f[c].apply(f,[b[e]].concat(a))}else return!0},n=function(f,c,b){var a;f=-1;var e=c.length;switch(b.length){case 0:for(;++f<e;)(a=c[f]).callback.call(a.ctx);break;case 1:for(;++f<e;)(a=c[f]).callback.call(a.ctx,b[0]);break;case 2:for(;++f<e;)(a=c[f]).callback.call(a.ctx,b[0],b[1]);break;case 3:for(;++f<
e;)(a=c[f]).callback.call(a.ctx,b[0],b[1],b[2]);break;default:for(;++f<e;)(a=c[f]).callback.apply(a.ctx,b)}},j=Backbone.Events={on:function(f,c,b){if(!l(this,"on",f,[c,b])||!c)return this;this._events||(this._events={});(this._events[f]||(this._events[f]=[])).push({callback:c,context:b,ctx:b||this});return this},once:function(f,c,b){if(!l(this,"once",f,[c,b])||!c)return this;var a=this,e=_.once(function(){a.off(f,e);c.apply(this,arguments)});e._callback=c;this.on(f,e,b);return this},off:function(f,
c,b){var a,e,p,j,k,m,s,n;if(!this._events||!l(this,"off",f,[c,b]))return this;if(!f&&!c&&!b)return this._events={},this;j=f?[f]:_.keys(this._events);k=0;for(m=j.length;k<m;k++)if(f=j[k],a=this._events[f]){p=[];if(c||b){s=0;for(n=a.length;s<n;s++)e=a[s],(c&&c!==(e.callback._callback||e.callback)||b&&b!==e.context)&&p.push(e)}this._events[f]=p}return this},trigger:function(f){if(!this._events)return this;var c=q.call(arguments,1);if(!l(this,"trigger",f,c))return this;var b=this._events[f],a=this._events.all;
b&&n(this,b,c);a&&n(this,a,arguments);return this},listenTo:function(f,c,b){var a=this._listeners||(this._listeners={}),e=f._listenerId||(f._listenerId=_.uniqueId("l"));a[e]=f;f.on(c,b||this,this);return this},stopListening:function(f,c,b){var a=this._listeners;if(a){if(f)f.off(c,b,this),!c&&!b&&delete a[f._listenerId];else{for(var e in a)a[e].off(null,null,this);this._listeners={}}return this}}};j.bind=j.on;j.unbind=j.off})();(function(){for(var q=0,k=["ms","moz","webkit","o"],l=0;l<k.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[k[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[k[l]+"CancelAnimationFrame"]||window[k[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(k){var j=(new Date).getTime(),f=Math.max(0,16-(j-q)),c=window.setTimeout(function(){k(j+f)},f);q=j+f;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(k){clearTimeout(k)})})();(function(){function q(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a);this.trigger(m.Events.resize,b,a)}var k=this,l=k.Two||{},n=Math.sin,j=Math.cos,f=Math.atan2,c=Math.sqrt,b=Math.abs,a=Math.PI,e=2*a,p=a/2,C=Math.pow,z={hasEventListeners:_.isFunction(k.addEventListener),bind:function(a,b,d,e){this.hasEventListeners?a.addEventListener(b,d,!!e):a.attachEvent("on"+b,d);return this},unbind:function(a,b,d,e){this.hasEventListeners?
a.removeEventListeners(b,d,!!e):a.detachEvent("on"+b,d);return this}},m=k.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:m.Types.svg,autostart:!1});this.type=a.type;this.renderer=new m[this.type](this);this.playing=a.autostart;this.frameCount=0;a.fullscreen?(a=_.bind(q,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),z.bind(window,"resize",a),a()):(this.renderer.setSize(a.width,a.height),this.width=
a.width,this.height=a.height);this.scene=new m.Group;this.renderer.add(this.scene);m.Instances.push(this)};_.extend(m,{Array:k.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){k.Two=l;return this},Utils:{Curve:{CollinearityEpsilon:C(10,-30),RecursionLimit:32,
CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},subdivide:function(c,p,d,j,k,C,z,s,l){var n=m.Utils.Curve.CollinearityEpsilon,B=m.Utils.Curve.CuspLimit,q=m.Utils.Curve.Tolerance;l=l||0;var J=(c+d)/2,w=(p+j)/2,t=(d+k)/2,r=(j+C)/2,u=(k+z)/2,S=(C+s)/2,T=(J+t)/2,U=(w+r)/2,t=(t+u)/2,r=(r+S)/2,G=(T+t)/2,H=(U+r)/2;if(0<l){var A=z-c,D=s-p,L=b((d-z)*D-(j-s)*A),M=b((k-z)*D-(C-s)*A);if(L>n&&M>n&&(L+M)*(L+M)<=q.distance*(A*A+D*D)){if(q.angle<q.epsilon)return[new m.Vector(G,H)];A=f(C-j,k-d);n=b(A-
f(j-p,d-c));A=b(f(s-C,z-k)-A);n>=a&&(n=e-n);A>=a&&(A=e-A);if(n+A<q.angle)return[new m.Vector(G,H)];if(0!==B){if(n>B)return[new m.Vector(d,j)];if(A>B)return[new m.Vector(k,C)]}}}else if(L>n)if(L*L<=q.distance*(A*A+D*D)){if(q.angle<q.epsilon)return[new m.Vector(G,H)];n=b(f(C-j,k-d)-f(j-p,d-c));n>=a&&(n=e-n);if(n<q.angle)return[new m.Vector(d,j),new m.Vector(k,C)];if(0!==B&&n>B)return[new m.Vector(d,j)]}else if(M>n){if(M*M<=q.distance*(A*A+D*D)){if(q.angle<q.epsilon)return[new m.Vector(G,H)];n=b(f(s-
C,z-k)-f(C-j,k-d));n>=a&&(n=e-n);if(n<q.angle)return[new m.Vector(d,j),new m.Vector(k,C)];if(0!==B&&n>B)return[new m.Vector2(k,C)]}}else if(A=G-(c+z)/2,D=H-(p+s)/2,A*A+D*D<=q.distance)return[new m.Vector(G,H)];return m.Utils.subdivide(c,p,J,w,T,U,G,H,l+1).concat(m.Utils.subdivide(G,H,t,r,u,S,z,s,l+1))},getCurveFromPoints:function(a,b){for(var d=[],e=a.length,c=e-1,f=0;f<e;f++){var p=a[f],j={x:p.x,y:p.y};d.push(j);var p=b?t(f-1,e):Math.max(f-1,0),m=b?t(f+1,e):Math.min(f+1,c);w(a[p],j,a[m]);!j.u.x&&
!j.u.y&&(j.u.x=j.x,j.u.y=j.y);!j.v.x&&!j.v.y&&(j.v.x=j.x,j.v.y=j.y)}return d},getControlPoints:function(b,e,d){var c=B(b,e),f=B(d,e);b=s(b,e);d=s(d,e);var m=(c+f)/2;if(1E-4>b||1E-4>d)return e.u={x:e.x,y:e.y},e.v={x:e.x,y:e.y},e;b*=0.33;d*=0.33;m=f<c?m+p:m-p;c={x:e.x+j(m)*b,y:e.y+n(m)*b};m-=a;f={x:e.x+j(m)*d,y:e.y+n(m)*d};e.u=c;e.v=f;return e},angleBetween:function(a,b){return f(a.y-b.y,a.x-b.x)},distanceBetweenSquared:function(a,b){var d=a.x-b.x,e=a.y-b.y;return d*d+e*e},distanceBetween:function(a,
b){return c(J(a,b))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Error:function(a){this.name="two.js";this.message=a}}});m.Utils.Error.prototype=Error();m.Utils.Error.prototype.constructor=m.Utils.Error;var s=m.Utils.distanceBetween,J=m.Utils.distanceBetweenSquared,B=m.Utils.angleBetween,w=m.Utils.getControlPoints,t=m.Utils.mod;_.extend(m.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);return this},play:function(){this.playing=!0;return this.trigger(m.Events.play)},
pause:function(){this.playing=!1;return this.trigger(m.Events.pause)},update:function(){this.frameCount++;var a=this.width,b=this.height,d=this.renderer;(a!==d.width||b!==d.height)&&d.setSize(a,b);return this.trigger(m.Events.update,this.frameCount)},render:function(){this.renderer.render();return this.trigger(m.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);return this},makeLine:function(a,b,d,e){d=(d-a)/2;e=(e-b)/2;var c=[new m.Vector(-d,
-e),new m.Vector(d,e)],c=(new m.Polygon(c)).noFill();c.translation.set(a+d,b+e);this.scene.add(c);return c},makeRectangle:function(a,b,d,e){d/=2;e/=2;e=[new m.Vector(d,e),new m.Vector(-d,e),new m.Vector(-d,-e),new m.Vector(d,-e)];e=new m.Polygon(e,!0);e.translation.set(a,b);this.scene.add(e);return e},makeCircle:function(a,b,e){return this.makeEllipse(a,b,e,e)},makeEllipse:function(a,b,d,c){var f=m.Resolution,p=_.map(_.range(f),function(a){var b=a/f*e;a=d*j(b);b=c*n(b);return new m.Vector(a,b)},this),
p=new m.Polygon(p,!0,!0);p.translation.set(a,b);this.scene.add(p);return p},makeCurve:function(a){var b=arguments.length,e=a;if(!_.isArray(a))for(var e=[],c=0;c<b;c+=2){var f=arguments[c];if(!_.isNumber(f))break;e.push(new m.Vector(f,arguments[c+1]))}var b=arguments[b-1],e=new m.Polygon(e,!(_.isBoolean(b)&&b),!0),b=e.getBoundingClientRect(),p=b.left+b.width/2,j=b.top+b.height/2;_.each(e.vertices,function(a){a.x-=p;a.y-=j});e.translation.set(p,j);this.scene.add(e);return e},makePolygon:function(a){var b=
arguments.length,e=a;if(!_.isArray(a))for(var e=[],c=0;c<b;c+=2){var f=arguments[c];if(!_.isNumber(f))break;e.push(new m.Vector(f,arguments[c+1]))}b=arguments[b-1];e=new m.Polygon(e,!(_.isBoolean(b)&&b));e.center();this.scene.add(e);return e},makeGroup:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));var e=new m.Group;this.scene.add(e);e.add(b);return e}});(function(){_.each(m.Instances,function(a){a.playing&&a.update().render()});requestAnimationFrame(arguments.callee)})()})();(function(){var q=Two.Vector=function(k,l){k=k||0;l=l||0;Object.defineProperty(this,"x",{get:function(){return k},set:function(l){k=l;this.trigger("change","x")}});Object.defineProperty(this,"y",{get:function(){return l},set:function(k){l=k;this.trigger("change","y")}})};_.extend(q,{});_.extend(q.prototype,Backbone.Events,{set:function(k,l){this.x=k;this.y=l;return this},copy:function(k){this.x=k.x;this.y=k.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new q(this.x,
this.y)},add:function(k,l){this.x=k.x+l.x;this.y=k.y+l.y;return this},addSelf:function(k){this.x+=k.x;this.y+=k.y;return this},sub:function(k,l){this.x=k.x-l.x;this.y=k.y-l.y;return this},subSelf:function(k){this.x-=k.x;this.y-=k.y;return this},multiplySelf:function(k){this.x*=k.x;this.y*=k.y;return this},multiplyScalar:function(k){this.x*=k;this.y*=k;return this},divideScalar:function(k){k?(this.x/=k,this.y/=k):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(k){return this.x*
k.x+this.y*k.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(k){return Math.sqrt(this.distanceToSquared(k))},distanceToSquared:function(k){var l=this.x-k.x;k=this.y-k.y;return l*l+k*k},setLength:function(k){return this.normalize().multiplyScalar(k)},equals:function(k){return 1E-4>this.distanceTo(k)},lerp:function(k,l){return this.set((k.x-this.x)*
l+this.x,(k.y-this.y)*l+this.y)},isZero:function(){return 1E-4>this.length()}})})();(function(){_.range(6);var q=Math.cos,k=Math.sin,l=Math.tan,n=Two.Matrix=function(j,f,c,b,a,e){this.elements=new Two.Array(9);var p=j;_.isArray(p)||(p=_.toArray(arguments));this.identity().set(p)};_.extend(n,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(j,f){if(3>=f.length){var c=f[0]||0,b=f[1]||0,a=f[2]||0;return{x:j[0]*c+j[1]*b+j[2]*a,y:j[3]*c+j[4]*b+j[5]*a,z:j[6]*c+j[7]*b+j[8]*a}}var c=j[0],b=j[1],a=j[2],e=j[3],p=j[4],k=j[5],z=j[6],m=j[7],s=j[8],l=f[0],n=f[1],q=f[2],t=f[3],v=f[4],x=f[5],d=f[6],
y=f[7],E=f[8];return[c*l+b*t+a*d,c*n+b*v+a*y,c*q+b*x+a*E,e*l+p*t+k*d,e*n+p*v+k*y,e*q+p*x+k*E,z*l+m*t+s*d,z*n+m*v+s*y,z*q+m*x+s*E]}});_.extend(n.prototype,{set:function(j,f,c,b,a,e){var p=j;_.isArray(p)||(p=_.toArray(arguments));_.each(p,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this},identity:function(){this.set(n.Identity);return this},multiply:function(j,f,c,b,a,e,p,k,z){var m=arguments,s=m.length;if(1>=s)return _.each(this.elements,function(a,b){this.elements[b]=a*j},this),
this;if(3>=s)return j=j||0,f=f||0,c=c||0,a=this.elements,{x:a[0]*j+a[1]*f+a[2]*c,y:a[3]*j+a[4]*f+a[5]*c,z:a[6]*j+a[7]*f+a[8]*c};s=this.elements;A0=s[0];A1=s[1];A2=s[2];A3=s[3];A4=s[4];A5=s[5];A6=s[6];A7=s[7];A8=s[8];B0=m[0];B1=m[1];B2=m[2];B3=m[3];B4=m[4];B5=m[5];B6=m[6];B7=m[7];B8=m[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*B6;this.elements[4]=A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=
A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this},scale:function(j,f){1>=arguments.length&&(f=j);return this.multiply(j,0,0,0,f,0,0,0,1)},rotate:function(j){var f=q(j);j=k(j);return this.multiply(f,-j,0,j,f,0,0,0,1)},translate:function(j,f){return this.multiply(1,0,j,0,1,f,0,0,1)},skewX:function(j){j=l(j);return this.multiply(1,j,0,0,1,0,0,0,1)},skewY:function(j){j=l(j);return this.multiply(1,0,0,j,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},
toArray:function(j){var f=this.elements,c=parseFloat(f[0].toFixed(3)),b=parseFloat(f[1].toFixed(3)),a=parseFloat(f[2].toFixed(3)),e=parseFloat(f[3].toFixed(3)),p=parseFloat(f[4].toFixed(3)),k=parseFloat(f[5].toFixed(3));if(j){j=parseFloat(f[6].toFixed(3));var z=parseFloat(f[7].toFixed(3)),f=parseFloat(f[8].toFixed(3));return[c,e,j,b,p,z,a,k,f]}return[c,e,b,p,a,k]},clone:function(){var j=this.elements[0],f=this.elements[1],c=this.elements[2],b=this.elements[3],a=this.elements[4],e=this.elements[5];
g=this.elements[6];h=this.elements[7];i=this.elements[8];return new Two.Matrix(j,f,c,b,a,e,g,h,i)}})})();(function(){function q(c){var b={},a=c.id,e=c.translation,p=c.rotation,k=c.scale,z=c.stroke,m=c.linewidth,s=c.fill,l=c.opacity,n=c.visible,q=c.cap,t=c.join,v=c.miter,x=c.curved,d=c.closed;c=c.vertices;a&&(b.id=f.Identifier+a);e&&(_.isNumber(k)&&_.isNumber(p))&&(b.transform="translate("+e.x+","+e.y+") scale("+k+") rotate("+p+")");z&&(b.stroke=z);s&&(b.fill=s);l&&(b["stroke-opacity"]=b["fill-opacity"]=l);b.visibility=n?"visible":"hidden";q&&(b["stroke-linecap"]=q);t&&(b["stroke-linejoin"]=t);v&&(b["stroke-miterlimit"]=
v);m&&(b["stroke-width"]=m);c&&(b.d=j.toString(c,d,x));return b}var k=0,l=Two.Utils.getCurveFromPoints,n=Two.Utils.mod,j={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(c,b){var a=c.toLowerCase(),e=document.createElementNS(this.ns,a);"svg"===a&&(b=_.defaults(b||{},{version:this.version}));_.isObject(b)&&this.setAttributes(e,b);return e},setAttributes:function(c,b){_.each(b,function(a,b){this.setAttribute(b,a)},c);return this},removeAttributes:function(c,
b){_.each(b,function(a){this.removeAttribute(a)},c);return this},toString:function(c,b,a){var e=c.length,f=e-1;if(!a)return _.map(c,function(a,e){var c;c=(0>=e?"M":"L")+(" "+a.x.toFixed(3)+" "+a.y.toFixed(3));e>=f&&b&&(c+=" Z");return c}).join(" ");var j=l(c,b);return _.map(j,function(a,c){var k,l=b?n(c-1,e):Math.max(c-1,0),q=b?n(c+1,e):Math.min(c+1,f);k=j[l];var q=j[q],l=k.v.x.toFixed(3),w=k.v.y.toFixed(3),t=a.u.x.toFixed(3),v=a.u.y.toFixed(3),x=a.x.toFixed(3),d=a.y.toFixed(3);k=0>=c?"M "+x+" "+
d:"C "+l+" "+w+" "+t+" "+v+" "+x+" "+d;c>=f&&b&&(l=a.v.x.toFixed(3),w=a.v.y.toFixed(3),t=q.u.x.toFixed(3),v=q.u.y.toFixed(3),x=q.x.toFixed(3),d=q.y.toFixed(3),k=k+(" C "+l+" "+w+" "+t+" "+v+" "+x+" "+d)+" Z");return k}).join(" ")}},f=Two[Two.Types.svg]=function(){this.domElement=j.createElement("svg");this.elements=[];this.commands=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(f,{Identifier:"two-"});_.extend(f.prototype,
Backbone.Events,{setSize:function(c,b){this.width=c;this.height=b;j.setAttributes(this.domElement,{width:c,height:b});return this},add:function(c){var b=c,a=this.elements,e=this.domElement;_.isArray(c)||(b=_.map(arguments,function(a){return a}));_.each(b,function(b){var c;c=b instanceof Two.Group;if(_.isUndefined(b.id)){var f=k;k++;b.id=f}c?(c="g",_.isUndefined(b.parent)&&(b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),b=q(b),delete b.stroke,delete b.fill,
delete b["fill-opacity"],delete b["stroke-opacity"],delete b["stroke-linecap"],delete b["stroke-linejoin"],delete b["stroke-miterlimit"],delete b["stroke-width"]):(c="path",b=q(b));b=j.createElement(c,b);e.appendChild(b);a.push(b)},this);return this},update:function(c,b,a){this.commands.push(arguments);return this},render:function(){this.unveil();var c=this.elements;_.each(this.commands,function(b){var a=b[1],e=b[2],f=b[3],k=b[4],l=c[b[0]];switch(a){case Two.Properties.hierarchy:_.each(e,function(a){l.appendChild(c[a])});
break;case Two.Properties.demotion:_.each(e,function(a){l.removeChild(c[a])});break;default:a:{b=a;switch(b){case "matrix":b="transform";e="matrix("+e.toString()+")";break;case "visible":b="visibility";e=e?"visible":"hidden";break;case "cap":b="stroke-linecap";break;case "join":b="stroke-linejoin";break;case "miter":b="stroke-miterlimit";break;case "linewidth":b="stroke-width";break;case "vertices":b="d";e=j.toString(e,f,k);break;case "opacity":j.setAttributes(l,{"stroke-opacity":opacity,"fill-opacity":opacity});
break a}l.setAttribute(b,e)}}},this);this.commands.length=0;return this}})})();(function(){var q=0,k=Two.Utils.getCurveFromPoints,l=Two.Utils.mod,n=function(b){_.each(b,function(a,b){this[b]=a},this);this.children={}};_.extend(n.prototype,{appendChild:function(b){var a=b.parent,e=b.id;_.isUndefined(a)||delete a.children[e];this.children[e]=b;b.parent=this;return this},removeChild:function(b){delete this.children[b.id];return this},render:function(b){var a=this.matrix;b.save();b.transform(a[0],a[1],a[2],a[3],a[4],a[5]);_.each(this.children,function(a){a.render(b)});b.restore();
return this}});var j=function(b){_.each(b,function(a,b){this[b]=a},this)};_.extend(j.prototype,{render:function(b){var a=this.matrix,e=this.stroke,c=this.linewidth,f=this.fill,j=this.opacity,k=this.cap,s=this.join,n=this.miter,q=this.curved,w=this.closed,t=this.commands,v=t.length,x=v-1;if(!this.visible)return this;b.save();a&&b.transform(a[0],a[1],a[2],a[3],a[4],a[5]);f&&(b.fillStyle=f);e&&(b.strokeStyle=e);c&&(b.lineWidth=c);n&&(b.miterLimit=n);s&&(b.lineJoin=s);k&&(b.lineCap=k);_.isNumber(j)&&
(b.globalAlpha=j);b.beginPath();_.each(t,function(a,e){var c=a.x.toFixed(3),f=a.y.toFixed(3);if(q){var j=w?l(e-1,v):Math.max(e-1,0),k=w?l(e+1,v):Math.min(e+1,x),p=t[j],k=t[k],j=p.v.x.toFixed(3),p=p.v.y.toFixed(3),m=a.u.x.toFixed(3),s=a.u.y.toFixed(3);0>=e?b.moveTo(c,f):(b.bezierCurveTo(j,p,m,s,c,f),e>=x&&w&&(j=a.v.x.toFixed(3),p=a.v.y.toFixed(3),m=k.u.x.toFixed(3),s=k.u.y.toFixed(3),c=k.x.toFixed(3),f=k.y.toFixed(3),b.bezierCurveTo(j,p,m,s,c,f)))}else 0>=e?b.moveTo(c,f):b.lineTo(c,f)});w&&!q&&b.closePath();
b.fill();b.stroke();b.restore()}});var f={toArray:function(b,a,e){return!a?_.map(b,function(a){return{x:a.x,y:a.y}}):k(b,e)}},c=Two[Two.Types.canvas]=function(){this.domElement=document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.elements=[];this.stage=null};_.extend(c,{});_.extend(c,{Group:n,Element:j,getStyles:function(b){var a={},e=b.id,c=b._matrix,j=b.stroke,k=b.linewidth,m=b.fill,l=b.opacity,n=b.visible,q=b.cap,w=b.join,t=b.miter,v=b.curved,x=b.closed;b=b.vertices;
e&&(a.id=e);_.isObject(c)&&(a.matrix=c.toArray());j&&(a.stroke=j);m&&(a.fill=m);_.isNumber(l)&&(a.opacity=l);q&&(a.cap=q);w&&(a.join=w);t&&(a.miter=t);k&&(a.linewidth=k);b&&(a.commands=f.toArray(b,v,x));a.visible=!!n;a.curved=!!v;a.closed=!!x;return a},setStyles:function(b,a,e,c,j){switch(a){case "matrix":a="matrix";e=e.toArray();break;case "vertices":a="commands",b.curved=j,b.closed=c,e=f.toArray(e,b.curved,b.closed)}b[a]=e},Utils:f});_.extend(c.prototype,Backbone.Events,{setSize:function(b,a){this.width=
this.domElement.width=b;this.height=this.domElement.height=a;_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});return this},add:function(b){constructor=Object.getPrototypeOf(this).constructor;var a=b,e=this.elements,c=constructor.Group,f=constructor.Element,j=constructor.getStyles;_.isArray(b)||(a=_.map(arguments,function(a){return a}));_.each(a,function(a){var b;b=a instanceof Two.Group;var k=_.isNull(this.stage);if(_.isUndefined(a.id)){var l=q;q++;a.id=l}b?(b=j.call(this,
a),delete b.stroke,delete b.fill,delete b.opacity,delete b.cap,delete b.join,delete b.miter,delete b.linewidth,b=new c(b),k&&(this.stage=b,this.stage.object=a,a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):b=new f(j.call(this,a));e.push(b);k||this.stage.appendChild(b)},this);return this},update:function(b,a,e,c,f,j){var k=Object.getPrototypeOf(this).constructor,l=this.elements,n=l[b];switch(a){case Two.Properties.hierarchy:_.each(e,function(a){n.appendChild(l[a])});
break;case Two.Properties.demotion:_.each(e,function(a){n.removeChild(l[a]);this.elements[a]=null},this);default:k.setStyles.call(this,n,a,e,c,f,j)}return this},render:function(){if(_.isNull(this.stage))return this;this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);return this}})})();(function(){var q=Two[Two.Types.canvas],k=Two.Matrix.Multiply,l=Two[Two.Types.canvas].Utils.toArray,n=Two.Utils.mod,j=function(a){q.Group.call(this,a)};_.extend(j.prototype,q.Group.prototype,{appendChild:function(){q.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},updateTexture:function(a){_.each(this.children,function(b){b.updateTexture(a)});return this},updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;
if(!b)return this;this._matrix=k(this.matrix,b);this._scale=this.scale*a;_.each(this.children,function(a){a.updateMatrix(this)},this);return this},render:function(a,b){_.each(this.children,function(c){c.render(a,b)})}});var f=function(a){q.Element.call(this,a)};_.extend(f.prototype,q.Element.prototype,{updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=k(this.matrix,b);this._scale=this.scale*a;
return this},updateTexture:function(a){c.updateTexture(a,this);return this},render:function(a,b){if(!this.visible||!this.opacity||!this.buffer)return this;a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordsBuffer);a.vertexAttribPointer(b.textureCoords,2,a.FLOAT,!1,0,0);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniformMatrix3fv(b.matrix,!1,this._matrix);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.vertexAttribPointer(b.position,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,6);return this}});var c={canvas:document.createElement("canvas"),
uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(a,b,c){var f=Infinity,j=-Infinity,k=Infinity,l=-Infinity;_.each(a,function(a){var b=a.x,e=a.y,n;k=Math.min(e,k);f=Math.min(b,f);j=Math.max(b,j);l=Math.max(e,l);c&&(b=a.u.x,e=a.u.y,n=a.v.x,a=a.v.y,k=Math.min(e,a,k),f=Math.min(b,n,f),j=Math.max(b,n,j),l=Math.max(e,a,l))});_.isNumber(b)&&(k-=b,f-=b,j+=b,l+=b);a=j-f;b=l-k;var n={x:Math.abs(f),y:Math.abs(k)};return{top:k,left:f,right:j,bottom:l,width:a,height:b,centroid:n}},getTriangles:function(a){var b=
a.top,c=a.left,f=a.right;a=a.bottom;return new Two.Array([c,b,f,b,c,a,c,a,f,b,f,a])},updateCanvas:function(a){var b=a.commands,c=this.canvas,f=this.ctx,j=a._scale,k=a.stroke,l=a.linewidth*j,q=a.fill,B=a.opacity,w=a.cap,t=a.join,v=a.miter,x=a.curved,d=a.closed,y=b.length,E=y-1;c.width=Math.ceil(a.rect.width*j);c.height=Math.ceil(a.rect.height*j);a=a.rect.centroid;var F=a.x*j,I=a.y*j;f.clearRect(0,0,c.width,c.height);q&&(f.fillStyle=q);k&&(f.strokeStyle=k);l&&(f.lineWidth=l);v&&(f.miterLimit=v);t&&
(f.lineJoin=t);w&&(f.lineCap=w);_.isNumber(B)&&(f.globalAlpha=B);f.beginPath();_.each(b,function(a,c){var k=(a.x*j+F).toFixed(3),p=(a.y*j+I).toFixed(3);if(x){var l=d?n(c-1,y):Math.max(c-1,0),m=d?n(c+1,y):Math.min(c+1,E),q=b[l],m=b[m],l=(q.v.x*j+F).toFixed(3),q=(q.v.y*j+I).toFixed(3),s=(a.u.x*j+F).toFixed(3),r=(a.u.y*j+I).toFixed(3);0>=c?f.moveTo(k,p):(f.bezierCurveTo(l,q,s,r,k,p),c>=E&&d&&(l=(a.v.x*j+F).toFixed(3),q=(a.v.y*j+I).toFixed(3),s=(m.u.x*j+F).toFixed(3),r=(m.u.y*j+I).toFixed(3),k=(m.x*j+
F).toFixed(3),p=(m.y*j+I).toFixed(3),f.bezierCurveTo(l,q,s,r,k,p)))}else 0>=c?f.moveTo(k,p):f.lineTo(k,p)});d&&!x&&f.closePath();f.fill();f.stroke()},updateTexture:function(a,b){this.updateCanvas(b);b.texture&&a.deleteTexture(b.texture);a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);b.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.LINEAR);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,c){_.isObject(b.buffer)&&a.deleteBuffer(b.buffer);b.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.buffer);a.enableVertexAttribArray(c.position);a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.textureCoordsBuffer)&&a.deleteBuffer(b.textureCoordsBuffer);b.textureCoordsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);a.enableVertexAttribArray(c.textureCoords);
a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){var c=a.createProgram();_.each(b,function(b){a.attachShader(c,b)});a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw error=a.getProgramInfoLog(c),new Two.Utils.Error("unable to link program: "+error);return c}},shaders:{create:function(a,b,c){c=a.createShader(a[c]);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a=a.getShaderInfoLog(c),new Two.Utils.Error("unable to compile shader "+
c+": "+a);return c},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 a_position;\nattribute vec2 a_textureCoords;\n\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\n\nvarying vec2 v_textureCoords;\n\nvoid main() {\n   vec2 projected = (u_matrix * vec3(a_position, 1)).xy;\n   vec2 normal = projected / u_resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n   v_textureCoords = a_textureCoords;\n}",
fragment:"precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_textureCoords;\n\nvoid main() {\n  gl_FragColor = texture2D(u_image, v_textureCoords);\n}"}};c.ctx=c.canvas.getContext("2d");var b=Two[Two.Types.webgl]=function(a){this.domElement=document.createElement("canvas");this.elements=[];this.stage=null;a=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1});a=this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",
a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var b=c.shaders.create(a,c.shaders.vertex,c.shaders.types.vertex),f=c.shaders.create(a,c.shaders.fragment,c.shaders.types.fragment);this.program=c.program.create(a,[b,f]);a.useProgram(this.program);this.program.position=a.getAttribLocation(this.program,"a_position");this.program.matrix=a.getUniformLocation(this.program,"u_matrix");this.program.textureCoords=a.getAttribLocation(this.program,"a_textureCoords");
a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)};_.extend(b,{Group:j,Element:f,getStyles:function(a){var b={},f=a.id,j=a._matrix,k=a.stroke,m=a.linewidth,n=a.fill,q=a.opacity,B=a.visible,w=a.cap,t=a.join,v=a.miter,x=a.curved,d=a.closed;a=a.vertices;f&&(b.id=f);_.isObject(j)&&(b.matrix=b._matrix=j.toArray(!0),b.scale=b._scale=1);k&&(b.stroke=k);n&&(b.fill=n);_.isNumber(q)&&(b.opacity=
q);w&&(b.cap=w);t&&(b.join=t);v&&(b.miter=v);m&&(b.linewidth=m);a&&(b.vertices=l(a,x,d),b.commands=b.vertices,b.rect=c.getBoundingClientRect(b.commands,b.linewidth,b.curved),b.triangles=c.getTriangles(b.rect));b.visible=!!B;b.curved=!!x;b.closed=!!d;return b},setStyles:function(a,b,f,j,k,m){var n=!1;/matrix/.test(b)?(a[b]=f.toArray(!0),_.isNumber(j)&&(n=a.scale!==j,a.scale=j),a.updateMatrix()):/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(b)?(a[b]=f,a.rect=c.getBoundingClientRect(a.commands,
a.linewidth,a.curved),a.triangles=c.getTriangles(a.rect),c.updateBuffer(this.ctx,a,this.program),n=!0):"vertices"===b?(_.isUndefined(j)||(a.closed=j),_.isUndefined(k)||(a.curved=k),m?a.commands=l(f,a.curved,a.closed):(a.vertices=l(f,a.curved,a.closed),a.commands=a.vertices),a.rect=c.getBoundingClientRect(a.vertices,a.linewidth,a.curved),a.triangles=c.getTriangles(a.rect),c.updateBuffer(this.ctx,a,this.program),n=!0):a[b]=f;n&&a.updateTexture(this.ctx)}});_.extend(b.prototype,Backbone.Events,q.prototype,
{setSize:function(a,b){q.prototype.setSize.apply(this,arguments);this.ctx.viewport(0,0,a,b);var c=this.ctx.getUniformLocation(this.program,"u_resolution");this.ctx.uniform2f(c,a,b);return this},render:function(){if(_.isNull(this.stage))return this;this.stage.render(this.ctx,this.program);return this}})})();(function(){var q=Two.Shape=function(k){this._matrix=new Two.Matrix;var l=_.debounce(_.bind(function(){var k=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",k,this.scale)},this),0);this._rotation="rotation";Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(k){this._rotation=k;l()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(k){this._scale=k;l()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,l);if(k)return this;q.MakeGetterSetter(this,q.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.miter=this.join=this.cap="round"};_.extend(q,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(k,l){_.isArray(l)||(l=[l]);_.each(l,function(l){var j="_"+l;Object.defineProperty(k,
l,{get:function(){return this[j]},set:function(f){this[j]=f;this.trigger(Two.Events.change,this.id,l,f,this)}})})}});_.extend(q.prototype,Backbone.Events,{addTo:function(k){k.add(this);return this},noFill:function(){this.fill="none";return this},noStroke:function(){this.stroke="none";return this},clone:function(){var k=new q;k.translation.copy(this.translation);_.each(q.Properties,function(l){k[l]=this[l]},this);return this}})})();(function(){var q=Two.Group=function(){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;q.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(q,{MakeGetterSetter:function(k,l){_.isArray(l)||(l=[l]);_.each(l,function(l){var j="_"+l;Object.defineProperty(k,l,{get:function(){return this[j]},set:function(f){this[j]=f;_.each(this.children,function(c){c[l]=f})}})})}});_.extend(q.prototype,
Two.Shape.prototype,{add:function(k){var l=k,n=this.children,j=this.parent,f=[];_.isArray(k)||(l=_.toArray(arguments));var c=_.bind(function(b,a,c,f,j,k){this.trigger(Two.Events.change,b,a,c,f,j,k)},this);_.each(l,function(b){var a=b.id,e=b.parent;_.isUndefined(a)&&(j.add(b),a=b.id);_.isUndefined(n[a])&&(e&&delete e.children[a],n[a]=b,b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,c),f.push(a))},this);0<f.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,f);
return this.center()},center:function(){var k=this.getBoundingClientRect();k.centroid={x:k.left+k.width/2,y:k.top+k.height/2};_.each(this.children,function(l){l.translation.subSelf(k.centroid)});this.translation.copy(k.centroid);return this},remove:function(k){var l=k,n=this.children,j=this.parent,f=[];if(0>=arguments.length&&j)return j.remove(this),this;_.isArray(k)||(l=_.toArray(arguments));_.each(l,function(c){var b=c.id;b in n&&(delete n[b],c.unbind(Two.Events.change),f.push(b))});0<f.length&&
this.trigger(Two.Events.change,this.id,Two.Properties.demotion,f);return this.center()},getBoundingClientRect:function(){var k=Infinity,l=-Infinity,n=Infinity,j=-Infinity;_.each(this.children,function(b){b=b.getBoundingClientRect();n=Math.min(b.top,n);k=Math.min(b.left,k);l=Math.max(b.right,l);j=Math.max(b.bottom,j)},this);var f=this._matrix.multiply(k,n,1),c=this._matrix.multiply(l,j,1);return{top:f.y,left:f.x,right:c.x,bottom:c.y,width:c.x-f.x,height:c.y-f.y}},noFill:function(){_.each(this.children,
function(k){k.noFill()});return this},noStroke:function(){_.each(this.children,function(k){k.noStroke()});return this}})})();(function(){var q=Math.min,k=Math.max,l=Math.round,n=Two.Polygon=function(j,f,c){Two.Shape.call(this);f=!!f;c=!!c;var b=0,a=1,e=!1,p=j.slice(0),n=_.debounce(_.bind(function(){var j,k;if(e){j=this.vertices.length;j-=1;k=l(b*j);j=l(a*j);for(p.length=0;k<j+1;k++){var n=this.vertices[k];p.push(new Two.Vector(n.x,n.y))}}this.trigger(Two.Events.change,this.id,"vertices",p,f,c,e);e=!1},this),0);Object.defineProperty(this,"closed",{get:function(){return f},set:function(a){f=!!a;n()}});Object.defineProperty(this,
"curved",{get:function(){return c},set:function(a){c=!!a;n()}});Object.defineProperty(this,"beginning",{get:function(){return b},set:function(a){b=q(k(a,0),1);e=!0;n()}});Object.defineProperty(this,"ending",{get:function(){return a},set:function(b){a=q(k(b,0),1);e=!0;n()}});this.vertices=j.slice(0);_.each(this.vertices,function(a){a.bind(Two.Events.change,n)},this);n()};_.extend(n,{});_.extend(n.prototype,Two.Shape.prototype,{clone:function(){var j=_.map(this.vertices,function(c){return new Two.Vector(c.x,
c.y)}),f=new n(j,this.closed,this.curved);_.each(Two.Shape.Properties,function(c){f[c]=this[c]},this);f.translation.copy(this.translation);f.rotation=this.rotation;f.scale=this.scale;return f},center:function(){var j=this.getBoundingClientRect();j.centroid={x:j.left+j.width/2,y:j.top+j.height/2};_.each(this.vertices,function(f){f.subSelf(j.centroid)});this.translation.addSelf(j.centroid);return this},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(){var j=
this.linewidth,f=Infinity,c=-Infinity,b=Infinity,a=-Infinity;_.each(this.vertices,function(e){var j=e.x;e=e.y;b=Math.min(e,b);f=Math.min(j,f);c=Math.max(j,c);a=Math.max(e,a)});var b=b-j,f=f-j,c=c+j,a=a+j,j=this._matrix.multiply(f,b,1),e=this._matrix.multiply(c,a,1);return{top:j.y,left:j.x,right:e.x,bottom:e.y,width:e.x-j.x,height:e.y-j.y}}})})();
