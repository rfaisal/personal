(function(){function p(a,b,c){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a._chain&&(a=a._wrapped);b._chain&&(b=b._wrapped);if(a.isEqual&&e.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&e.isFunction(b.isEqual))return b.isEqual(a);var g=j.call(a);if(g!=j.call(b))return!1;switch(g){case "[object String]":return a==String(b);case "[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==
b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var d=c.length;d--;)if(c[d]==a)return!0;c.push(a);var d=0,f=!0;if("[object Array]"==g){if(d=a.length,f=d==b.length)for(;d--&&(f=d in a==d in b&&p(a[d],b[d],c)););}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(e.has(a,h)&&(d++,!(f=e.has(b,h)&&p(a[h],b[h],c))))break;if(f){for(h in b)if(e.has(b,h)&&!d--)break;
f=!d}}c.pop();return f}var a=this,b=a._,c={},d=Array.prototype,f=Object.prototype,h=d.slice,g=d.unshift,j=f.toString,l=f.hasOwnProperty,m=d.forEach,n=d.map,r=d.reduce,k=d.reduceRight,s=d.filter,z=d.every,w=d.some,t=d.indexOf,q=d.lastIndexOf,f=Array.isArray,v=Object.keys,u=Function.prototype.bind,e=function(a){return new E(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=e),exports._=e):a._=e;e.VERSION="1.3.3";var x=e.each=e.forEach=function(a,
b,d){if(null!=a)if(m&&a.forEach===m)a.forEach(b,d);else if(a.length===+a.length)for(var g=0,f=a.length;g<f&&!(g in a&&b.call(d,a[g],g,a)===c);g++);else for(g in a)if(e.has(a,g)&&b.call(d,a[g],g,a)===c)break};e.map=e.collect=function(a,b,e){var c=[];if(null==a)return c;if(n&&a.map===n)return a.map(b,e);x(a,function(a,D,d){c[c.length]=b.call(e,a,D,d)});a.length===+a.length&&(c.length=a.length);return c};e.reduce=e.foldl=e.inject=function(a,b,c,d){var g=2<arguments.length;null==a&&(a=[]);if(r&&a.reduce===
r)return d&&(b=e.bind(b,d)),g?a.reduce(b,c):a.reduce(b);x(a,function(a,e,D){g?c=b.call(d,c,a,e,D):(c=a,g=!0)});if(!g)throw new TypeError("Reduce of empty array with no initial value");return c};e.reduceRight=e.foldr=function(a,b,c,d){var g=2<arguments.length;null==a&&(a=[]);if(k&&a.reduceRight===k)return d&&(b=e.bind(b,d)),g?a.reduceRight(b,c):a.reduceRight(b);var f=e.toArray(a).reverse();d&&!g&&(b=e.bind(b,d));return g?e.reduce(f,b,c,d):e.reduce(f,b)};e.find=e.detect=function(a,b,e){var c;F(a,function(a,
d,g){if(b.call(e,a,d,g))return c=a,!0});return c};e.filter=e.select=function(a,b,e){var c=[];if(null==a)return c;if(s&&a.filter===s)return a.filter(b,e);x(a,function(a,d,g){b.call(e,a,d,g)&&(c[c.length]=a)});return c};e.reject=function(a,b,e){var c=[];if(null==a)return c;x(a,function(a,d,g){b.call(e,a,d,g)||(c[c.length]=a)});return c};e.every=e.all=function(a,b,e){var d=!0;if(null==a)return d;if(z&&a.every===z)return a.every(b,e);x(a,function(a,g,D){if(!(d=d&&b.call(e,a,g,D)))return c});return!!d};
var F=e.some=e.any=function(a,b,d){b||(b=e.identity);var g=!1;if(null==a)return g;if(w&&a.some===w)return a.some(b,d);x(a,function(a,e,D){if(g||(g=b.call(d,a,e,D)))return c});return!!g};e.include=e.contains=function(a,b){var e=!1;return null==a?e:t&&a.indexOf===t?-1!=a.indexOf(b):e=F(a,function(a){return a===b})};e.invoke=function(a,b){var c=h.call(arguments,2);return e.map(a,function(a){return(e.isFunction(b)?b||a:a[b]).apply(a,c)})};e.pluck=function(a,b){return e.map(a,function(a){return a[b]})};
e.max=function(a,b,c){if(!b&&e.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&e.isEmpty(a))return-Infinity;var d={computed:-Infinity};x(a,function(a,e,g){e=b?b.call(c,a,e,g):a;e>=d.computed&&(d={value:a,computed:e})});return d.value};e.min=function(a,b,c){if(!b&&e.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&e.isEmpty(a))return Infinity;var d={computed:Infinity};x(a,function(a,e,g){e=b?b.call(c,a,e,g):a;e<d.computed&&(d={value:a,computed:e})});return d.value};e.shuffle=
function(a){var b=[],e;x(a,function(a,c){e=Math.floor(Math.random()*(c+1));b[c]=b[e];b[e]=a});return b};e.sortBy=function(a,b,c){var d=e.isFunction(b)?b:function(a){return a[b]};return e.pluck(e.map(a,function(a,b,e){return{value:a,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var e=a.criteria,c=b.criteria;return void 0===e?1:void 0===c?-1:e<c?-1:e>c?1:0}),"value")};e.groupBy=function(a,b){var c={},d=e.isFunction(b)?b:function(a){return a[b]};x(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)});
return c};e.sortedIndex=function(a,b,c){c||(c=e.identity);for(var d=0,g=a.length;d<g;){var f=d+g>>1;c(a[f])<c(b)?d=f+1:g=f}return d};e.toArray=function(a){return!a?[]:e.isArray(a)||e.isArguments(a)?h.call(a):a.toArray&&e.isFunction(a.toArray)?a.toArray():e.values(a)};e.size=function(a){return e.isArray(a)?a.length:e.keys(a).length};e.first=e.head=e.take=function(a,b,e){return null!=b&&!e?h.call(a,0,b):a[0]};e.initial=function(a,b,e){return h.call(a,0,a.length-(null==b||e?1:b))};e.last=function(a,
b,e){return null!=b&&!e?h.call(a,Math.max(a.length-b,0)):a[a.length-1]};e.rest=e.tail=function(a,b,e){return h.call(a,null==b||e?1:b)};e.compact=function(a){return e.filter(a,function(a){return!!a})};e.flatten=function(a,b){return e.reduce(a,function(a,c){if(e.isArray(c))return a.concat(b?c:e.flatten(c));a[a.length]=c;return a},[])};e.without=function(a){return e.difference(a,h.call(arguments,1))};e.uniq=e.unique=function(a,b,c){c=c?e.map(a,c):a;var d=[];3>a.length&&(b=!0);e.reduce(c,function(c,g,
f){if(b?e.last(c)!==g||!c.length:!e.include(c,g))c.push(g),d.push(a[f]);return c},[]);return d};e.union=function(){return e.uniq(e.flatten(arguments,!0))};e.intersection=e.intersect=function(a){var b=h.call(arguments,1);return e.filter(e.uniq(a),function(a){return e.every(b,function(b){return 0<=e.indexOf(b,a)})})};e.difference=function(a){var b=e.flatten(h.call(arguments,1),!0);return e.filter(a,function(a){return!e.include(b,a)})};e.zip=function(){for(var a=h.call(arguments),b=e.max(e.pluck(a,"length")),
c=Array(b),d=0;d<b;d++)c[d]=e.pluck(a,""+d);return c};e.indexOf=function(a,b,c){if(null==a)return-1;var d;if(c)return c=e.sortedIndex(a,b),a[c]===b?c:-1;if(t&&a.indexOf===t)return a.indexOf(b);c=0;for(d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1};e.lastIndexOf=function(a,b){if(null==a)return-1;if(q&&a.lastIndexOf===q)return a.lastIndexOf(b);for(var e=a.length;e--;)if(e in a&&a[e]===b)return e;return-1};e.range=function(a,b,e){1>=arguments.length&&(b=a||0,a=0);e=arguments[2]||1;for(var c=
Math.max(Math.ceil((b-a)/e),0),d=0,g=Array(c);d<c;)g[d++]=a,a+=e;return g};var R=function(){};e.bind=function(a,b){var c,d;if(a.bind===u&&u)return u.apply(a,h.call(arguments,1));if(!e.isFunction(a))throw new TypeError;d=h.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,d.concat(h.call(arguments)));R.prototype=a.prototype;var e=new R,g=a.apply(e,d.concat(h.call(arguments)));return Object(g)===g?g:e}};e.bindAll=function(a){var b=h.call(arguments,1);0==b.length&&(b=e.functions(a));
x(b,function(b){a[b]=e.bind(a[b],a)});return a};e.memoize=function(a,b){var c={};b||(b=e.identity);return function(){var d=b.apply(this,arguments);return e.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}};e.delay=function(a,b){var e=h.call(arguments,2);return setTimeout(function(){return a.apply(null,e)},b)};e.defer=function(a){return e.delay.apply(e,[a,1].concat(h.call(arguments,1)))};e.throttle=function(a,b){var c,d,g,f,h,j,q=e.debounce(function(){h=f=!1},b);return function(){c=this;d=arguments;g||
(g=setTimeout(function(){g=null;h&&a.apply(c,d);q()},b));f?h=!0:j=a.apply(c,d);q();f=!0;return j}};e.debounce=function(a,b,e){var c;return function(){var d=this,g=arguments;e&&!c&&a.apply(d,g);clearTimeout(c);c=setTimeout(function(){c=null;e||a.apply(d,g)},b)}};e.once=function(a){var b=!1,e;return function(){if(b)return e;b=!0;return e=a.apply(this,arguments)}};e.wrap=function(a,b){return function(){var e=[a].concat(h.call(arguments,0));return b.apply(this,e)}};e.compose=function(){var a=arguments;
return function(){for(var b=arguments,e=a.length-1;0<=e;e--)b=[a[e].apply(this,b)];return b[0]}};e.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};e.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)e.has(a,c)&&(b[b.length]=c);return b};e.values=function(a){return e.map(a,e.identity)};e.functions=e.methods=function(a){var b=[],c;for(c in a)e.isFunction(a[c])&&b.push(c);return b.sort()};e.extend=function(a){x(h.call(arguments,
1),function(b){for(var e in b)a[e]=b[e]});return a};e.pick=function(a){var b={};x(e.flatten(h.call(arguments,1)),function(e){e in a&&(b[e]=a[e])});return b};e.defaults=function(a){x(h.call(arguments,1),function(b){for(var e in b)null==a[e]&&(a[e]=b[e])});return a};e.clone=function(a){return!e.isObject(a)?a:e.isArray(a)?a.slice():e.extend({},a)};e.tap=function(a,b){b(a);return a};e.isEqual=function(a,b){return p(a,b,[])};e.isEmpty=function(a){if(null==a)return!0;if(e.isArray(a)||e.isString(a))return 0===
a.length;for(var b in a)if(e.has(a,b))return!1;return!0};e.isElement=function(a){return!!(a&&1==a.nodeType)};e.isArray=f||function(a){return"[object Array]"==j.call(a)};e.isObject=function(a){return a===Object(a)};e.isArguments=function(a){return"[object Arguments]"==j.call(a)};e.isArguments(arguments)||(e.isArguments=function(a){return!(!a||!e.has(a,"callee"))});e.isFunction=function(a){return"[object Function]"==j.call(a)};e.isString=function(a){return"[object String]"==j.call(a)};e.isNumber=function(a){return"[object Number]"==
j.call(a)};e.isFinite=function(a){return e.isNumber(a)&&isFinite(a)};e.isNaN=function(a){return a!==a};e.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==j.call(a)};e.isDate=function(a){return"[object Date]"==j.call(a)};e.isRegExp=function(a){return"[object RegExp]"==j.call(a)};e.isNull=function(a){return null===a};e.isUndefined=function(a){return void 0===a};e.has=function(a,b){return l.call(a,b)};e.noConflict=function(){a._=b;return this};e.identity=function(a){return a};e.times=
function(a,b,e){for(var c=0;c<a;c++)b.call(e,c)};e.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};e.result=function(a,b){if(null==a)return null;var c=a[b];return e.isFunction(c)?c.call(a):c};e.mixin=function(a){x(e.functions(a),function(b){var c=e[b]=a[b];E.prototype[b]=function(){var a=h.call(arguments);g.call(a,this._wrapped);return J(c.apply(e,a),this._chain)}})};var S=0;e.uniqueId=
function(a){var b=S++;return a?a+b:b};e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/.^/,I={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},L;for(L in I)I[I[L]]=L;var T=/\\|'|\r|\n|\t|\u2028|\u2029/g,U=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(a){return a.replace(U,function(a,b){return I[b]})};e.template=function(a,b,c){c=e.defaults(c||{},e.templateSettings);a="__p+='"+a.replace(T,function(a){return"\\"+I[a]}).replace(c.escape||
K,function(a,b){return"'+\n_.escape("+M(b)+")+\n'"}).replace(c.interpolate||K,function(a,b){return"'+\n("+M(b)+")+\n'"}).replace(c.evaluate||K,function(a,b){return"';\n"+M(b)+"\n;__p+='"})+"';\n";c.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var d=new Function(c.variable||"obj","_",a);if(b)return d(b,e);b=function(a){return d.call(this,a,e)};b.source="function("+(c.variable||"obj")+"){\n"+a+"}";return b};
e.chain=function(a){return e(a).chain()};var E=function(a){this._wrapped=a};e.prototype=E.prototype;var J=function(a,b){return b?e(a).chain():a};e.mixin(e);x("pop push reverse shift sort splice unshift".split(" "),function(a){var b=d[a];E.prototype[a]=function(){var e=this._wrapped;b.apply(e,arguments);var c=e.length;("shift"==a||"splice"==a)&&0===c&&delete e[0];return J(e,this._chain)}});x(["concat","join","slice"],function(a){var b=d[a];E.prototype[a]=function(){return J(b.apply(this._wrapped,arguments),
this._chain)}});E.prototype.chain=function(){this._chain=!0;return this};E.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};
(function(){var p=[].slice,a=/\s+/,b=function(b,c,d,j){if(!d)return!0;if("object"===typeof d)for(var l in d)b[c].apply(b,[l,d[l]].concat(j));else if(a.test(d)){d=d.split(a);l=0;for(var m=d.length;l<m;l++)b[c].apply(b,[d[l]].concat(j))}else return!0},c=function(a,b,c){var d;a=-1;var l=b.length;switch(c.length){case 0:for(;++a<l;)(d=b[a]).callback.call(d.ctx);break;case 1:for(;++a<l;)(d=b[a]).callback.call(d.ctx,c[0]);break;case 2:for(;++a<l;)(d=b[a]).callback.call(d.ctx,c[0],c[1]);break;case 3:for(;++a<
l;)(d=b[a]).callback.call(d.ctx,c[0],c[1],c[2]);break;default:for(;++a<l;)(d=b[a]).callback.apply(d.ctx,c)}},d=Backbone.Events={on:function(a,c,d){if(!b(this,"on",a,[c,d])||!c)return this;this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:c,context:d,ctx:d||this});return this},once:function(a,c,d){if(!b(this,"once",a,[c,d])||!c)return this;var j=this,l=_.once(function(){j.off(a,l);c.apply(this,arguments)});l._callback=c;this.on(a,l,d);return this},off:function(a,
c,d){var j,l,m,n,r,k,s,p;if(!this._events||!b(this,"off",a,[c,d]))return this;if(!a&&!c&&!d)return this._events={},this;n=a?[a]:_.keys(this._events);r=0;for(k=n.length;r<k;r++)if(a=n[r],j=this._events[a]){m=[];if(c||d){s=0;for(p=j.length;s<p;s++)l=j[s],(c&&c!==(l.callback._callback||l.callback)||d&&d!==l.context)&&m.push(l)}this._events[a]=m}return this},trigger:function(a){if(!this._events)return this;var d=p.call(arguments,1);if(!b(this,"trigger",a,d))return this;var g=this._events[a],j=this._events.all;
g&&c(this,g,d);j&&c(this,j,arguments);return this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),l=a._listenerId||(a._listenerId=_.uniqueId("l"));d[l]=a;a.on(b,c||this,this);return this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a)a.off(b,c,this),!b&&!c&&delete d[a._listenerId];else{for(var l in d)d[l].off(null,null,this);this._listeners={}}return this}}};d.bind=d.on;d.unbind=d.off})();(function(){for(var p=0,a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),f=Math.max(0,16-(b-p)),h=window.setTimeout(function(){a(b+f)},f);p=b+f;return h});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();(function(){var p=this;previousTessellation=p.tessellation;tessellation=p.tessellation={noConflict:function(){p.tessellation=previousTessellation;return this}};tessellation.cmp=function(a,b){return a.y==b.y?a.x-b.x:a.y-b.y};tessellation.equals=function(a,b){return a.x==b.x&&a.y==b.y};tessellation.Edge=function(){this.q=this.p=null;2==arguments.length?arguments[0].y>arguments[1].y?(this.q=arguments[0],this.p=arguments[1]):arguments[0].y==arguments[1].y?arguments[0].x>arguments[1].x?(this.q=arguments[0],
this.p=arguments[1]):arguments[0].x==arguments[1].x?alert("Invalid tessellation.edge constructor call: repeated points!"):(this.p=arguments[0],this.q=arguments[1]):(this.p=arguments[0],this.q=arguments[1]):alert("Invalid tessellation.Edge constructor call!");this.p&&!_.isArray(this.p.edges)&&(this.p.edges=[]);this.q&&!_.isArray(this.q.edges)&&(this.q.edges=[]);this.q.edges.push(this)};tessellation.Triangle=function(a,b,c){this.points=[null,null,null];this.neighbors=[null,null,null];this.interior=
!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1];3==arguments.length&&(this.points[0]=a,this.points[1]=b,this.points[2]=c)};tessellation.Triangle.prototype.GetPoint=function(a){return this.points[a]};tessellation.Triangle.prototype.GetNeighbor=function(a){return this.neighbors[a]};tessellation.Triangle.prototype.ContainsP=function(){for(var a=!0,b=0;b<arguments.length;++b)a=a&&(arguments[b].equals(this.points[0])||arguments[b].equals(this.points[1])||arguments[b].equals(this.points[2]));
return a};tessellation.Triangle.prototype.ContainsE=function(){for(var a=!0,b=0;b<arguments.length;++b)a=a&&this.ContainsP(arguments[b].p,arguments[b].q);return a};tessellation.Triangle.prototype.IsInterior=function(){0!=arguments.length&&(this.interior=arguments[0]);return this.interior};tessellation.Triangle.prototype.MarkNeighbor=function(){var a;if(3==arguments.length){var b=arguments[0],c=arguments[1];a=arguments[2];b.equals(this.points[2])&&c.equals(this.points[1])||b.equals(this.points[1])&&
c.equals(this.points[2])?this.neighbors[0]=a:b.equals(this.points[0])&&c.equals(this.points[2])||b.equals(this.points[2])&&c.equals(this.points[0])?this.neighbors[1]=a:b.equals(this.points[0])&&c.equals(this.points[1])||b.equals(this.points[1])&&c.equals(this.points[0])?this.neighbors[2]=a:alert("Invalid tessellation.Triangle.MarkNeighbor call (1)!")}else 1==arguments.length?(a=arguments[0],a.ContainsP(this.points[1],this.points[2])?(this.neighbors[0]=a,a.MarkNeighbor(this.points[1],this.points[2],
this)):a.ContainsP(this.points[0],this.points[2])?(this.neighbors[1]=a,a.MarkNeighbor(this.points[0],this.points[2],this)):a.ContainsP(this.points[0],this.points[1])&&(this.neighbors[2]=a,a.MarkNeighbor(this.points[0],this.points[1],this))):alert("Invalid tessellation.Triangle.MarkNeighbor call! (2)")};tessellation.Triangle.prototype.ClearNeigbors=function(){this.neighbors[0]=null;this.neighbors[1]=null;this.neighbors[2]=null};tessellation.Triangle.prototype.ClearDelunayEdges=function(){this.delaunay_edge[0]=
!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};tessellation.Triangle.prototype.PointCW=function(a){return a.equals(this.points[0])?this.points[2]:a.equals(this.points[1])?this.points[0]:a.equals(this.points[2])?this.points[1]:null};tessellation.Triangle.prototype.PointCCW=function(a){return a.equals(this.points[0])?this.points[1]:a.equals(this.points[1])?this.points[2]:a.equals(this.points[2])?this.points[0]:null};tessellation.Triangle.prototype.NeighborCW=function(a){return a.equals(this.points[0])?
this.neighbors[1]:a.equals(this.points[1])?this.neighbors[2]:this.neighbors[0]};tessellation.Triangle.prototype.NeighborCCW=function(a){return a.equals(this.points[0])?this.neighbors[2]:a.equals(this.points[1])?this.neighbors[0]:this.neighbors[1]};tessellation.Triangle.prototype.GetConstrainedEdgeCW=function(a){return a.equals(this.points[0])?this.constrained_edge[1]:a.equals(this.points[1])?this.constrained_edge[2]:this.constrained_edge[0]};tessellation.Triangle.prototype.GetConstrainedEdgeCCW=function(a){return a.equals(this.points[0])?
this.constrained_edge[2]:a.equals(this.points[1])?this.constrained_edge[0]:this.constrained_edge[1]};tessellation.Triangle.prototype.SetConstrainedEdgeCW=function(a,b){a.equals(this.points[0])?this.constrained_edge[1]=b:a.equals(this.points[1])?this.constrained_edge[2]=b:this.constrained_edge[0]=b};tessellation.Triangle.prototype.SetConstrainedEdgeCCW=function(a,b){a.equals(this.points[0])?this.constrained_edge[2]=b:a.equals(this.points[1])?this.constrained_edge[0]=b:this.constrained_edge[1]=b};tessellation.Triangle.prototype.GetDelaunayEdgeCW=
function(a){return a.equals(this.points[0])?this.delaunay_edge[1]:a.equals(this.points[1])?this.delaunay_edge[2]:this.delaunay_edge[0]};tessellation.Triangle.prototype.GetDelaunayEdgeCCW=function(a){return a.equals(this.points[0])?this.delaunay_edge[2]:a.equals(this.points[1])?this.delaunay_edge[0]:this.delaunay_edge[1]};tessellation.Triangle.prototype.SetDelaunayEdgeCW=function(a,b){a.equals(this.points[0])?this.delaunay_edge[1]=b:a.equals(this.points[1])?this.delaunay_edge[2]=b:this.delaunay_edge[0]=
b};tessellation.Triangle.prototype.SetDelaunayEdgeCCW=function(a,b){a.equals(this.points[0])?this.delaunay_edge[2]=b:a.equals(this.points[1])?this.delaunay_edge[0]=b:this.delaunay_edge[1]=b};tessellation.Triangle.prototype.NeighborAcross=function(a){return!a?this.neighbors[2]:a.equals(this.points[0])?this.neighbors[0]:a.equals(this.points[1])?this.neighbors[1]:this.neighbors[2]};tessellation.Triangle.prototype.OppositePoint=function(a,b){var c=a.PointCW(b);return this.PointCW(c)};tessellation.Triangle.prototype.Legalize=
function(){if(1==arguments.length)this.Legalize(this.points[0],arguments[0]);else if(2==arguments.length){var a=arguments[0],b=arguments[1];a.equals(this.points[0])?(this.points[1]=this.points[0],this.points[0]=this.points[2],this.points[2]=b):a.equals(this.points[1])?(this.points[2]=this.points[1],this.points[1]=this.points[0],this.points[0]=b):a.equals(this.points[2])?(this.points[0]=this.points[2],this.points[2]=this.points[1],this.points[1]=b):alert("Invalid tessellation.Triangle.Legalize call!")}else alert("Invalid tessellation.Triangle.Legalize call!")};
tessellation.Triangle.prototype.Index=function(a){return a.equals(this.points[0])?0:a.equals(this.points[1])?1:a.equals(this.points[2])?2:-1};tessellation.Triangle.prototype.EdgeIndex=function(a,b){if(a.equals(this.points[0])){if(b.equals(this.points[1]))return 2;if(b.equals(this.points[2]))return 1}else if(a.equals(this.points[1])){if(b.equals(this.points[2]))return 0;if(b.equals(this.points[0]))return 2}else if(a.equals(this.points[2])){if(b.equals(this.points[0]))return 1;if(b.equals(this.points[1]))return 0}return-1};
tessellation.Triangle.prototype.MarkConstrainedEdge=function(){if(1==arguments.length)"number"==typeof arguments[0]?this.constrained_edge[arguments[0]]=!0:this.MarkConstrainedEdge(arguments[0].p,arguments[0].q);else if(2==arguments.length){var a=arguments[0],b=arguments[1];if(b.equals(this.points[0])&&a.equals(this.points[1])||b.equals(this.points[1])&&a.equals(this.points[0]))this.constrained_edge[2]=!0;else if(b.equals(this.points[0])&&a.equals(this.points[2])||b.equals(this.points[2])&&a.equals(this.points[0]))this.constrained_edge[1]=
!0;else if(b.equals(this.points[1])&&a.equals(this.points[2])||b.equals(this.points[2])&&a.equals(this.points[1]))this.constrained_edge[0]=!0}else alert("Invalid tessellation.Triangle.MarkConstrainedEdge call!")};tessellation.PI_3div4=3*Math.PI/4;tessellation.PI_2=Math.PI/2;tessellation.EPSILON=1E-12;tessellation.kAlpha=0.3;tessellation.Orientation={CW:1,CCW:-1,COLLINEAR:0};tessellation.Orient2d=function(a,b,c){a=(a.x-c.x)*(b.y-c.y)-(a.y-c.y)*(b.x-c.x);return a>-tessellation.EPSILON&&a<tessellation.EPSILON?
tessellation.Orientation.COLLINEAR:0<a?tessellation.Orientation.CCW:tessellation.Orientation.CW};tessellation.InScanArea=function(a,b,c,d){var f=d.x;d=d.y;var h=a.x-f;a=a.y-d;return h*(b.y-d)-(b.x-f)*a<=tessellation.EPSILON||(c.x-f)*a-h*(c.y-d)<=tessellation.EPSILON?!1:!0};tessellation.Node=function(){this.prev=this.next=this.triangle=this.point=null;this.value=0;1==arguments.length?(this.point=arguments[0],this.value=this.point.x):2==arguments.length?(this.point=arguments[0],this.triangle=arguments[1],
this.value=this.point.x):alert("Invalid tessellation.Node constructor call!")};tessellation.AdvancingFront=function(a,b){this.head=a;this.tail=b;this.search_node=a};tessellation.AdvancingFront.prototype.search=function(){return this.search_node};tessellation.AdvancingFront.prototype.set_search=function(a){this.search_node=a};tessellation.AdvancingFront.prototype.FindSearchNode=function(){return this.search_node};tessellation.AdvancingFront.prototype.LocateNode=function(a){var b=this.search_node;if(a<
b.value)for(;null!=(b=b.prev);){if(a>=b.value)return this.search_node=b}else for(;null!=(b=b.next);)if(a<b.value)return this.search_node=b.prev;return null};tessellation.AdvancingFront.prototype.LocatePoint=function(a){var b=a.x,c=this.FindSearchNode(b),d=c.point.x;if(b==d)if(c.prev&&a.equals(c.prev.point))c=c.prev;else if(c.next&&a.equals(c.next.point))c=c.next;else{if(!a.equals(c.point))return alert("Invalid tessellation.AdvancingFront.LocatePoint call!"),null}else if(b<d)for(;null!=(c=c.prev)&&
!a.equals(c.point););else for(;null!=(c=c.next)&&!a.equals(c.point););null!=c&&(this.search_node=c);return c};tessellation.Basin=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};tessellation.Basin.prototype.Clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};tessellation.EdgeEvent=function(){this.constrained_edge=null;this.right=!1};tessellation.SweepContext=function(a){this.triangles=[];this.map=
[];this.points=a;this.edges=[];this.af_tail=this.af_middle_=this.af_head=this.tail=this.head=this.front=null;this.basin=new tessellation.Basin;this.edge_event=new tessellation.EdgeEvent;this.InitEdges(this.points)};tessellation.SweepContext.prototype.AddHole=function(a){this.InitEdges(a);for(var b in a)this.points.push(a[b])};tessellation.SweepContext.prototype.point_count=function(){return this.points.length};tessellation.SweepContext.prototype.GetTriangles=function(){return this.triangles};tessellation.SweepContext.prototype.GetMap=
function(){return this.map};tessellation.SweepContext.prototype.InitTriangulation=function(){var a=this.points[0].x,b=this.points[0].x,c=this.points[0].y,d=this.points[0].y,f;for(f in this.points){var h=this.points[f];h.x>a&&(a=h.x);h.x<b&&(b=h.x);h.y>c&&(c=h.y);h.y<d&&(d=h.y)}c=tessellation.kAlpha*(c-d);this.head=new Two.Vector(a+tessellation.kAlpha*(a-b),d-c);this.tail=new Two.Vector(b-c,d-c);this.points.sort(tessellation.cmp)};tessellation.SweepContext.prototype.InitEdges=function(a){for(var b=
0;b<a.length;++b)this.edges.push(new tessellation.Edge(a[b],a[(b+1)%a.length]))};tessellation.SweepContext.prototype.GetPoint=function(a){return this.points[a]};tessellation.SweepContext.prototype.AddToMap=function(a){this.map.push(a)};tessellation.SweepContext.prototype.LocateNode=function(a){return this.front.LocateNode(a.x)};tessellation.SweepContext.prototype.CreateAdvancingFront=function(){var a,b,c;c=new tessellation.Triangle(this.points[0],this.tail,this.head);this.map.push(c);a=new tessellation.Node(c.GetPoint(1),
c);b=new tessellation.Node(c.GetPoint(0),c);c=new tessellation.Node(c.GetPoint(2));this.front=new tessellation.AdvancingFront(a,c);a.next=b;b.next=c;b.prev=a;c.prev=b};tessellation.SweepContext.prototype.RemoveNode=function(){};tessellation.SweepContext.prototype.MapTriangleToNodes=function(a){for(var b=0;3>b;++b)if(null==a.GetNeighbor(b)){var c=this.front.LocatePoint(a.PointCW(a.GetPoint(b)));null!=c&&(c.triangle=a)}};tessellation.SweepContext.prototype.RemoveFromMap=function(a){for(var b in this.map)if(this.map[b]==
a){delete this.map[b];break}};tessellation.SweepContext.prototype.MeshClean=function(a){if(null!=a&&!a.IsInterior()){a.IsInterior(!0);this.triangles.push(a);for(var b=0;3>b;++b)a.constrained_edge[b]||this.MeshClean(a.GetNeighbor(b))}};tessellation.sweep={};tessellation.sweep.Triangulate=function(a){a.InitTriangulation();a.CreateAdvancingFront();tessellation.sweep.SweepPoints(a);tessellation.sweep.FinalizationPolygon(a)};tessellation.sweep.SweepPoints=function(a){for(var b=1;b<a.point_count();++b)for(var c=
a.GetPoint(b),d=tessellation.sweep.PointEvent(a,c),f=0;f<c.edges.length;++f)tessellation.sweep.EdgeEvent(a,c.edges[f],d)};tessellation.sweep.FinalizationPolygon=function(a){for(var b=a.front.head.next.triangle,c=a.front.head.next.point;!b.GetConstrainedEdgeCW(c);)b=b.NeighborCCW(c);a.MeshClean(b)};tessellation.sweep.PointEvent=function(a,b){var c=a.LocateNode(b),d=tessellation.sweep.NewFrontTriangle(a,b,c);b.x<=c.point.x+tessellation.EPSILON&&tessellation.sweep.Fill(a,c);tessellation.sweep.FillAdvancingFront(a,
d);return d};tessellation.sweep.EdgeEvent=function(){var a;if(3==arguments.length){a=arguments[0];var b=arguments[1],c=arguments[2];a.edge_event.constrained_edge=b;a.edge_event.right=b.p.x>b.q.x;tessellation.sweep.IsEdgeSideOfTriangle(c.triangle,b.p,b.q)||(tessellation.sweep.FillEdgeEvent(a,b,c),tessellation.sweep.EdgeEvent(a,b.p,b.q,c.triangle,b.q))}else if(5==arguments.length){a=arguments[0];var b=arguments[1],c=arguments[2],d=arguments[3],f=arguments[4];if(!tessellation.sweep.IsEdgeSideOfTriangle(d,
b,c)){var h=d.PointCCW(f),h=tessellation.Orient2d(c,h,b);if(h==tessellation.Orientation.COLLINEAR)alert("tessellation.sweep.EdgeEvent: Collinear not supported!");else{var g=d.PointCW(f),g=tessellation.Orient2d(c,g,b);g==tessellation.Orientation.COLLINEAR?alert("tessellation.sweep.EdgeEvent: Collinear not supported!"):h==g?(d=h==tessellation.Orientation.CW?d.NeighborCCW(f):d.NeighborCW(f),tessellation.sweep.EdgeEvent(a,b,c,d,f)):tessellation.sweep.FlipEdgeEvent(a,b,c,d,f)}}}};tessellation.sweep.IsEdgeSideOfTriangle=
function(a,b,c){var d=a.EdgeIndex(b,c);return-1!=d?(a.MarkConstrainedEdge(d),a=a.GetNeighbor(d),null!=a&&a.MarkConstrainedEdge(b,c),!0):!1};tessellation.sweep.NewFrontTriangle=function(a,b,c){var d=new tessellation.Triangle(b,c.point,c.next.point);d.MarkNeighbor(c.triangle);a.AddToMap(d);b=new tessellation.Node(b);b.next=c.next;b.prev=c;c.next.prev=b;c.next=b;tessellation.sweep.Legalize(a,d)||a.MapTriangleToNodes(d);return b};tessellation.sweep.Fill=function(a,b){var c=new tessellation.Triangle(b.prev.point,
b.point,b.next.point);c.MarkNeighbor(b.prev.triangle);c.MarkNeighbor(b.triangle);a.AddToMap(c);b.prev.next=b.next;b.next.prev=b.prev;tessellation.sweep.Legalize(a,c)||a.MapTriangleToNodes(c)};tessellation.sweep.FillAdvancingFront=function(a,b){for(var c=b.next,d;null!=c.next;){d=tessellation.sweep.HoleAngle(c);if(d>tessellation.PI_2||d<-tessellation.PI_2)break;tessellation.sweep.Fill(a,c);c=c.next}for(c=b.prev;null!=c.prev;){d=tessellation.sweep.HoleAngle(c);if(d>tessellation.PI_2||d<-tessellation.PI_2)break;
tessellation.sweep.Fill(a,c);c=c.prev}null!=b.next&&null!=b.next.next&&(d=tessellation.sweep.BasinAngle(b),d<tessellation.PI_3div4&&tessellation.sweep.FillBasin(a,b))};tessellation.sweep.BasinAngle=function(a){return Math.atan2(a.point.y-a.next.next.point.y,a.point.x-a.next.next.point.x)};tessellation.sweep.HoleAngle=function(a){var b=a.next.point.x-a.point.x,c=a.next.point.y-a.point.y,d=a.prev.point.x-a.point.x;a=a.prev.point.y-a.point.y;return Math.atan2(b*a-c*d,b*d+c*a)};tessellation.sweep.Legalize=
function(a,b){for(var c=0;3>c;++c)if(!b.delaunay_edge[c]){var d=b.GetNeighbor(c);if(null!=d){var f=b.GetPoint(c),h=d.OppositePoint(b,f),g=d.Index(h);if(d.constrained_edge[g]||d.delaunay_edge[g])b.constrained_edge[c]=d.constrained_edge[g];else if(tessellation.sweep.Incircle(f,b.PointCCW(f),b.PointCW(f),h))return b.delaunay_edge[c]=!0,d.delaunay_edge[g]=!0,tessellation.sweep.RotateTrianglePair(b,f,d,h),(f=!tessellation.sweep.Legalize(a,b))&&a.MapTriangleToNodes(b),(f=!tessellation.sweep.Legalize(a,
d))&&a.MapTriangleToNodes(d),b.delaunay_edge[c]=!1,d.delaunay_edge[g]=!1,!0}}return!1};tessellation.sweep.Incircle=function(a,b,c,d){var f=a.x-d.x;a=a.y-d.y;var h=b.x-d.x;b=b.y-d.y;var g=f*b-h*a;if(0>=g)return!1;var j=c.x-d.x;c=c.y-d.y;d=j*a-f*c;return 0>=d?!1:0<(f*f+a*a)*(h*c-j*b)+(h*h+b*b)*d+(j*j+c*c)*g};tessellation.sweep.RotateTrianglePair=function(a,b,c,d){var f,h,g,j;f=a.NeighborCCW(b);h=a.NeighborCW(b);g=c.NeighborCCW(d);j=c.NeighborCW(d);var l,m,n,r;l=a.GetConstrainedEdgeCCW(b);m=a.GetConstrainedEdgeCW(b);
n=c.GetConstrainedEdgeCCW(d);r=c.GetConstrainedEdgeCW(d);var k,s,p,w;k=a.GetDelaunayEdgeCCW(b);s=a.GetDelaunayEdgeCW(b);p=c.GetDelaunayEdgeCCW(d);w=c.GetDelaunayEdgeCW(d);a.Legalize(b,d);c.Legalize(d,b);c.SetDelaunayEdgeCCW(b,k);a.SetDelaunayEdgeCW(b,s);a.SetDelaunayEdgeCCW(d,p);c.SetDelaunayEdgeCW(d,w);c.SetConstrainedEdgeCCW(b,l);a.SetConstrainedEdgeCW(b,m);a.SetConstrainedEdgeCCW(d,n);c.SetConstrainedEdgeCW(d,r);a.ClearNeigbors();c.ClearNeigbors();f&&c.MarkNeighbor(f);h&&a.MarkNeighbor(h);g&&a.MarkNeighbor(g);
j&&c.MarkNeighbor(j);a.MarkNeighbor(c)};tessellation.sweep.FillBasin=function(a,b){a.basin.left_node=tessellation.Orient2d(b.point,b.next.point,b.next.next.point)==tessellation.Orientation.CCW?b.next.next:b.next;for(a.basin.bottom_node=a.basin.left_node;null!=a.basin.bottom_node.next&&a.basin.bottom_node.point.y>=a.basin.bottom_node.next.point.y;)a.basin.bottom_node=a.basin.bottom_node.next;if(a.basin.bottom_node!=a.basin.left_node){for(a.basin.right_node=a.basin.bottom_node;null!=a.basin.right_node.next&&
a.basin.right_node.point.y<a.basin.right_node.next.point.y;)a.basin.right_node=a.basin.right_node.next;a.basin.right_node!=a.basin.bottom_node&&(a.basin.width=a.basin.right_node.point.x-a.basin.left_node.point.x,a.basin.left_highest=a.basin.left_node.point.y>a.basin.right_node.point.y,tessellation.sweep.FillBasinReq(a,a.basin.bottom_node))}};tessellation.sweep.FillBasinReq=function(a,b){if(!tessellation.sweep.IsShallow(a,b)){tessellation.sweep.Fill(a,b);var c;if(!(b.prev==a.basin.left_node&&b.next==
a.basin.right_node)){if(b.prev==a.basin.left_node){c=tessellation.Orient2d(b.point,b.next.point,b.next.next.point);if(c==tessellation.Orientation.CW)return;b=b.next}else if(b.next==a.basin.right_node){c=tessellation.Orient2d(b.point,b.prev.point,b.prev.prev.point);if(c==tessellation.Orientation.CCW)return;b=b.prev}else b=b.prev.point.y<b.next.point.y?b.prev:b.next;tessellation.sweep.FillBasinReq(a,b)}}};tessellation.sweep.IsShallow=function(a,b){return a.basin.width>(a.basin.left_highest?a.basin.left_node.point.y-
b.point.y:a.basin.right_node.point.y-b.point.y)?!0:!1};tessellation.sweep.FillEdgeEvent=function(a,b,c){a.edge_event.right?tessellation.sweep.FillRightAboveEdgeEvent(a,b,c):tessellation.sweep.FillLeftAboveEdgeEvent(a,b,c)};tessellation.sweep.FillRightAboveEdgeEvent=function(a,b,c){for(;c.next.point.x<b.p.x;)tessellation.Orient2d(b.q,c.next.point,b.p)==tessellation.Orientation.CCW?tessellation.sweep.FillRightBelowEdgeEvent(a,b,c):c=c.next};tessellation.sweep.FillRightBelowEdgeEvent=function(a,b,c){c.point.x<
b.p.x&&(tessellation.Orient2d(c.point,c.next.point,c.next.next.point)==tessellation.Orientation.CCW?tessellation.sweep.FillRightConcaveEdgeEvent(a,b,c):(tessellation.sweep.FillRightConvexEdgeEvent(a,b,c),tessellation.sweep.FillRightBelowEdgeEvent(a,b,c)))};tessellation.sweep.FillRightConcaveEdgeEvent=function(a,b,c){tessellation.sweep.Fill(a,c.next);c.next.point!=b.p&&(tessellation.Orient2d(b.q,c.next.point,b.p)==tessellation.Orientation.CCW&&tessellation.Orient2d(c.point,c.next.point,c.next.next.point)==
tessellation.Orientation.CCW)&&tessellation.sweep.FillRightConcaveEdgeEvent(a,b,c)};tessellation.sweep.FillRightConvexEdgeEvent=function(a,b,c){tessellation.Orient2d(c.next.point,c.next.next.point,c.next.next.next.point)==tessellation.Orientation.CCW?tessellation.sweep.FillRightConcaveEdgeEvent(a,b,c.next):tessellation.Orient2d(b.q,c.next.next.point,b.p)==tessellation.Orientation.CCW&&tessellation.sweep.FillRightConvexEdgeEvent(a,b,c.next)};tessellation.sweep.FillLeftAboveEdgeEvent=function(a,b,c){for(;c.prev.point.x>
b.p.x;)tessellation.Orient2d(b.q,c.prev.point,b.p)==tessellation.Orientation.CW?tessellation.sweep.FillLeftBelowEdgeEvent(a,b,c):c=c.prev};tessellation.sweep.FillLeftBelowEdgeEvent=function(a,b,c){c.point.x>b.p.x&&(tessellation.Orient2d(c.point,c.prev.point,c.prev.prev.point)==tessellation.Orientation.CW?tessellation.sweep.FillLeftConcaveEdgeEvent(a,b,c):(tessellation.sweep.FillLeftConvexEdgeEvent(a,b,c),tessellation.sweep.FillLeftBelowEdgeEvent(a,b,c)))};tessellation.sweep.FillLeftConvexEdgeEvent=
function(a,b,c){tessellation.Orient2d(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)==tessellation.Orientation.CW?tessellation.sweep.FillLeftConcaveEdgeEvent(a,b,c.prev):tessellation.Orient2d(b.q,c.prev.prev.point,b.p)==tessellation.Orientation.CW&&tessellation.sweep.FillLeftConvexEdgeEvent(a,b,c.prev)};tessellation.sweep.FillLeftConcaveEdgeEvent=function(a,b,c){tessellation.sweep.Fill(a,c.prev);c.prev.point!=b.p&&(tessellation.Orient2d(b.q,c.prev.point,b.p)==tessellation.Orientation.CW&&
tessellation.Orient2d(c.point,c.prev.point,c.prev.prev.point)==tessellation.Orientation.CW)&&tessellation.sweep.FillLeftConcaveEdgeEvent(a,b,c)};tessellation.sweep.FlipEdgeEvent=function(a,b,c,d,f){var h=d.NeighborAcross(f);if(null==h)alert("[BUG:FIXME] FLIP failed due to missing triangle!");else{var g=h.OppositePoint(d,f);if(tessellation.InScanArea(f,d.PointCCW(f),d.PointCW(f),g))if(tessellation.sweep.RotateTrianglePair(d,f,h,g),a.MapTriangleToNodes(d),a.MapTriangleToNodes(h),f==c&&g==b)c==a.edge_event.constrained_edge.q&&
b==a.edge_event.constrained_edge.p&&(d.MarkConstrainedEdge(b,c),h.MarkConstrainedEdge(b,c),tessellation.sweep.Legalize(a,d),tessellation.sweep.Legalize(a,h));else{var j=tessellation.Orient2d(c,g,b);d=tessellation.sweep.NextFlipTriangle(a,j,d,h,f,g);tessellation.sweep.FlipEdgeEvent(a,b,c,d,f)}else g=tessellation.sweep.NextFlipPoint(b,c,h,g),tessellation.sweep.FlipScanEdgeEvent(a,b,c,d,h,g),tessellation.sweep.EdgeEvent(a,b,c,d,f)}};tessellation.sweep.NextFlipTriangle=function(a,b,c,d,f,h){if(b==tessellation.Orientation.CCW)return b=
d.EdgeIndex(f,h),d.delaunay_edge[b]=!0,tessellation.sweep.Legalize(a,d),d.ClearDelunayEdges(),c;b=c.EdgeIndex(f,h);c.delaunay_edge[b]=!0;tessellation.sweep.Legalize(a,c);c.ClearDelunayEdges();return d};tessellation.sweep.NextFlipPoint=function(a,b,c,d){a=tessellation.Orient2d(b,d,a);if(a==tessellation.Orientation.CW)return c.PointCCW(d);if(a==tessellation.Orientation.CCW)return c.PointCW(d);alert("[Unsupported] tessellation.sweep.NextFlipPoint: opposing point on constrained edge!")};tessellation.sweep.FlipScanEdgeEvent=
function(a,b,c,d,f,h){var g=f.NeighborAcross(h);null==g?alert("[BUG:FIXME] FLIP failed due to missing triangle"):(f=g.OppositePoint(f,h),tessellation.InScanArea(c,d.PointCCW(c),d.PointCW(c),f)?tessellation.sweep.FlipEdgeEvent(a,c,f,g,f):(f=tessellation.sweep.NextFlipPoint(b,c,g,f),tessellation.sweep.FlipScanEdgeEvent(a,b,c,d,g,f)))}})();(function(){function p(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a);this.trigger(k.Events.resize,b,a)}var a=this,b=a.Two||{},c=Math.sin,d=Math.cos,f=Math.atan2,h=Math.sqrt,g=Math.abs,j=Math.PI,l=2*j,m=j/2,n=Math.pow,r={hasEventListeners:_.isFunction(a.addEventListener),bind:function(a,b,c,d){this.hasEventListeners?a.addEventListener(b,c,!!d):a.attachEvent("on"+b,c);return this},unbind:function(a,b,c,d){this.hasEventListeners?
a.removeEventListeners(b,c,!!d):a.detachEvent("on"+b,c);return this}},k=a.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:k.Types.svg,autostart:!1});this.type=a.type;this.renderer=new k[this.type](this);this.playing=a.autostart;this.frameCount=0;a.fullscreen?(a=_.bind(p,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),r.bind(window,"resize",a),a()):(this.renderer.setSize(a.width,a.height),this.width=
a.width,this.height=a.height);this.scene=new k.Group;this.renderer.add(this.scene);k.Instances.push(this)};_.extend(k,{Array:a.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){a.Two=b;return this},Utils:{Curve:{CollinearityEpsilon:n(10,-30),RecursionLimit:32,
CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},decoupleShapes:function(a,b,c){c=c||0;var d=a.length;if(3>=d||c>k.Utils.Curve.RecursionLimit)return[a];for(var g=0,d=a.length;g<d;g++)if(b||!(g>=d-1))for(var f=u(g+1,d),h=a[g],j=a[f],l=0,m=u(g+1,d);l<d;l++){var n=u(m+1,d),r=a[m],s=a[n];if(!(m==g||m==f||n==g||n==f))if(r=q(h,j,r,s))return g=[r],h=[r.clone()],g=a.slice(0,f).concat(g),m=a.slice(f,m+1).concat(h),n>f?g=g.concat(a.slice(n,d)):0<n&&(m=m.concat(a.slice(n,d))),[v(g,b,c+1),v(m,b,c+
1)];m=u(m+1,d)}return[a]},solveSegmentIntersection:function(a,b,c,d){var g=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),f=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x);c=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);return 0!=c&&(g/=c,f/=c,0<=g&&1>=g&&0<=f&&1>=f)?new k.Vector(a.x+g*(b.x-a.x),a.y+g*(b.y-a.y)):null},subdivide:function(a,b,c,d,h,q,m,v,u){var n=k.Utils.Curve.CollinearityEpsilon,r=k.Utils.Curve.CuspLimit,s=k.Utils.Curve.Tolerance;u=u||0;var p=(a+c)/2,t=(b+d)/2,z=(c+h)/2,w=(d+q)/2,N=(h+m)/2,O=(q+v)/2,P=
(p+z)/2,Q=(t+w)/2,z=(z+N)/2,w=(w+O)/2,B=(P+z)/2,C=(Q+w)/2;if(0<u){var y=m-a,A=v-b,G=g((c-m)*A-(d-v)*y),H=g((h-m)*A-(q-v)*y);if(G>n&&H>n&&(G+H)*(G+H)<=s.distance*(y*y+A*A)){if(s.angle<s.epsilon)return[new k.Vector(B,C)];y=f(q-d,h-c);n=g(y-f(d-b,c-a));y=g(f(v-q,m-h)-y);n>=j&&(n=l-n);y>=j&&(y=l-y);if(n+y<s.angle)return[new k.Vector(B,C)];if(0!==r){if(n>r)return[new k.Vector(c,d)];if(y>r)return[new k.Vector(h,q)]}}}else if(G>n)if(G*G<=s.distance*(y*y+A*A)){if(s.angle<s.epsilon)return[new k.Vector(B,C)];
n=g(f(q-d,h-c)-f(d-b,c-a));n>=j&&(n=l-n);if(n<s.angle)return[new k.Vector(c,d),new k.Vector(h,q)];if(0!==r&&n>r)return[new k.Vector(c,d)]}else if(H>n){if(H*H<=s.distance*(y*y+A*A)){if(s.angle<s.epsilon)return[new k.Vector(B,C)];n=g(f(v-q,m-h)-f(q-d,h-c));n>=j&&(n=l-n);if(n<s.angle)return[new k.Vector(c,d),new k.Vector(h,q)];if(0!==r&&n>r)return[new k.Vector2(h,q)]}}else if(y=B-(a+m)/2,A=C-(b+v)/2,y*y+A*A<=s.distance)return[new k.Vector(B,C)];return k.Utils.subdivide(a,b,p,t,P,Q,B,C,u+1).concat(k.Utils.subdivide(B,
C,z,w,N,O,m,v,u+1))},getCurveFromPoints:function(a,b){for(var c=[],d=a.length,g=d-1,f=0;f<d;f++){var h=a[f],q={x:h.x,y:h.y};c.push(q);var h=b?u(f-1,d):Math.max(f-1,0),j=b?u(f+1,d):Math.min(f+1,g);t(a[h],q,a[j]);!q.u.x&&!q.u.y&&(q.u.x=q.x,q.u.y=q.y);!q.v.x&&!q.v.y&&(q.v.x=q.x,q.v.y=q.y)}return c},getControlPoints:function(a,b,g){var f=w(a,b),h=w(g,b);a=s(a,b);g=s(g,b);var q=(f+h)/2;if(1E-4>a||1E-4>g)return b.u={x:b.x,y:b.y},b.v={x:b.x,y:b.y},b;a*=0.33;g*=0.33;q=h<f?q+m:q-m;f={x:b.x+d(q)*a,y:b.y+c(q)*
a};q-=j;h={x:b.x+d(q)*g,y:b.y+c(q)*g};b.u=f;b.v=h;return b},angleBetween:function(a,b){return f(a.y-b.y,a.x-b.x)},distanceBetweenSquared:function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},distanceBetween:function(a,b){return h(z(a,b))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Error:function(a){this.name="two.js";this.message=a}}});k.Utils.Error.prototype=Error();k.Utils.Error.prototype.constructor=k.Utils.Error;var s=k.Utils.distanceBetween,z=k.Utils.distanceBetweenSquared,w=k.Utils.angleBetween,
t=k.Utils.getControlPoints,q=k.Utils.solveSegmentIntersection,v=k.Utils.decoupleShapes,u=k.Utils.mod;_.extend(k.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);return this},play:function(){this.playing=!0;return this.trigger(k.Events.play)},pause:function(){this.playing=!1;return this.trigger(k.Events.pause)},update:function(){this.frameCount++;var a=this.width,b=this.height,c=this.renderer;(a!==c.width||b!==c.height)&&c.setSize(a,b);return this.trigger(k.Events.update,
this.frameCount)},render:function(){this.renderer.render();return this.trigger(k.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);return this},makeLine:function(a,b,c,d){c=(c-a)/2;d=(d-b)/2;var g=[new k.Vector(-c,-d),new k.Vector(c,d)],g=(new k.Polygon(g)).noFill();g.translation.set(a+c,b+d);this.scene.add(g);return g},makeRectangle:function(a,b,c,d){c/=2;d/=2;d=[new k.Vector(c,d),new k.Vector(-c,d),new k.Vector(-c,-d),new k.Vector(c,
-d)];d=new k.Polygon(d,!0);d.translation.set(a,b);this.scene.add(d);return d},makeCircle:function(a,b,c){return this.makeEllipse(a,b,c,c)},makeEllipse:function(a,b,g,f){var q=k.Resolution,h=_.map(_.range(q),function(a){var b=a/q*l;a=g*d(b);b=f*c(b);return new k.Vector(a,b)},this),h=new k.Polygon(h,!0,!0);h.translation.set(a,b);this.scene.add(h);return h},makeCurve:function(a){var b=arguments.length,c=a;if(!_.isArray(a))for(var c=[],d=0;d<b;d+=2){var g=arguments[d];if(!_.isNumber(g))break;c.push(new k.Vector(g,
arguments[d+1]))}var b=arguments[b-1],c=new k.Polygon(c,!(_.isBoolean(b)&&b),!0),b=c.getBoundingClientRect(),q=b.left+b.width/2,f=b.top+b.height/2;_.each(c.vertices,function(a){a.x-=q;a.y-=f});c.translation.set(q,f);this.scene.add(c);return c},makePolygon:function(a){var b=arguments.length,c=a;if(!_.isArray(a))for(var c=[],d=0;d<b;d+=2){var g=arguments[d];if(!_.isNumber(g))break;c.push(new k.Vector(g,arguments[d+1]))}var b=arguments[b-1],c=new k.Polygon(c,!(_.isBoolean(b)&&b)),b=c.getBoundingClientRect(),
q=b.left+b.width/2,f=b.top+b.height/2;_.each(c.vertices,function(a){a.x-=q;a.y-=f});c.translation.set(q,f);this.scene.add(c);return c},makeGroup:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));var c=new k.Group;this.scene.add(c);c.add(b);return c}});(function(){_.each(k.Instances,function(a){a.playing&&a.update().render()});requestAnimationFrame(arguments.callee)})()})();(function(){var p=Two.Vector=function(a,b){a=a||0;b=b||0;Object.defineProperty(this,"x",{get:function(){return a},set:function(b){a=b;this.trigger("change","x")}});Object.defineProperty(this,"y",{get:function(){return b},set:function(a){b=a;this.trigger("change","y")}})};_.extend(p,{});_.extend(p.prototype,Backbone.Events,{set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new p(this.x,
this.y)},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*
a.x+this.y*a.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){return this.normalize().multiplyScalar(a)},equals:function(a){return 1E-4>this.distanceTo(a)},lerp:function(a,b){return this.set((a.x-this.x)*
b+this.x,(a.y-this.y)*b+this.y)},isZero:function(){return 1E-4>this.length()}})})();(function(){_.range(6);var p=Math.cos,a=Math.sin,b=Math.tan,c=Two.Matrix=function(a,b,c,g,j,l){this.elements=new Two.Array(9);var m=a;_.isArray(m)||(m=_.toArray(arguments));this.identity().set(m)};_.extend(c,{Identity:[1,0,0,0,1,0,0,0,1],Determinant:function(a,b,c,g,j,l,m,n,r){return a*j*r-a*l*n-b*g*r+b*l*m+c*g*n-c*j*m},Multiply:function(a,b){if(3>=b.length){var c=b[0]||0,g=b[1]||0,j=b[2]||0;return{x:a[0]*c+a[1]*g+a[2]*j,y:a[3]*c+a[4]*g+a[5]*j,z:a[6]*c+a[7]*g+a[8]*j}}var c=a[0],g=a[1],j=a[2],l=a[3],
m=a[4],n=a[5],r=a[6],k=a[7],s=a[8],p=b[0],w=b[1],t=b[2],q=b[3],v=b[4],u=b[5],e=b[6],x=b[7],F=b[8];return[c*p+g*q+j*e,c*w+g*v+j*x,c*t+g*u+j*F,l*p+m*q+n*e,l*w+m*v+n*x,l*t+m*u+n*F,r*p+k*q+s*e,r*w+k*v+s*x,r*t+k*u+s*F]}});_.extend(c.prototype,{set:function(a,b,c,g,j,l){var m=a;_.isArray(m)||(m=_.toArray(arguments));_.each(m,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this},identity:function(){this.set(c.Identity);return this},multiply:function(a,b,c,g,j,l,m,n,r){var k=arguments,s=k.length;
if(1>=s)return _.each(this.elements,function(b,c){this.elements[c]=b*a},this),this;if(3>=s)return a=a||0,b=b||0,c=c||0,j=this.elements,{x:j[0]*a+j[1]*b+j[2]*c,y:j[3]*a+j[4]*b+j[5]*c,z:j[6]*a+j[7]*b+j[8]*c};s=this.elements;A0=s[0];A1=s[1];A2=s[2];A3=s[3];A4=s[4];A5=s[5];A6=s[6];A7=s[7];A8=s[8];B0=k[0];B1=k[1];B2=k[2];B3=k[3];B4=k[4];B5=k[5];B6=k[6];B7=k[7];B8=k[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*
B6;this.elements[4]=A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],g=a[2],j=a[3],l=a[4],m=a[5],n=a[6],r=a[7],a=a[8];return b*l*a-b*m*r-c*j*a+c*m*n+g*j*r-g*l*n},scale:function(a,b){1>=arguments.length&&(b=a);return this.multiply(a,0,0,0,b,0,0,0,1)},rotate:function(b){var c=p(b);b=a(b);return this.multiply(c,-b,0,b,c,0,0,
0,1)},translate:function(a,b){return this.multiply(1,0,a,0,1,b,0,0,1)},skewX:function(a){a=b(a);return this.multiply(1,a,0,0,1,0,0,0,1)},skewY:function(a){a=b(a);return this.multiply(1,0,0,a,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},toArray:function(a){var b=this.elements,c=parseFloat(b[0].toFixed(3)),g=parseFloat(b[1].toFixed(3)),j=parseFloat(b[2].toFixed(3)),l=parseFloat(b[3].toFixed(3)),m=parseFloat(b[4].toFixed(3)),n=parseFloat(b[5].toFixed(3));if(a){a=parseFloat(b[6].toFixed(3));
var r=parseFloat(b[7].toFixed(3)),b=parseFloat(b[8].toFixed(3));return[c,l,a,g,m,r,j,n,b]}return[c,l,g,m,j,n]},clone:function(){return new Two.Matrix(this.elements[0],this.elements[1],this.elements[2],this.elements[3],this.elements[4],this.elements[5])}})})();(function(){function p(a){var b={},c=a.id,l=a.translation,m=a.rotation,n=a.scale,r=a.stroke,k=a.linewidth,s=a.fill,p=a.opacity,w=a.visible,t=a.cap,q=a.join,v=a.miter,u=a.curved,e=a.closed;a=a.vertices;c&&(b.id=f.Identifier+c);l&&(_.isNumber(n)&&_.isNumber(m))&&(b.transform="translate("+l.x+","+l.y+") scale("+n+") rotate("+m+")");r&&(b.stroke=r);s&&(b.fill=s);p&&(b["stroke-opacity"]=b["fill-opacity"]=p);b.visibility=w?"visible":"hidden";t&&(b["stroke-linecap"]=t);q&&(b["stroke-linejoin"]=q);v&&(b["stroke-miterlimit"]=
v);k&&(b["stroke-width"]=k);a&&(b.d=d.toString(a,e,u));return b}var a=0,b=Two.Utils.getCurveFromPoints,c=Two.Utils.mod,d={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(a,b){var c=a.toLowerCase(),d=document.createElementNS(this.ns,c);"svg"===c&&(b=_.defaults(b||{},{version:this.version}));_.isObject(b)&&this.setAttributes(d,b);return d},setAttributes:function(a,b){_.each(b,function(a,b){this.setAttribute(b,a)},a);return this},removeAttributes:function(a,
b){_.each(b,function(a){this.removeAttribute(a)},a);return this},toString:function(a,d,f){var l=a.length,m=l-1;if(!f)return _.map(a,function(a,b){var c;c=(0>=b?"M":"L")+(" "+a.x.toFixed(3)+" "+a.y.toFixed(3));b>=m&&d&&(c+=" Z");return c}).join(" ");var n=b(a,d);return _.map(n,function(a,b){var f,h=d?c(b-1,l):Math.max(b-1,0),j=d?c(b+1,l):Math.min(b+1,m);f=n[h];var j=n[j],h=f.v.x.toFixed(3),p=f.v.y.toFixed(3),q=a.u.x.toFixed(3),v=a.u.y.toFixed(3),u=a.x.toFixed(3),e=a.y.toFixed(3);f=0>=b?"M "+u+" "+
e:"C "+h+" "+p+" "+q+" "+v+" "+u+" "+e;b>=m&&d&&(h=a.v.x.toFixed(3),p=a.v.y.toFixed(3),q=j.u.x.toFixed(3),v=j.u.y.toFixed(3),u=j.x.toFixed(3),e=j.y.toFixed(3),f=f+(" C "+h+" "+p+" "+q+" "+v+" "+u+" "+e)+" Z");return f}).join(" ")}},f=Two[Two.Types.svg]=function(){this.domElement=d.createElement("svg");this.elements=[];this.commands=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(f,{Identifier:"two-"});_.extend(f.prototype,
Backbone.Events,{setSize:function(a,b){this.width=a;this.height=b;d.setAttributes(this.domElement,{width:a,height:b});return this},add:function(b){var c=b,f=this.elements,l=this.domElement;_.isArray(b)||(c=_.map(arguments,function(a){return a}));_.each(c,function(b){var c;c=b instanceof Two.Group;if(_.isUndefined(b.id)){var g=a;a++;b.id=g}c?(c="g",_.isUndefined(b.parent)&&(b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),b=p(b),delete b.stroke,delete b.fill,
delete b["fill-opacity"],delete b["stroke-opacity"],delete b["stroke-linecap"],delete b["stroke-linejoin"],delete b["stroke-miterlimit"],delete b["stroke-width"]):(c="path",b=p(b));b=d.createElement(c,b);l.appendChild(b);f.push(b)},this);return this},update:function(a,b,c){this.commands.push(arguments);return this},render:function(){this.unveil();var a=this.elements;_.each(this.commands,function(b){var c=b[1],f=b[2],m=b[3],n=b[4],r=a[b[0]];switch(c){case Two.Properties.hierarchy:_.each(f,function(b){r.appendChild(a[b])});
break;case Two.Properties.demotion:_.each(f,function(b){r.removeChild(a[b])});break;default:a:{b=c;switch(b){case "matrix":b="transform";f="matrix("+f.toString()+")";break;case "visible":b="visibility";f=f?"visible":"hidden";break;case "cap":b="stroke-linecap";break;case "join":b="stroke-linejoin";break;case "miter":b="stroke-miterlimit";break;case "linewidth":b="stroke-width";break;case "vertices":b="d";f=d.toString(f,m,n);break;case "opacity":d.setAttributes(r,{"stroke-opacity":opacity,"fill-opacity":opacity});
break a}r.setAttribute(b,f)}}},this);this.commands.length=0;return this}})})();(function(){var p=0,a=Two.Utils.getCurveFromPoints,b=Two.Utils.mod,c=function(a){_.each(a,function(a,b){this[b]=a},this);this.children={}};_.extend(c.prototype,{appendChild:function(a){var b=a.parent,c=a.id;_.isUndefined(b)||delete b.children[c];this.children[c]=a;a.parent=this;return this},removeChild:function(a){delete this.children[a.id];return this},render:function(a){var b=this.matrix;a.save();a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);_.each(this.children,function(b){b.render(a)});a.restore();
return this}});var d=function(a){_.each(a,function(a,b){this[b]=a},this)};_.extend(d.prototype,{render:function(a){var c=this.matrix,d=this.stroke,f=this.linewidth,h=this.fill,r=this.opacity,k=this.cap,s=this.join,p=this.miter,w=this.curved,t=this.closed,q=this.commands,v=q.length,u=v-1;if(!this.visible)return this;a.save();c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);h&&(a.fillStyle=h);d&&(a.strokeStyle=d);f&&(a.lineWidth=f);p&&(a.miterLimit=p);s&&(a.lineJoin=s);k&&(a.lineCap=k);_.isNumber(r)&&
(a.globalAlpha=r);a.beginPath();_.each(q,function(c,d){var f=c.x.toFixed(3),h=c.y.toFixed(3);if(w){var j=t?b(d-1,v):Math.max(d-1,0),k=t?b(d+1,v):Math.min(d+1,u),l=q[j],k=q[k],j=l.v.x.toFixed(3),l=l.v.y.toFixed(3),m=c.u.x.toFixed(3),n=c.u.y.toFixed(3);0>=d?a.moveTo(f,h):(a.bezierCurveTo(j,l,m,n,f,h),d>=u&&t&&(j=c.v.x.toFixed(3),l=c.v.y.toFixed(3),m=k.u.x.toFixed(3),n=k.u.y.toFixed(3),f=k.x.toFixed(3),h=k.y.toFixed(3),a.bezierCurveTo(j,l,m,n,f,h)))}else 0>=d?a.moveTo(f,h):a.lineTo(f,h)});t&&!w&&a.closePath();
a.fill();a.stroke();a.restore()}});var f={toArray:function(b,c,d){return!c?_.map(b,function(a){return{x:a.x,y:a.y}}):a(b,d)}},h=Two[Two.Types.canvas]=function(){this.domElement=document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.elements=[];this.stage=null};_.extend(h,{});_.extend(h,{Group:c,Element:d,getStyles:function(a){var b={},c=a.id,d=a._matrix,h=a.stroke,r=a.linewidth,k=a.fill,s=a.opacity,p=a.visible,w=a.cap,t=a.join,q=a.miter,v=a.curved,u=a.closed;a=a.vertices;
c&&(b.id=c);_.isObject(d)&&(b.matrix=d.toArray());h&&(b.stroke=h);k&&(b.fill=k);_.isNumber(s)&&(b.opacity=s);w&&(b.cap=w);t&&(b.join=t);q&&(b.miter=q);r&&(b.linewidth=r);a&&(b.commands=f.toArray(a,v,u));b.visible=!!p;b.curved=!!v;b.closed=!!u;return b},setStyles:function(a,b,c,d,h){switch(b){case "matrix":b="matrix";c=c.toArray();break;case "vertices":b="commands",a.curved=h,a.closed=d,c=f.toArray(c,a.curved,a.closed)}a[b]=c}});_.extend(h.prototype,Backbone.Events,{setSize:function(a,b){this.width=
this.domElement.width=a;this.height=this.domElement.height=b;_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});return this},add:function(a){constructor=Object.getPrototypeOf(this).constructor;var b=a,c=this.elements,d=constructor.Group,f=constructor.Element,h=constructor.getStyles;_.isArray(a)||(b=_.map(arguments,function(a){return a}));_.each(b,function(a){var b;b=a instanceof Two.Group;var g=_.isNull(this.stage);if(_.isUndefined(a.id)){var j=p;p++;a.id=j}b?(b=h.call(this,
a),delete b.stroke,delete b.fill,delete b.opacity,delete b.cap,delete b.join,delete b.miter,delete b.linewidth,b=new d(b),g&&(this.stage=b,this.stage.object=a,a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):b=new f(h.call(this,a));c.push(b);g||this.stage.appendChild(b)},this);return this},update:function(a,b,c,d,f){var h=Object.getPrototypeOf(this).constructor,k=this.elements,p=k[a];switch(b){case Two.Properties.hierarchy:_.each(c,function(a){p.appendChild(k[a])});
break;case Two.Properties.demotion:_.each(c,function(a){p.removeChild(k[a]);this.elements[a]=null},this);default:h.setStyles.call(this,p,b,c,d,f)}return this},render:function(){if(_.isNull(this.stage))return this;this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);return this}})})();(function(){function p(a){var b=[];_.each(a,function(a){_.isArray(a)&&_.isArray(a[0])?b=b.concat(p(a)):b.push(a)});return b}function a(a){a=d([a[0],a[1],a[2],a[3],a[4],a[5],0,0,1],[1,0,1]);return g(a.x*a.x+a.y*a.y)}var b=Two[Two.Types.canvas],c=Two.Utils.getCurveFromPoints,d=Two.Matrix.Multiply,f=Two.Utils.decoupleShapes,h=Two.Utils.subdivide,g=Math.sqrt,j={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",
blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",
darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",
indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",
limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370D8",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",
orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#D87093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",
springgreen:"#00FF7F",transparent:"#000",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:'#9ACD32"'},l="(?:\\+|-)?\\d+",m="(?:\\+|-)?\\d*\\.\\d+",n="(?:"+l+")|(?:"+m+")",l="("+l+")",m="("+m+")",n="("+n+")",m=n+"%",r=RegExp(["^hsl(a?)\\(",n,",",m,",",m,"(,",n,")?\\)$"].join("\\s*?")),k=RegExp(["^rgb(a?)\\(",l,",",l,",",l,"(,",n,")?\\)$"].join("\\s*?")),
s=RegExp(["^rgb(a?)\\(",m,",",m,",",m,"(,",n,")?\\)$"].join("\\s*?")),z=/^,\s*/,w=[function(a){function b(c,d){var f=a.match(c);if(f&&1!==!!f[1]+!!f[5]){var g=_.isUndefined(f[5])?1:f[5].replace(z,"");return{r:Math.min(1,Math.max(0,f[2]/d)),g:Math.min(1,Math.max(0,f[3]/d)),b:Math.min(1,Math.max(0,f[4]/d)),a:Math.min(1,Math.max(g,0))}}}a=a.replace(/^\s+|\s+$/g,"");var c=b(k,255);return c?c:b(s,100)},function(a){var b=a.toLowerCase();b in j&&(a=j[b]);if(a.match(/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/)){a=
a.replace(/^#/,"");var b=a.length/3,c=Math.pow(16,b)-1;return{r:parseInt(a.slice(0,b),16)/c,g:parseInt(a.slice(1*b,2*b),16)/c,b:parseInt(a.slice(2*b),16)/c,a:1}}},function(a){var b=a.replace(/^\s+|\s+$/g,"").match(r);if(!b||1===!!b[1]+!!b[5])return null;a=(b[2]%360+360)%360/360;var c=Math.max(0,Math.min(parseInt(b[3],10)/100,1)),d=Math.max(0,Math.min(parseInt(b[4],10)/100,1)),b=b[5];if(0!=c)var f=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},g=
0.5>d?d*(1+c):d+c-d*c,h=2*d-g;c=_.isUndefined(b)||_.isNull(b)?1:b.replace(z,"");return{r:f(h,g,a+1/3),g:f(h,g,a),b:f(h,g,a-1/3),a:c}}],l=function(a){b.Group.call(this,a)};_.extend(l.prototype,b.Group.prototype,{appendChild:function(){b.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},updateMatrix:function(a){a=a||this.parent&&this.parent.matrix;if(!a)return this;this._matrix=d(this.matrix,a);_.each(this.children,function(a){a.updateMatrix(this._matrix)},this);return this},
render:function(a,b,c,d){_.each(this.children,function(f){f.render(a,b,c,d)})}});n=function(a){b.Element.call(this,a)};_.extend(n.prototype,b.Element.prototype,{updateMatrix:function(b){b=b||this.parent&&this.parent.matrix;if(!b)return this;this._matrix=d(this.matrix,b);this._linewidth=this.linewidth*a(this._matrix);return this},render:function(a,b,c,d){if(!this.visible||!this.fillBuffer||!this.strokeBuffer)return this;0<this.fill.a&&(a.bindBuffer(a.ARRAY_BUFFER,this.fillBuffer),a.vertexAttribPointer(b,
2,a.FLOAT,!1,0,0),a.uniformMatrix3fv(c,!1,this._matrix),a.uniform4f(d,this.fill.r,this.fill.g,this.fill.b,this.fill.a),a.drawArrays(a.TRIANGLES,0,this.triangleAmount));if(0>=this._linewidth||0>=this.stroke.a)return this;a.bindBuffer(a.ARRAY_BUFFER,this.strokeBuffer);a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0);a.uniformMatrix3fv(c,!1,this._matrix);a.uniform4f(d,this.stroke.r,this.stroke.g,this.stroke.b,this.stroke.a);a.lineWidth(this._linewidth);a.drawArrays(a.LINES,0,this.vertexAmount);return this}});
var t={updateBuffer:function(a,b,c){_.isObject(b.fillBuffer)&&a.deleteBuffer(b.fillBuffer);b.fillBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.fillBuffer);a.enableVertexAttribArray(c);a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.strokeBuffer)&&a.deleteBuffer(b.strokeBuffer);b.strokeBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.strokeBuffer);a.enableVertexAttribArray(c);a.bufferData(a.ARRAY_BUFFER,b.vertices,a.STATIC_DRAW)},interpret:function(a){for(var b=0,c=
w.length;b<c;b++){var d=w[b](a);if(d)return d}return{r:0,g:0,b:0,a:0}},toArray:function(a,b,d){if(!d)return a.slice(0);var e=c(a,b),f=e.length,g=f-1,j=[];_.each(e,function(a,c){if(b||!b&&c<g){var d=e[(c+1)%f],d=h(a.x,a.y,a.v.x,a.v.y,d.u.x,d.u.y,d.x,d.y);j=j.concat(d)}});return j},tessellate:function(a,b,c,d,g){a=p(f(a,b));var h=[],j=[],k=0,l=0;_.each(a,function(a){a=new tessellation.SweepContext(a);tessellation.sweep.Triangulate(a,!0);k+=6*a.triangles.length;_.each(a.triangles,function(a){var b=a.points;
a=b[0];var c=b[1],b=b[2];h.push(a.x,a.y,c.x,c.y,b.x,b.y)});l+=4*a.edges.length;_.each(a.edges,function(a){var b=a.p;a=a.q;j.push(b.x,b.y,a.x,a.y)})});d=d&&k<=d.length?d:new Two.Array(k);g=g&&l<=g.length?g:new Two.Array(l);d.set(h);g.set(j);return{triangles:d,vertices:g,triangleAmount:k/2,vertexAmount:l/2}},program:{create:function(a,b){var c=a.createProgram();_.each(b,function(b){a.attachShader(c,b)});a.linkProgram(c);if(!a.getProgramParameter(c,a.LINK_STATUS))throw error=a.getProgramInfoLog(c),new Two.Utils.Error("unable to link program: "+
error);return c}},shaders:{create:function(a,b,c){c=a.createShader(a[c]);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS))throw a=a.getShaderInfoLog(c),new Two.Utils.Error("unable to compile shader "+c+": "+a);return c},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 position;\nuniform mat3 matrix;\nuniform vec2 resolution;\n\nvoid main() {\n   vec2 projected = (matrix * vec3(position, 1)).xy;\n   vec2 normal = projected / resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n}",
fragment:"precision mediump float;\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}"}},m=Two[Two.Types.webgl]=function(a){this.domElement=document.createElement("canvas");this.elements=[];this.stage=null;a=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1});this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");
a=t.shaders.create(this.ctx,t.shaders.vertex,t.shaders.types.vertex);var b=t.shaders.create(this.ctx,t.shaders.fragment,t.shaders.types.fragment);this.program=t.program.create(this.ctx,[a,b]);this.ctx.useProgram(this.program);this.positionLocation=this.ctx.getAttribLocation(this.program,"position");this.colorLocation=this.ctx.getUniformLocation(this.program,"color");this.matrixLocation=this.ctx.getUniformLocation(this.program,"matrix");this.ctx.disable(this.ctx.DEPTH_TEST);this.ctx.enable(this.ctx.BLEND);
this.ctx.blendEquationSeparate(this.ctx.FUNC_ADD,this.ctx.FUNC_ADD);this.ctx.blendFuncSeparate(this.ctx.SRC_ALPHA,this.ctx.ONE_MINUS_SRC_ALPHA,this.ctx.ONE,this.ctx.ONE_MINUS_SRC_ALPHA)};_.extend(m,{Group:l,Element:n,getStyles:function(b){var c={},d=b.id,e=b._matrix,f=b.stroke,g=b.linewidth,h=b.fill,j=b.opacity,k=b.visible,l=b.cap,m=b.join,n=b.miter,p=b.curved,r=b.closed;b=b.vertices;d&&(c.id=d);_.isObject(e)&&(c.matrix=c._matrix=e.toArray(!0));f&&(c.stroke=t.interpret(f));h&&(c.fill=t.interpret(h));
_.isNumber(j)&&(c.opacity=j);l&&(c.cap=l);m&&(c.join=m);n&&(c.miter=n);g&&(c.linewidth=g,c._linewidth=g*a(c._matrix));b&&(b=t.toArray(b,r,p),d=t.tessellate(b,r,p),c.triangles=d.triangles,c.vertices=d.vertices,c.vertexAmount=d.vertexAmount,c.triangleAmount=d.triangleAmount);c.visible=!!k;c.curved=!!p;c.closed=!!r;return c},setStyles:function(b,c,d,e,f){switch(c){case "matrix":c="matrix";d=d.toArray(!0);break;case "linewidth":c="linewidth";b._linewidth=d*a(b._matrix);break;case "stroke":d=t.interpret(d);
break;case "fill":d=t.interpret(d);break;case "vertices":c="triangles",b.closed=e,b.curved=f,d=t.toArray(d,e,f),e=t.tessellate(d,e,f,b.triangles,b.vertices),d=e.triangles,b.vertices=e.vertices,b.vertexAmount=e.vertexAmount,b.triangleAmount=e.triangleAmount}b[c]=d;"triangles"===c&&t.updateBuffer(this.ctx,b,this.positionLocation);"matrix"===c&&b.updateMatrix()}});_.extend(m.prototype,Backbone.Events,b.prototype,{setSize:function(a,c){b.prototype.setSize.apply(this,arguments);this.ctx.viewport(0,0,a,
c);var d=this.ctx.getUniformLocation(this.program,"resolution");this.ctx.uniform2f(d,a,c);return this},render:function(){if(_.isNull(this.stage))return this;this.stage.render(this.ctx,this.positionLocation,this.matrixLocation,this.colorLocation);return this}})})();(function(){var p=Two.Shape=function(a){this._matrix=new Two.Matrix;var b=_.debounce(_.bind(function(){var a=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",a)},this),0);this._rotation="rotation";Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a;b()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(a){this._scale=a;b()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,b);if(a)return this;p.MakeGetterSetter(this,p.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.miter=this.join=this.cap="round"};_.extend(p,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(a,b){_.isArray(b)||(b=[b]);_.each(b,function(b){var d="_"+b;Object.defineProperty(a,
b,{get:function(){return this[d]},set:function(a){this[d]=a;this.trigger(Two.Events.change,this.id,b,a,this)}})})}});_.extend(p.prototype,Backbone.Events,{addTo:function(a){a.add(this);return this},noFill:function(){this.fill="none";return this},noStroke:function(){this.stroke="none";return this},clone:function(){var a=new p;a.translation.copy(this.translation);_.each(p.Properties,function(b){a[b]=this[b]},this);return this}})})();(function(){var p=Two.Group=function(){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;p.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(p,{MakeGetterSetter:function(a,b){_.isArray(b)||(b=[b]);_.each(b,function(b){var d="_"+b;Object.defineProperty(a,b,{get:function(){return this[d]},set:function(a){this[d]=a;_.each(this.children,function(d){d[b]=a})}})})}});_.extend(p.prototype,
Two.Shape.prototype,{add:function(a){var b=a,c=this.children,d=this.parent,f=[];_.isArray(a)||(b=_.toArray(arguments));var h=_.bind(function(a,b,c,d,f){this.trigger(Two.Events.change,a,b,c,d,f)},this);_.each(b,function(a){var b=a.id,l=a.parent;_.isUndefined(b)&&(d.add(a),b=a.id);_.isUndefined(c[b])&&(l&&delete l.children[b],c[b]=a,a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,h),f.push(b))},this);0<f.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,f);return this.center()},
center:function(){var a=this.getBoundingClientRect();a.centroid={x:a.left+a.width/2,y:a.top+a.height/2};_.each(this.children,function(b){b.translation.subSelf(a.centroid)});this.translation.copy(a.centroid);return this},remove:function(a){var b=a,c=this.children,d=this.parent,f=[];if(0>=arguments.length&&d)return d.remove(this),this;_.isArray(a)||(b=_.toArray(arguments));_.each(b,function(a){var b=a.id;b in c&&(delete c[b],a.unbind(Two.Events.change),f.push(b))});0<f.length&&this.trigger(Two.Events.change,
this.id,Two.Properties.demotion,f);return this.center()},getBoundingClientRect:function(){var a=Infinity,b=-Infinity,c=Infinity,d=-Infinity;_.each(this.children,function(f){f=f.getBoundingClientRect();c=Math.min(f.top,c);a=Math.min(f.left,a);b=Math.max(f.right,b);d=Math.max(f.bottom,d)},this);var f=this._matrix.multiply(a,c,1),h=this._matrix.multiply(b,d,1);return{top:f.y,left:f.x,right:h.x,bottom:h.y,width:h.x-f.x,height:h.y-f.y}},noFill:function(){_.each(this.children,function(a){a.noFill()});return this},
noStroke:function(){_.each(this.children,function(a){a.noStroke()});return this}})})();(function(){var p=Math.min,a=Math.max,b=Math.round,c=Two.Polygon=function(c,f,h){Two.Shape.call(this);f=!!f;h=!!h;var g=0,j=1,l=!1,m=c.slice(0),n=_.debounce(_.bind(function(){var a,c;if(l){a=this.vertices.length;a-=1;c=b(g*a);a=b(j*a);for(m.length=0;c<a+1;c++){var d=this.vertices[c];m.push(new Two.Vector(d.x,d.y))}l=!1}this.trigger(Two.Events.change,this.id,"vertices",m,f,h)},this),0);Object.defineProperty(this,"closed",{get:function(){return f},set:function(a){f=!!a;n()}});Object.defineProperty(this,
"curved",{get:function(){return h},set:function(a){h=!!a;n()}});Object.defineProperty(this,"beginning",{get:function(){return g},set:function(b){g=p(a(b,0),1);l=!0;n()}});Object.defineProperty(this,"ending",{get:function(){return j},set:function(b){j=p(a(b,0),1);l=!0;n()}});this.vertices=c.slice(0);_.each(this.vertices,function(a){a.bind(Two.Events.change,n)},this);n()};_.extend(c,{});_.extend(c.prototype,Two.Shape.prototype,{clone:function(){var a=_.map(this.vertices,function(a){return new Two.Vector(a.x,
a.y)}),b=new c(a,this.closed,this.curved);_.each(Two.Shape.Properties,function(a){b[a]=this[a]},this);b.translation.copy(this.translation);b.rotation=this.rotation;b.scale=this.scale;return b},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(){var a=this.linewidth,b=Infinity,c=-Infinity,g=Infinity,j=-Infinity;_.each(this.vertices,function(a){var d=a.x;a=a.y;g=Math.min(a,g);b=Math.min(d,b);c=Math.max(d,c);j=Math.max(a,j)});var g=g-a,
b=b-a,c=c+a,j=j+a,a=this._matrix.multiply(b,g,1),l=this._matrix.multiply(c,j,1);return{top:a.y,left:a.x,right:l.x,bottom:l.y,width:l.x-a.x,height:l.y-a.y}}})})();
