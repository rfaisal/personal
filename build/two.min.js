(function(){function n(p,s,b){if(p===s)return 0!==p||1/p==1/s;if(null==p||null==s)return p===s;p._chain&&(p=p._wrapped);s._chain&&(s=s._wrapped);if(p.isEqual&&c.isFunction(p.isEqual))return p.isEqual(s);if(s.isEqual&&c.isFunction(s.isEqual))return s.isEqual(p);var e=a.call(p);if(e!=a.call(s))return!1;switch(e){case "[object String]":return p==String(s);case "[object Number]":return p!=+p?s!=+s:0==p?1/p==1/s:p==+s;case "[object Date]":case "[object Boolean]":return+p==+s;case "[object RegExp]":return p.source==
s.source&&p.global==s.global&&p.multiline==s.multiline&&p.ignoreCase==s.ignoreCase}if("object"!=typeof p||"object"!=typeof s)return!1;for(var d=b.length;d--;)if(b[d]==p)return!0;b.push(p);var d=0,f=!0;if("[object Array]"==e){if(d=p.length,f=d==s.length)for(;d--&&(f=d in p==d in s&&n(p[d],s[d],b)););}else{if("constructor"in p!="constructor"in s||p.constructor!=s.constructor)return!1;for(var m in p)if(c.has(p,m)&&(d++,!(f=c.has(s,m)&&n(p[m],s[m],b))))break;if(f){for(m in s)if(c.has(s,m)&&!d--)break;
f=!d}}b.pop();return f}var h=this,j=h._,l={},g=Array.prototype,f=Object.prototype,d=g.slice,b=g.unshift,a=f.toString,e=f.hasOwnProperty,m=g.forEach,A=g.map,x=g.reduce,k=g.reduceRight,q=g.filter,H=g.every,z=g.some,u=g.indexOf,r=g.lastIndexOf,f=Array.isArray,t=Object.keys,v=Function.prototype.bind,c=function(a){return new I(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=c),exports._=c):h._=c;c.VERSION="1.3.3";var w=c.each=c.forEach=function(a,
b,e){if(null!=a)if(m&&a.forEach===m)a.forEach(b,e);else if(a.length===+a.length)for(var d=0,f=a.length;d<f&&!(d in a&&b.call(e,a[d],d,a)===l);d++);else for(d in a)if(c.has(a,d)&&b.call(e,a[d],d,a)===l)break};c.map=c.collect=function(a,c,b){var e=[];if(null==a)return e;if(A&&a.map===A)return a.map(c,b);w(a,function(a,p,d){e[e.length]=c.call(b,a,p,d)});a.length===+a.length&&(e.length=a.length);return e};c.reduce=c.foldl=c.inject=function(a,b,e,d){var f=2<arguments.length;null==a&&(a=[]);if(x&&a.reduce===
x)return d&&(b=c.bind(b,d)),f?a.reduce(b,e):a.reduce(b);w(a,function(a,p,c){f?e=b.call(d,e,a,p,c):(e=a,f=!0)});if(!f)throw new TypeError("Reduce of empty array with no initial value");return e};c.reduceRight=c.foldr=function(a,b,e,d){var f=2<arguments.length;null==a&&(a=[]);if(k&&a.reduceRight===k)return d&&(b=c.bind(b,d)),f?a.reduceRight(b,e):a.reduceRight(b);var m=c.toArray(a).reverse();d&&!f&&(b=c.bind(b,d));return f?c.reduce(m,b,e,d):c.reduce(m,b)};c.find=c.detect=function(a,c,b){var e;C(a,function(a,
p,d){if(c.call(b,a,p,d))return e=a,!0});return e};c.filter=c.select=function(a,c,b){var e=[];if(null==a)return e;if(q&&a.filter===q)return a.filter(c,b);w(a,function(a,p,d){c.call(b,a,p,d)&&(e[e.length]=a)});return e};c.reject=function(a,c,b){var e=[];if(null==a)return e;w(a,function(a,p,d){c.call(b,a,p,d)||(e[e.length]=a)});return e};c.every=c.all=function(a,c,b){var e=!0;if(null==a)return e;if(H&&a.every===H)return a.every(c,b);w(a,function(a,p,d){if(!(e=e&&c.call(b,a,p,d)))return l});return!!e};
var C=c.some=c.any=function(a,b,e){b||(b=c.identity);var d=!1;if(null==a)return d;if(z&&a.some===z)return a.some(b,e);w(a,function(a,p,c){if(d||(d=b.call(e,a,p,c)))return l});return!!d};c.include=c.contains=function(a,c){var b=!1;return null==a?b:u&&a.indexOf===u?-1!=a.indexOf(c):b=C(a,function(a){return a===c})};c.invoke=function(a,b){var e=d.call(arguments,2);return c.map(a,function(a){return(c.isFunction(b)?b||a:a[b]).apply(a,e)})};c.pluck=function(a,b){return c.map(a,function(a){return a[b]})};
c.max=function(a,b,e){if(!b&&c.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&c.isEmpty(a))return-Infinity;var d={computed:-Infinity};w(a,function(a,c,p){c=b?b.call(e,a,c,p):a;c>=d.computed&&(d={value:a,computed:c})});return d.value};c.min=function(a,b,e){if(!b&&c.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&c.isEmpty(a))return Infinity;var d={computed:Infinity};w(a,function(a,c,p){c=b?b.call(e,a,c,p):a;c<d.computed&&(d={value:a,computed:c})});return d.value};c.shuffle=
function(a){var c=[],b;w(a,function(a,p){b=Math.floor(Math.random()*(p+1));c[p]=c[b];c[b]=a});return c};c.sortBy=function(a,b,e){var d=c.isFunction(b)?b:function(a){return a[b]};return c.pluck(c.map(a,function(a,c,p){return{value:a,criteria:d.call(e,a,c,p)}}).sort(function(a,c){var p=a.criteria,b=c.criteria;return void 0===p?1:void 0===b?-1:p<b?-1:p>b?1:0}),"value")};c.groupBy=function(a,b){var e={},d=c.isFunction(b)?b:function(a){return a[b]};w(a,function(a,c){var p=d(a,c);(e[p]||(e[p]=[])).push(a)});
return e};c.sortedIndex=function(a,b,e){e||(e=c.identity);for(var d=0,f=a.length;d<f;){var m=d+f>>1;e(a[m])<e(b)?d=m+1:f=m}return d};c.toArray=function(a){return!a?[]:c.isArray(a)||c.isArguments(a)?d.call(a):a.toArray&&c.isFunction(a.toArray)?a.toArray():c.values(a)};c.size=function(a){return c.isArray(a)?a.length:c.keys(a).length};c.first=c.head=c.take=function(a,c,b){return null!=c&&!b?d.call(a,0,c):a[0]};c.initial=function(a,c,b){return d.call(a,0,a.length-(null==c||b?1:c))};c.last=function(a,
c,b){return null!=c&&!b?d.call(a,Math.max(a.length-c,0)):a[a.length-1]};c.rest=c.tail=function(a,c,b){return d.call(a,null==c||b?1:c)};c.compact=function(a){return c.filter(a,function(a){return!!a})};c.flatten=function(a,b){return c.reduce(a,function(a,p){if(c.isArray(p))return a.concat(b?p:c.flatten(p));a[a.length]=p;return a},[])};c.without=function(a){return c.difference(a,d.call(arguments,1))};c.uniq=c.unique=function(a,b,e){e=e?c.map(a,e):a;var d=[];3>a.length&&(b=!0);c.reduce(e,function(e,f,
m){if(b?c.last(e)!==f||!e.length:!c.include(e,f))e.push(f),d.push(a[m]);return e},[]);return d};c.union=function(){return c.uniq(c.flatten(arguments,!0))};c.intersection=c.intersect=function(a){var b=d.call(arguments,1);return c.filter(c.uniq(a),function(a){return c.every(b,function(b){return 0<=c.indexOf(b,a)})})};c.difference=function(a){var b=c.flatten(d.call(arguments,1),!0);return c.filter(a,function(a){return!c.include(b,a)})};c.zip=function(){for(var a=d.call(arguments),b=c.max(c.pluck(a,"length")),
e=Array(b),f=0;f<b;f++)e[f]=c.pluck(a,""+f);return e};c.indexOf=function(a,b,e){if(null==a)return-1;var d;if(e)return e=c.sortedIndex(a,b),a[e]===b?e:-1;if(u&&a.indexOf===u)return a.indexOf(b);e=0;for(d=a.length;e<d;e++)if(e in a&&a[e]===b)return e;return-1};c.lastIndexOf=function(a,c){if(null==a)return-1;if(r&&a.lastIndexOf===r)return a.lastIndexOf(c);for(var b=a.length;b--;)if(b in a&&a[b]===c)return b;return-1};c.range=function(a,c,b){1>=arguments.length&&(c=a||0,a=0);b=arguments[2]||1;for(var e=
Math.max(Math.ceil((c-a)/b),0),d=0,f=Array(e);d<e;)f[d++]=a,a+=b;return f};var D=function(){};c.bind=function(a,b){var e,f;if(a.bind===v&&v)return v.apply(a,d.call(arguments,1));if(!c.isFunction(a))throw new TypeError;f=d.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(b,f.concat(d.call(arguments)));D.prototype=a.prototype;var c=new D,m=a.apply(c,f.concat(d.call(arguments)));return Object(m)===m?m:c}};c.bindAll=function(a){var b=d.call(arguments,1);0==b.length&&(b=c.functions(a));
w(b,function(b){a[b]=c.bind(a[b],a)});return a};c.memoize=function(a,b){var e={};b||(b=c.identity);return function(){var d=b.apply(this,arguments);return c.has(e,d)?e[d]:e[d]=a.apply(this,arguments)}};c.delay=function(a,c){var b=d.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},c)};c.defer=function(a){return c.delay.apply(c,[a,1].concat(d.call(arguments,1)))};c.throttle=function(a,b){var e,d,f,m,k,g,t=c.debounce(function(){k=m=!1},b);return function(){e=this;d=arguments;f||
(f=setTimeout(function(){f=null;k&&a.apply(e,d);t()},b));m?k=!0:g=a.apply(e,d);t();m=!0;return g}};c.debounce=function(a,c,b){var e;return function(){var d=this,f=arguments;b&&!e&&a.apply(d,f);clearTimeout(e);e=setTimeout(function(){e=null;b||a.apply(d,f)},c)}};c.once=function(a){var c=!1,b;return function(){if(c)return b;c=!0;return b=a.apply(this,arguments)}};c.wrap=function(a,c){return function(){var b=[a].concat(d.call(arguments,0));return c.apply(this,b)}};c.compose=function(){var a=arguments;
return function(){for(var c=arguments,b=a.length-1;0<=b;b--)c=[a[b].apply(this,c)];return c[0]}};c.after=function(a,c){return 0>=a?c():function(){if(1>--a)return c.apply(this,arguments)}};c.keys=t||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],e;for(e in a)c.has(a,e)&&(b[b.length]=e);return b};c.values=function(a){return c.map(a,c.identity)};c.functions=c.methods=function(a){var b=[],e;for(e in a)c.isFunction(a[e])&&b.push(e);return b.sort()};c.extend=function(a){w(d.call(arguments,
1),function(c){for(var b in c)a[b]=c[b]});return a};c.pick=function(a){var b={};w(c.flatten(d.call(arguments,1)),function(c){c in a&&(b[c]=a[c])});return b};c.defaults=function(a){w(d.call(arguments,1),function(c){for(var b in c)null==a[b]&&(a[b]=c[b])});return a};c.clone=function(a){return!c.isObject(a)?a:c.isArray(a)?a.slice():c.extend({},a)};c.tap=function(a,c){c(a);return a};c.isEqual=function(a,c){return n(a,c,[])};c.isEmpty=function(a){if(null==a)return!0;if(c.isArray(a)||c.isString(a))return 0===
a.length;for(var b in a)if(c.has(a,b))return!1;return!0};c.isElement=function(a){return!!(a&&1==a.nodeType)};c.isArray=f||function(c){return"[object Array]"==a.call(c)};c.isObject=function(a){return a===Object(a)};c.isArguments=function(c){return"[object Arguments]"==a.call(c)};c.isArguments(arguments)||(c.isArguments=function(a){return!(!a||!c.has(a,"callee"))});c.isFunction=function(c){return"[object Function]"==a.call(c)};c.isString=function(c){return"[object String]"==a.call(c)};c.isNumber=function(c){return"[object Number]"==
a.call(c)};c.isFinite=function(a){return c.isNumber(a)&&isFinite(a)};c.isNaN=function(a){return a!==a};c.isBoolean=function(c){return!0===c||!1===c||"[object Boolean]"==a.call(c)};c.isDate=function(c){return"[object Date]"==a.call(c)};c.isRegExp=function(c){return"[object RegExp]"==a.call(c)};c.isNull=function(a){return null===a};c.isUndefined=function(a){return void 0===a};c.has=function(a,c){return e.call(a,c)};c.noConflict=function(){h._=j;return this};c.identity=function(a){return a};c.times=
function(a,c,b){for(var e=0;e<a;e++)c.call(b,e)};c.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};c.result=function(a,b){if(null==a)return null;var e=a[b];return c.isFunction(e)?e.call(a):e};c.mixin=function(a){w(c.functions(a),function(e){var f=c[e]=a[e];I.prototype[e]=function(){var a=d.call(arguments);b.call(a,this._wrapped);return M(f.apply(c,a),this._chain)}})};var G=0;c.uniqueId=
function(a){var c=G++;return a?a+c:c};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/.^/,L={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},O;for(O in L)L[L[O]]=O;var T=/\\|'|\r|\n|\t|\u2028|\u2029/g,U=/\\(\\|'|r|n|t|u2028|u2029)/g,P=function(a){return a.replace(U,function(a,c){return L[c]})};c.template=function(a,b,e){e=c.defaults(e||{},c.templateSettings);a="__p+='"+a.replace(T,function(a){return"\\"+L[a]}).replace(e.escape||
N,function(a,c){return"'+\n_.escape("+P(c)+")+\n'"}).replace(e.interpolate||N,function(a,c){return"'+\n("+P(c)+")+\n'"}).replace(e.evaluate||N,function(a,c){return"';\n"+P(c)+"\n;__p+='"})+"';\n";e.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var d=new Function(e.variable||"obj","_",a);if(b)return d(b,c);b=function(a){return d.call(this,a,c)};b.source="function("+(e.variable||"obj")+"){\n"+a+"}";return b};
c.chain=function(a){return c(a).chain()};var I=function(a){this._wrapped=a};c.prototype=I.prototype;var M=function(a,b){return b?c(a).chain():a};c.mixin(c);w("pop push reverse shift sort splice unshift".split(" "),function(a){var c=g[a];I.prototype[a]=function(){var b=this._wrapped;c.apply(b,arguments);var e=b.length;("shift"==a||"splice"==a)&&0===e&&delete b[0];return M(b,this._chain)}});w(["concat","join","slice"],function(a){var c=g[a];I.prototype[a]=function(){return M(c.apply(this._wrapped,arguments),
this._chain)}});I.prototype.chain=function(){this._chain=!0;return this};I.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};
(function(){var n=[].slice,h=/\s+/,j=function(f,d,b,a){if(!b)return!0;if("object"===typeof b)for(var e in b)f[d].apply(f,[e,b[e]].concat(a));else if(h.test(b)){b=b.split(h);e=0;for(var m=b.length;e<m;e++)f[d].apply(f,[b[e]].concat(a))}else return!0},l=function(f,d,b){var a;f=-1;var e=d.length;switch(b.length){case 0:for(;++f<e;)(a=d[f]).callback.call(a.ctx);break;case 1:for(;++f<e;)(a=d[f]).callback.call(a.ctx,b[0]);break;case 2:for(;++f<e;)(a=d[f]).callback.call(a.ctx,b[0],b[1]);break;case 3:for(;++f<
e;)(a=d[f]).callback.call(a.ctx,b[0],b[1],b[2]);break;default:for(;++f<e;)(a=d[f]).callback.apply(a.ctx,b)}},g=Backbone.Events={on:function(f,d,b){if(!j(this,"on",f,[d,b])||!d)return this;this._events||(this._events={});(this._events[f]||(this._events[f]=[])).push({callback:d,context:b,ctx:b||this});return this},once:function(f,d,b){if(!j(this,"once",f,[d,b])||!d)return this;var a=this,e=_.once(function(){a.off(f,e);d.apply(this,arguments)});e._callback=d;this.on(f,e,b);return this},off:function(f,
d,b){var a,e,m,g,h,k,q,l;if(!this._events||!j(this,"off",f,[d,b]))return this;if(!f&&!d&&!b)return this._events={},this;g=f?[f]:_.keys(this._events);h=0;for(k=g.length;h<k;h++)if(f=g[h],a=this._events[f]){m=[];if(d||b){q=0;for(l=a.length;q<l;q++)e=a[q],(d&&d!==(e.callback._callback||e.callback)||b&&b!==e.context)&&m.push(e)}this._events[f]=m}return this},trigger:function(f){if(!this._events)return this;var d=n.call(arguments,1);if(!j(this,"trigger",f,d))return this;var b=this._events[f],a=this._events.all;
b&&l(this,b,d);a&&l(this,a,arguments);return this},listenTo:function(f,d,b){var a=this._listeners||(this._listeners={}),e=f._listenerId||(f._listenerId=_.uniqueId("l"));a[e]=f;f.on(d,b||this,this);return this},stopListening:function(f,d,b){var a=this._listeners;if(a){if(f)f.off(d,b,this),!d&&!b&&delete a[f._listenerId];else{for(var e in a)a[e].off(null,null,this);this._listeners={}}return this}}};g.bind=g.on;g.unbind=g.off})();(function(){for(var n=0,h=["ms","moz","webkit","o"],j=0;j<h.length&&!window.requestAnimationFrame;++j)window.requestAnimationFrame=window[h[j]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[h[j]+"CancelAnimationFrame"]||window[h[j]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(h){var g=(new Date).getTime(),f=Math.max(0,16-(g-n)),d=window.setTimeout(function(){h(g+f)},f);n=g+f;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(h){clearTimeout(h)})})();(function(){function n(){var a=document.body.getBoundingClientRect(),b=this.width=a.width,a=this.height=a.height;this.renderer.setSize(b,a);this.trigger(k.Events.resize,b,a)}var h=this,j=h.Two||{},l=Math.sin,g=Math.cos,f=Math.atan2,d=Math.sqrt,b=Math.abs,a=Math.PI,e=2*a,m=a/2,A=Math.pow,x={hasEventListeners:_.isFunction(h.addEventListener),bind:function(a,b,c,e){this.hasEventListeners?a.addEventListener(b,c,!!e):a.attachEvent("on"+b,c);return this},unbind:function(a,b,c,e){this.hasEventListeners?
a.removeEventListeners(b,c,!!e):a.detachEvent("on"+b,c);return this}},k=h.Two=function(a){a=_.defaults(a||{},{fullscreen:!1,width:640,height:480,type:k.Types.svg,autostart:!1});this.type=a.type;this.renderer=new k[this.type](this);this.playing=a.autostart;this.frameCount=0;a.fullscreen?(a=_.bind(n,this),_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),x.bind(window,"resize",a),a()):(this.renderer.setSize(a.width,a.height),this.width=
a.width,this.height=a.height);this.scene=new k.Group;this.renderer.add(this.scene);k.Instances.push(this)};_.extend(k,{Array:h.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){h.Two=j;return this},Utils:{Curve:{CollinearityEpsilon:A(10,-30),RecursionLimit:32,
CuspLimit:0,Tolerance:{distance:0.25,angle:0,epsilon:0.01}},subdivide:function(d,m,c,g,h,A,x,q,j){var l=k.Utils.Curve.CollinearityEpsilon,z=k.Utils.Curve.CuspLimit,n=k.Utils.Curve.Tolerance;j=j||0;var H=(d+c)/2,u=(m+g)/2,r=(c+h)/2,p=(g+A)/2,s=(h+x)/2,Q=(A+q)/2,R=(H+r)/2,S=(u+p)/2,r=(r+s)/2,p=(p+Q)/2,E=(R+r)/2,F=(S+p)/2;if(0<j){var y=x-d,B=q-m,J=b((c-x)*B-(g-q)*y),K=b((h-x)*B-(A-q)*y);if(J>l&&K>l&&(J+K)*(J+K)<=n.distance*(y*y+B*B)){if(n.angle<n.epsilon)return[new k.Vector(E,F)];y=f(A-g,h-c);l=b(y-
f(g-m,c-d));y=b(f(q-A,x-h)-y);l>=a&&(l=e-l);y>=a&&(y=e-y);if(l+y<n.angle)return[new k.Vector(E,F)];if(0!==z){if(l>z)return[new k.Vector(c,g)];if(y>z)return[new k.Vector(h,A)]}}}else if(J>l)if(J*J<=n.distance*(y*y+B*B)){if(n.angle<n.epsilon)return[new k.Vector(E,F)];l=b(f(A-g,h-c)-f(g-m,c-d));l>=a&&(l=e-l);if(l<n.angle)return[new k.Vector(c,g),new k.Vector(h,A)];if(0!==z&&l>z)return[new k.Vector(c,g)]}else if(K>l){if(K*K<=n.distance*(y*y+B*B)){if(n.angle<n.epsilon)return[new k.Vector(E,F)];l=b(f(q-
A,x-h)-f(A-g,h-c));l>=a&&(l=e-l);if(l<n.angle)return[new k.Vector(c,g),new k.Vector(h,A)];if(0!==z&&l>z)return[new k.Vector2(h,A)]}}else if(y=E-(d+x)/2,B=F-(m+q)/2,y*y+B*B<=n.distance)return[new k.Vector(E,F)];return k.Utils.subdivide(d,m,H,u,R,S,E,F,j+1).concat(k.Utils.subdivide(E,F,r,p,s,Q,x,q,j+1))},getCurveFromPoints:function(a,b){for(var c=[],e=a.length,d=e-1,f=0;f<e;f++){var m=a[f],g={x:m.x,y:m.y};c.push(g);var m=b?r(f-1,e):Math.max(f-1,0),k=b?r(f+1,e):Math.min(f+1,d);u(a[m],g,a[k]);!g.u.x&&
!g.u.y&&(g.u.x=g.x,g.u.y=g.y);!g.v.x&&!g.v.y&&(g.v.x=g.x,g.v.y=g.y)}return c},getControlPoints:function(b,e,c){var d=z(b,e),f=z(c,e);b=q(b,e);c=q(c,e);var k=(d+f)/2;if(1E-4>b||1E-4>c)return e.u={x:e.x,y:e.y},e.v={x:e.x,y:e.y},e;b*=0.33;c*=0.33;k=f<d?k+m:k-m;d={x:e.x+g(k)*b,y:e.y+l(k)*b};k-=a;f={x:e.x+g(k)*c,y:e.y+l(k)*c};e.u=d;e.v=f;return e},angleBetween:function(a,b){return f(a.y-b.y,a.x-b.x)},distanceBetweenSquared:function(a,b){var c=a.x-b.x,e=a.y-b.y;return c*c+e*e},distanceBetween:function(a,
b){return d(H(a,b))},mod:function(a,b){for(;0>a;)a+=b;return a%b},Error:function(a){this.name="two.js";this.message=a}}});k.Utils.Error.prototype=Error();k.Utils.Error.prototype.constructor=k.Utils.Error;var q=k.Utils.distanceBetween,H=k.Utils.distanceBetweenSquared,z=k.Utils.angleBetween,u=k.Utils.getControlPoints,r=k.Utils.mod;_.extend(k.prototype,Backbone.Events,{appendTo:function(a){a.appendChild(this.renderer.domElement);return this},play:function(){this.playing=!0;return this.trigger(k.Events.play)},
pause:function(){this.playing=!1;return this.trigger(k.Events.pause)},update:function(){this.frameCount++;var a=this.width,b=this.height,c=this.renderer;(a!==c.width||b!==c.height)&&c.setSize(a,b);return this.trigger(k.Events.update,this.frameCount)},render:function(){this.renderer.render();return this.trigger(k.Events.render,this.frameCount)},add:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));this.scene.add(b);return this},makeLine:function(a,b,c,e){c=(c-a)/2;e=(e-b)/2;var d=[new k.Vector(-c,
-e),new k.Vector(c,e)],d=(new k.Polygon(d)).noFill();d.translation.set(a+c,b+e);this.scene.add(d);return d},makeRectangle:function(a,b,c,e){c/=2;e/=2;e=[new k.Vector(c,e),new k.Vector(-c,e),new k.Vector(-c,-e),new k.Vector(c,-e)];e=new k.Polygon(e,!0);e.translation.set(a,b);this.scene.add(e);return e},makeCircle:function(a,b,c){return this.makeEllipse(a,b,c,c)},makeEllipse:function(a,b,c,d){var f=k.Resolution,m=_.map(_.range(f),function(a){var b=a/f*e;a=c*g(b);b=d*l(b);return new k.Vector(a,b)},this),
m=new k.Polygon(m,!0,!0);m.translation.set(a,b);this.scene.add(m);return m},makeCurve:function(a){var b=arguments.length,c=a;if(!_.isArray(a))for(var c=[],e=0;e<b;e+=2){var d=arguments[e];if(!_.isNumber(d))break;c.push(new k.Vector(d,arguments[e+1]))}var b=arguments[b-1],c=new k.Polygon(c,!(_.isBoolean(b)&&b),!0),b=c.getBoundingClientRect(),f=b.left+b.width/2,m=b.top+b.height/2;_.each(c.vertices,function(a){a.x-=f;a.y-=m});c.translation.set(f,m);this.scene.add(c);return c},makePolygon:function(a){var b=
arguments.length,c=a;if(!_.isArray(a))for(var c=[],e=0;e<b;e+=2){var d=arguments[e];if(!_.isNumber(d))break;c.push(new k.Vector(d,arguments[e+1]))}b=arguments[b-1];c=new k.Polygon(c,!(_.isBoolean(b)&&b));c.center();this.scene.add(c);return c},makeGroup:function(a){var b=a;_.isArray(a)||(b=_.toArray(arguments));var c=new k.Group;this.scene.add(c);c.add(b);return c}});(function(){_.each(k.Instances,function(a){a.playing&&a.update().render()});requestAnimationFrame(arguments.callee)})()})();(function(){var n=Two.Vector=function(h,j){h=h||0;j=j||0;Object.defineProperty(this,"x",{get:function(){return h},set:function(j){h=j;this.trigger("change","x")}});Object.defineProperty(this,"y",{get:function(){return j},set:function(h){j=h;this.trigger("change","y")}})};_.extend(n,{});_.extend(n.prototype,Backbone.Events,{set:function(h,j){this.x=h;this.y=j;return this},copy:function(h){this.x=h.x;this.y=h.y;return this},clear:function(){this.y=this.x=0;return this},clone:function(){return new n(this.x,
this.y)},add:function(h,j){this.x=h.x+j.x;this.y=h.y+j.y;return this},addSelf:function(h){this.x+=h.x;this.y+=h.y;return this},sub:function(h,j){this.x=h.x-j.x;this.y=h.y-j.y;return this},subSelf:function(h){this.x-=h.x;this.y-=h.y;return this},multiplySelf:function(h){this.x*=h.x;this.y*=h.y;return this},multiplyScalar:function(h){this.x*=h;this.y*=h;return this},divideScalar:function(h){h?(this.x/=h,this.y/=h):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(h){return this.x*
h.x+this.y*h.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(h){return Math.sqrt(this.distanceToSquared(h))},distanceToSquared:function(h){var j=this.x-h.x;h=this.y-h.y;return j*j+h*h},setLength:function(h){return this.normalize().multiplyScalar(h)},equals:function(h){return 1E-4>this.distanceTo(h)},lerp:function(h,j){return this.set((h.x-this.x)*
j+this.x,(h.y-this.y)*j+this.y)},isZero:function(){return 1E-4>this.length()}})})();(function(){_.range(6);var n=Math.cos,h=Math.sin,j=Math.tan,l=Two.Matrix=function(g,f,d,b,a,e){this.elements=new Two.Array(9);var m=g;_.isArray(m)||(m=_.toArray(arguments));this.identity().set(m)};_.extend(l,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(g,f){if(3>=f.length){var d=f[0]||0,b=f[1]||0,a=f[2]||0;return{x:g[0]*d+g[1]*b+g[2]*a,y:g[3]*d+g[4]*b+g[5]*a,z:g[6]*d+g[7]*b+g[8]*a}}var d=g[0],b=g[1],a=g[2],e=g[3],m=g[4],h=g[5],x=g[6],k=g[7],q=g[8],j=f[0],l=f[1],n=f[2],r=f[3],t=f[4],v=f[5],c=f[6],
w=f[7],C=f[8];return[d*j+b*r+a*c,d*l+b*t+a*w,d*n+b*v+a*C,e*j+m*r+h*c,e*l+m*t+h*w,e*n+m*v+h*C,x*j+k*r+q*c,x*l+k*t+q*w,x*n+k*v+q*C]}});_.extend(l.prototype,{set:function(g,f,d,b,a,e){var m=g;_.isArray(m)||(m=_.toArray(arguments));_.each(m,function(a,b){_.isNumber(a)&&(this.elements[b]=a)},this);return this},identity:function(){this.set(l.Identity);return this},multiply:function(g,f,d,b,a,e,m,h,x){var k=arguments,q=k.length;if(1>=q)return _.each(this.elements,function(a,b){this.elements[b]=a*g},this),
this;if(3>=q)return g=g||0,f=f||0,d=d||0,a=this.elements,{x:a[0]*g+a[1]*f+a[2]*d,y:a[3]*g+a[4]*f+a[5]*d,z:a[6]*g+a[7]*f+a[8]*d};q=this.elements;A0=q[0];A1=q[1];A2=q[2];A3=q[3];A4=q[4];A5=q[5];A6=q[6];A7=q[7];A8=q[8];B0=k[0];B1=k[1];B2=k[2];B3=k[3];B4=k[4];B5=k[5];B6=k[6];B7=k[7];B8=k[8];this.elements[0]=A0*B0+A1*B3+A2*B6;this.elements[1]=A0*B1+A1*B4+A2*B7;this.elements[2]=A0*B2+A1*B5+A2*B8;this.elements[3]=A3*B0+A4*B3+A5*B6;this.elements[4]=A3*B1+A4*B4+A5*B7;this.elements[5]=A3*B2+A4*B5+A5*B8;this.elements[6]=
A6*B0+A7*B3+A8*B6;this.elements[7]=A6*B1+A7*B4+A8*B7;this.elements[8]=A6*B2+A7*B5+A8*B8;return this},scale:function(g,f){1>=arguments.length&&(f=g);return this.multiply(g,0,0,0,f,0,0,0,1)},rotate:function(g){var f=n(g);g=h(g);return this.multiply(f,-g,0,g,f,0,0,0,1)},translate:function(g,f){return this.multiply(1,0,g,0,1,f,0,0,1)},skewX:function(g){g=j(g);return this.multiply(1,g,0,0,1,0,0,0,1)},skewY:function(g){g=j(g);return this.multiply(1,0,0,g,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},
toArray:function(g){var f=this.elements,d=parseFloat(f[0].toFixed(3)),b=parseFloat(f[1].toFixed(3)),a=parseFloat(f[2].toFixed(3)),e=parseFloat(f[3].toFixed(3)),m=parseFloat(f[4].toFixed(3)),h=parseFloat(f[5].toFixed(3));if(g){g=parseFloat(f[6].toFixed(3));var x=parseFloat(f[7].toFixed(3)),f=parseFloat(f[8].toFixed(3));return[d,e,g,b,m,x,a,h,f]}return[d,e,b,m,a,h]},clone:function(){return new Two.Matrix(this.elements[0],this.elements[1],this.elements[2],this.elements[3],this.elements[4],this.elements[5])}})})();(function(){function n(d){var b={},a=d.id,e=d.translation,m=d.rotation,h=d.scale,x=d.stroke,k=d.linewidth,q=d.fill,j=d.opacity,l=d.visible,n=d.cap,r=d.join,t=d.miter,v=d.curved,c=d.closed;d=d.vertices;a&&(b.id=f.Identifier+a);e&&(_.isNumber(h)&&_.isNumber(m))&&(b.transform="translate("+e.x+","+e.y+") scale("+h+") rotate("+m+")");x&&(b.stroke=x);q&&(b.fill=q);j&&(b["stroke-opacity"]=b["fill-opacity"]=j);b.visibility=l?"visible":"hidden";n&&(b["stroke-linecap"]=n);r&&(b["stroke-linejoin"]=r);t&&(b["stroke-miterlimit"]=
t);k&&(b["stroke-width"]=k);d&&(b.d=g.toString(d,c,v));return b}var h=0,j=Two.Utils.getCurveFromPoints,l=Two.Utils.mod,g={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(d,b){var a=d.toLowerCase(),e=document.createElementNS(this.ns,a);"svg"===a&&(b=_.defaults(b||{},{version:this.version}));_.isObject(b)&&this.setAttributes(e,b);return e},setAttributes:function(d,b){_.each(b,function(a,b){this.setAttribute(b,a)},d);return this},removeAttributes:function(d,
b){_.each(b,function(a){this.removeAttribute(a)},d);return this},toString:function(d,b,a){var e=d.length,f=e-1;if(!a)return _.map(d,function(a,e){var d;d=(0>=e?"M":"L")+(" "+a.x.toFixed(3)+" "+a.y.toFixed(3));e>=f&&b&&(d+=" Z");return d}).join(" ");var g=j(d,b);return _.map(g,function(a,d){var h,j=b?l(d-1,e):Math.max(d-1,0),n=b?l(d+1,e):Math.min(d+1,f);h=g[j];var n=g[n],j=h.v.x.toFixed(3),u=h.v.y.toFixed(3),r=a.u.x.toFixed(3),t=a.u.y.toFixed(3),v=a.x.toFixed(3),c=a.y.toFixed(3);h=0>=d?"M "+v+" "+
c:"C "+j+" "+u+" "+r+" "+t+" "+v+" "+c;d>=f&&b&&(j=a.v.x.toFixed(3),u=a.v.y.toFixed(3),r=n.u.x.toFixed(3),t=n.u.y.toFixed(3),v=n.x.toFixed(3),c=n.y.toFixed(3),h=h+(" C "+j+" "+u+" "+r+" "+t+" "+v+" "+c)+" Z");return h}).join(" ")}},f=Two[Two.Types.svg]=function(){this.domElement=g.createElement("svg");this.elements=[];this.commands=[];this.domElement.style.visibility="hidden";this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(f,{Identifier:"two-"});_.extend(f.prototype,
Backbone.Events,{setSize:function(d,b){this.width=d;this.height=b;g.setAttributes(this.domElement,{width:d,height:b});return this},add:function(d){var b=d,a=this.elements,e=this.domElement;_.isArray(d)||(b=_.map(arguments,function(a){return a}));_.each(b,function(b){var d;d=b instanceof Two.Group;if(_.isUndefined(b.id)){var f=h;h++;b.id=f}d?(d="g",_.isUndefined(b.parent)&&(b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),b=n(b),delete b.stroke,delete b.fill,
delete b["fill-opacity"],delete b["stroke-opacity"],delete b["stroke-linecap"],delete b["stroke-linejoin"],delete b["stroke-miterlimit"],delete b["stroke-width"]):(d="path",b=n(b));b=g.createElement(d,b);e.appendChild(b);a.push(b)},this);return this},update:function(d,b,a){this.commands.push(arguments);return this},render:function(){this.unveil();var d=this.elements;_.each(this.commands,function(b){var a=b[1],e=b[2],f=b[3],h=b[4],j=d[b[0]];switch(a){case Two.Properties.hierarchy:_.each(e,function(a){j.appendChild(d[a])});
break;case Two.Properties.demotion:_.each(e,function(a){j.removeChild(d[a])});break;default:a:{b=a;switch(b){case "matrix":b="transform";e="matrix("+e.toString()+")";break;case "visible":b="visibility";e=e?"visible":"hidden";break;case "cap":b="stroke-linecap";break;case "join":b="stroke-linejoin";break;case "miter":b="stroke-miterlimit";break;case "linewidth":b="stroke-width";break;case "vertices":b="d";e=g.toString(e,f,h);break;case "opacity":g.setAttributes(j,{"stroke-opacity":opacity,"fill-opacity":opacity});
break a}j.setAttribute(b,e)}}},this);this.commands.length=0;return this}})})();(function(){var n=0,h=Two.Utils.getCurveFromPoints,j=Two.Utils.mod,l=function(b){_.each(b,function(a,b){this[b]=a},this);this.children={}};_.extend(l.prototype,{appendChild:function(b){var a=b.parent,e=b.id;_.isUndefined(a)||delete a.children[e];this.children[e]=b;b.parent=this;return this},removeChild:function(b){delete this.children[b.id];return this},render:function(b){var a=this.matrix;b.save();b.transform(a[0],a[1],a[2],a[3],a[4],a[5]);_.each(this.children,function(a){a.render(b)});b.restore();
return this}});var g=function(b){_.each(b,function(a,b){this[b]=a},this)};_.extend(g.prototype,{render:function(b){var a=this.matrix,e=this.stroke,d=this.linewidth,f=this.fill,g=this.opacity,h=this.cap,q=this.join,l=this.miter,n=this.curved,u=this.closed,r=this.commands,t=r.length,v=t-1;if(!this.visible)return this;b.save();a&&b.transform(a[0],a[1],a[2],a[3],a[4],a[5]);f&&(b.fillStyle=f);e&&(b.strokeStyle=e);d&&(b.lineWidth=d);l&&(b.miterLimit=l);q&&(b.lineJoin=q);h&&(b.lineCap=h);_.isNumber(g)&&
(b.globalAlpha=g);b.beginPath();_.each(r,function(a,e){var d=a.x.toFixed(3),f=a.y.toFixed(3);if(n){var g=u?j(e-1,t):Math.max(e-1,0),h=u?j(e+1,t):Math.min(e+1,v),m=r[g],h=r[h],g=m.v.x.toFixed(3),m=m.v.y.toFixed(3),k=a.u.x.toFixed(3),q=a.u.y.toFixed(3);0>=e?b.moveTo(d,f):(b.bezierCurveTo(g,m,k,q,d,f),e>=v&&u&&(g=a.v.x.toFixed(3),m=a.v.y.toFixed(3),k=h.u.x.toFixed(3),q=h.u.y.toFixed(3),d=h.x.toFixed(3),f=h.y.toFixed(3),b.bezierCurveTo(g,m,k,q,d,f)))}else 0>=e?b.moveTo(d,f):b.lineTo(d,f)});u&&!n&&b.closePath();
b.fill();b.stroke();b.restore()}});var f={toArray:function(b,a,e){return!a?_.map(b,function(a){return{x:a.x,y:a.y}}):h(b,e)}},d=Two[Two.Types.canvas]=function(){this.domElement=document.createElement("canvas");this.ctx=this.domElement.getContext("2d");this.elements=[];this.stage=null};_.extend(d,{});_.extend(d,{Group:l,Element:g,getStyles:function(b){var a={},e=b.id,d=b._matrix,g=b.stroke,h=b.linewidth,k=b.fill,j=b.opacity,l=b.visible,n=b.cap,u=b.join,r=b.miter,t=b.curved,v=b.closed;b=b.vertices;
e&&(a.id=e);_.isObject(d)&&(a.matrix=d.toArray());g&&(a.stroke=g);k&&(a.fill=k);_.isNumber(j)&&(a.opacity=j);n&&(a.cap=n);u&&(a.join=u);r&&(a.miter=r);h&&(a.linewidth=h);b&&(a.commands=f.toArray(b,t,v));a.visible=!!l;a.curved=!!t;a.closed=!!v;return a},setStyles:function(b,a,e,d,g){switch(a){case "matrix":a="matrix";e=e.toArray();break;case "vertices":a="commands",b.curved=g,b.closed=d,e=f.toArray(e,b.curved,b.closed)}b[a]=e},Utils:f});_.extend(d.prototype,Backbone.Events,{setSize:function(b,a){this.width=
this.domElement.width=b;this.height=this.domElement.height=a;_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"});return this},add:function(b){constructor=Object.getPrototypeOf(this).constructor;var a=b,e=this.elements,d=constructor.Group,f=constructor.Element,g=constructor.getStyles;_.isArray(b)||(a=_.map(arguments,function(a){return a}));_.each(a,function(a){var b;b=a instanceof Two.Group;var h=_.isNull(this.stage);if(_.isUndefined(a.id)){var j=n;n++;a.id=j}b?(b=g.call(this,
a),delete b.stroke,delete b.fill,delete b.opacity,delete b.cap,delete b.join,delete b.miter,delete b.linewidth,b=new d(b),h&&(this.stage=b,this.stage.object=a,a.parent=this,a.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):b=new f(g.call(this,a));e.push(b);h||this.stage.appendChild(b)},this);return this},update:function(b,a,e,d,f,g){var h=Object.getPrototypeOf(this).constructor,j=this.elements,l=j[b];switch(a){case Two.Properties.hierarchy:_.each(e,function(a){l.appendChild(j[a])});
break;case Two.Properties.demotion:_.each(e,function(a){l.removeChild(j[a]);this.elements[a]=null},this);default:h.setStyles.call(this,l,a,e,d,f,g)}return this},render:function(){if(_.isNull(this.stage))return this;this.ctx.clearRect(0,0,this.width,this.height);this.stage.render(this.ctx);return this}})})();(function(){var n=Two[Two.Types.canvas],h=Two.Matrix.Multiply,j=Two[Two.Types.canvas].Utils.toArray,l=Two.Utils.mod,g=function(a){n.Group.call(this,a)};_.extend(g.prototype,n.Group.prototype,{appendChild:function(){n.Group.prototype.appendChild.apply(this,arguments);this.updateMatrix();return this},updateTexture:function(a){_.each(this.children,function(b){b.updateTexture(a)});return this},updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;
if(!b)return this;this._matrix=h(this.matrix,b);this._scale=this.scale*a;_.each(this.children,function(a){a.updateMatrix(this)},this);return this},render:function(a,b){_.each(this.children,function(d){d.render(a,b)})}});var f=function(a){n.Element.call(this,a)};_.extend(f.prototype,n.Element.prototype,{updateMatrix:function(a){var b=a&&a._matrix||this.parent&&this.parent._matrix;a=a&&a._scale||this.parent&&this.parent._scale;if(!b)return this;this._matrix=h(this.matrix,b);this._scale=this.scale*a;
return this},updateTexture:function(a){d.updateTexture(a,this);return this},render:function(a,b){if(!this.visible||!this.opacity||!this.buffer)return this;a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordsBuffer);a.vertexAttribPointer(b.textureCoords,2,a.FLOAT,!1,0,0);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniformMatrix3fv(b.matrix,!1,this._matrix);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.vertexAttribPointer(b.position,2,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLES,0,6);return this}});var d={canvas:document.createElement("canvas"),
uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(a,b,d){var f=Infinity,g=-Infinity,h=Infinity,j=-Infinity;_.each(a,function(a){var b=a.x,e=a.y,l;h=Math.min(e,h);f=Math.min(b,f);g=Math.max(b,g);j=Math.max(e,j);d&&(b=a.u.x,e=a.u.y,l=a.v.x,a=a.v.y,h=Math.min(e,a,h),f=Math.min(b,l,f),g=Math.max(b,l,g),j=Math.max(e,a,j))});_.isNumber(b)&&(h-=b,f-=b,g+=b,j+=b);a=g-f;b=j-h;var l={x:Math.abs(f),y:Math.abs(h)};return{top:h,left:f,right:g,bottom:j,width:a,height:b,centroid:l}},getTriangles:function(a){var b=
a.top,d=a.left,f=a.right;a=a.bottom;return new Two.Array([d,b,f,b,d,a,d,a,f,b,f,a])},updateCanvas:function(a){var b=a.commands,d=this.canvas,f=this.ctx,g=a._scale,h=a.stroke,j=a.linewidth*g,n=a.fill,z=a.opacity,u=a.cap,r=a.join,t=a.miter,v=a.curved,c=a.closed,w=b.length,C=w-1;d.width=Math.ceil(a.rect.width*g);d.height=Math.ceil(a.rect.height*g);a=a.rect.centroid;var D=a.x*g,G=a.y*g;f.clearRect(0,0,d.width,d.height);n&&(f.fillStyle=n);h&&(f.strokeStyle=h);j&&(f.lineWidth=j);t&&(f.miterLimit=t);r&&
(f.lineJoin=r);u&&(f.lineCap=u);_.isNumber(z)&&(f.globalAlpha=z);f.beginPath();_.each(b,function(a,d){var h=(a.x*g+D).toFixed(3),m=(a.y*g+G).toFixed(3);if(v){var j=c?l(d-1,w):Math.max(d-1,0),k=c?l(d+1,w):Math.min(d+1,C),n=b[j],k=b[k],j=(n.v.x*g+D).toFixed(3),n=(n.v.y*g+G).toFixed(3),q=(a.u.x*g+D).toFixed(3),p=(a.u.y*g+G).toFixed(3);0>=d?f.moveTo(h,m):(f.bezierCurveTo(j,n,q,p,h,m),d>=C&&c&&(j=(a.v.x*g+D).toFixed(3),n=(a.v.y*g+G).toFixed(3),q=(k.u.x*g+D).toFixed(3),p=(k.u.y*g+G).toFixed(3),h=(k.x*g+
D).toFixed(3),m=(k.y*g+G).toFixed(3),f.bezierCurveTo(j,n,q,p,h,m)))}else 0>=d?f.moveTo(h,m):f.lineTo(h,m)});c&&!v&&f.closePath();f.fill();f.stroke()},updateTexture:function(a,b){this.updateCanvas(b);b.texture&&a.deleteTexture(b.texture);a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);b.texture=a.createTexture();a.bindTexture(a.TEXTURE_2D,b.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.LINEAR);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(a,b,d){_.isObject(b.buffer)&&a.deleteBuffer(b.buffer);b.buffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.buffer);a.enableVertexAttribArray(d.position);a.bufferData(a.ARRAY_BUFFER,b.triangles,a.STATIC_DRAW);_.isObject(b.textureCoordsBuffer)&&a.deleteBuffer(b.textureCoordsBuffer);b.textureCoordsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b.textureCoordsBuffer);a.enableVertexAttribArray(d.textureCoords);
a.bufferData(a.ARRAY_BUFFER,this.uv,a.STATIC_DRAW)},program:{create:function(a,b){var d=a.createProgram();_.each(b,function(b){a.attachShader(d,b)});a.linkProgram(d);if(!a.getProgramParameter(d,a.LINK_STATUS))throw error=a.getProgramInfoLog(d),new Two.Utils.Error("unable to link program: "+error);return d}},shaders:{create:function(a,b,d){d=a.createShader(a[d]);a.shaderSource(d,b);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS))throw a=a.getShaderInfoLog(d),new Two.Utils.Error("unable to compile shader "+
d+": "+a);return d},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:"attribute vec2 a_position;\nattribute vec2 a_textureCoords;\n\nuniform mat3 u_matrix;\nuniform vec2 u_resolution;\n\nvarying vec2 v_textureCoords;\n\nvoid main() {\n   vec2 projected = (u_matrix * vec3(a_position, 1)).xy;\n   vec2 normal = projected / u_resolution;\n   vec2 clipspace = (normal * 2.0) - 1.0;\n\n   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);\n   v_textureCoords = a_textureCoords;\n}",
fragment:"precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_textureCoords;\n\nvoid main() {\n  gl_FragColor = texture2D(u_image, v_textureCoords);\n}"}};d.ctx=d.canvas.getContext("2d");var b=Two[Two.Types.webgl]=function(a){this.domElement=document.createElement("canvas");this.elements=[];this.stage=null;a=_.defaults(a||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1});a=this.ctx=this.domElement.getContext("webgl",a)||this.domElement.getContext("experimental-webgl",
a);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var b=d.shaders.create(a,d.shaders.vertex,d.shaders.types.vertex),f=d.shaders.create(a,d.shaders.fragment,d.shaders.types.fragment);this.program=d.program.create(a,[b,f]);a.useProgram(this.program);this.program.position=a.getAttribLocation(this.program,"a_position");this.program.matrix=a.getUniformLocation(this.program,"u_matrix");this.program.textureCoords=a.getAttribLocation(this.program,"a_textureCoords");
a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD);a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)};_.extend(b,{Group:g,Element:f,getStyles:function(a){var b={},f=a.id,g=a._matrix,h=a.stroke,k=a.linewidth,l=a.fill,n=a.opacity,z=a.visible,u=a.cap,r=a.join,t=a.miter,v=a.curved,c=a.closed;a=a.vertices;f&&(b.id=f);_.isObject(g)&&(b.matrix=b._matrix=g.toArray(!0),b.scale=b._scale=1);h&&(b.stroke=h);l&&(b.fill=l);_.isNumber(n)&&(b.opacity=
n);u&&(b.cap=u);r&&(b.join=r);t&&(b.miter=t);k&&(b.linewidth=k);a&&(b.vertices=j(a,v,c),b.commands=b.vertices,b.rect=d.getBoundingClientRect(b.commands,b.linewidth,b.curved),b.triangles=d.getTriangles(b.rect));b.visible=!!z;b.curved=!!v;b.closed=!!c;return b},setStyles:function(a,b,f,g,h,k){var l=!1;/matrix/.test(b)?(a[b]=f.toArray(!0),_.isNumber(g)&&(l=a.scale!==g,a.scale=g),a.updateMatrix()):/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(b)?(a[b]=f,a.rect=d.getBoundingClientRect(a.commands,
a.linewidth,a.curved),a.triangles=d.getTriangles(a.rect),d.updateBuffer(this.ctx,a,this.program),l=!0):"vertices"===b?(_.isUndefined(g)||(a.closed=g),_.isUndefined(h)||(a.curved=h),k?a.commands=j(f,a.curved,a.closed):(a.vertices=j(f,a.curved,a.closed),a.commands=a.vertices),a.rect=d.getBoundingClientRect(a.vertices,a.linewidth,a.curved),a.triangles=d.getTriangles(a.rect),d.updateBuffer(this.ctx,a,this.program),l=!0):a[b]=f;l&&a.updateTexture(this.ctx)}});_.extend(b.prototype,Backbone.Events,n.prototype,
{setSize:function(a,b){n.prototype.setSize.apply(this,arguments);this.ctx.viewport(0,0,a,b);var d=this.ctx.getUniformLocation(this.program,"u_resolution");this.ctx.uniform2f(d,a,b);return this},render:function(){if(_.isNull(this.stage))return this;this.stage.render(this.ctx,this.program);return this}})})();(function(){var n=Two.Shape=function(h){this._matrix=new Two.Matrix;var j=_.debounce(_.bind(function(){var h=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",h,this.scale)},this),0);this._rotation="rotation";Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(h){this._rotation=h;j()}});this._scale="scale";Object.defineProperty(this,"scale",{get:function(){return this._scale},
set:function(h){this._scale=h;j()}});this.translation=new Two.Vector;this.rotation=0;this.scale=1;this.translation.bind(Two.Events.change,j);if(h)return this;n.MakeGetterSetter(this,n.Properties);this.fill="#fff";this.stroke="#000";this.opacity=this.linewidth=1;this.visible=!0;this.miter=this.join=this.cap="round"};_.extend(n,{Properties:"fill stroke linewidth opacity visible cap join miter".split(" "),MakeGetterSetter:function(h,j){_.isArray(j)||(j=[j]);_.each(j,function(j){var g="_"+j;Object.defineProperty(h,
j,{get:function(){return this[g]},set:function(f){this[g]=f;this.trigger(Two.Events.change,this.id,j,f,this)}})})}});_.extend(n.prototype,Backbone.Events,{addTo:function(h){h.add(this);return this},noFill:function(){this.fill="none";return this},noStroke:function(){this.stroke="none";return this},clone:function(){var h=new n;h.translation.copy(this.translation);_.each(n.Properties,function(j){h[j]=this[j]},this);return this}})})();(function(){var n=Two.Group=function(){Two.Shape.call(this,!0);delete this.stroke;delete this.fill;delete this.linewidth;delete this.opacity;delete this.cap;delete this.join;delete this.miter;n.MakeGetterSetter(this,Two.Shape.Properties);this.children={}};_.extend(n,{MakeGetterSetter:function(h,j){_.isArray(j)||(j=[j]);_.each(j,function(j){var g="_"+j;Object.defineProperty(h,j,{get:function(){return this[g]},set:function(f){this[g]=f;_.each(this.children,function(d){d[j]=f})}})})}});_.extend(n.prototype,
Two.Shape.prototype,{add:function(h){var j=h,l=this.children,g=this.parent,f=[];_.isArray(h)||(j=_.toArray(arguments));var d=_.bind(function(b,a,d,f,g,h){this.trigger(Two.Events.change,b,a,d,f,g,h)},this);_.each(j,function(b){var a=b.id,e=b.parent;_.isUndefined(a)&&(g.add(b),a=b.id);_.isUndefined(l[a])&&(e&&delete e.children[a],l[a]=b,b.parent=this,b.unbind(Two.Events.change).bind(Two.Events.change,d),f.push(a))},this);0<f.length&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,f);
return this.center()},center:function(){var h=this.getBoundingClientRect();h.centroid={x:h.left+h.width/2,y:h.top+h.height/2};_.each(this.children,function(j){j.translation.subSelf(h.centroid)});this.translation.copy(h.centroid);return this},remove:function(h){var j=h,l=this.children,g=this.parent,f=[];if(0>=arguments.length&&g)return g.remove(this),this;_.isArray(h)||(j=_.toArray(arguments));_.each(j,function(d){var b=d.id;b in l&&(delete l[b],d.unbind(Two.Events.change),f.push(b))});0<f.length&&
this.trigger(Two.Events.change,this.id,Two.Properties.demotion,f);return this.center()},getBoundingClientRect:function(){var h=Infinity,j=-Infinity,l=Infinity,g=-Infinity;_.each(this.children,function(b){b=b.getBoundingClientRect();l=Math.min(b.top,l);h=Math.min(b.left,h);j=Math.max(b.right,j);g=Math.max(b.bottom,g)},this);var f=this._matrix.multiply(h,l,1),d=this._matrix.multiply(j,g,1);return{top:f.y,left:f.x,right:d.x,bottom:d.y,width:d.x-f.x,height:d.y-f.y}},noFill:function(){_.each(this.children,
function(h){h.noFill()});return this},noStroke:function(){_.each(this.children,function(h){h.noStroke()});return this}})})();(function(){var n=Math.min,h=Math.max,j=Math.round,l=Two.Polygon=function(g,f,d){Two.Shape.call(this);f=!!f;d=!!d;var b=0,a=1,e=!1,m=g.slice(0),l=_.debounce(_.bind(function(){var g,h;if(e){g=this.vertices.length;g-=1;h=j(b*g);g=j(a*g);for(m.length=0;h<g+1;h++){var l=this.vertices[h];m.push(new Two.Vector(l.x,l.y))}}this.trigger(Two.Events.change,this.id,"vertices",m,f,d,e);e=!1},this),0);Object.defineProperty(this,"closed",{get:function(){return f},set:function(a){f=!!a;l()}});Object.defineProperty(this,
"curved",{get:function(){return d},set:function(a){d=!!a;l()}});Object.defineProperty(this,"beginning",{get:function(){return b},set:function(a){b=n(h(a,0),1);e=!0;l()}});Object.defineProperty(this,"ending",{get:function(){return a},set:function(b){a=n(h(b,0),1);e=!0;l()}});this.vertices=g.slice(0);_.each(this.vertices,function(a){a.bind(Two.Events.change,l)},this);l()};_.extend(l,{});_.extend(l.prototype,Two.Shape.prototype,{clone:function(){var g=_.map(this.vertices,function(d){return new Two.Vector(d.x,
d.y)}),f=new l(g,this.closed,this.curved);_.each(Two.Shape.Properties,function(d){f[d]=this[d]},this);f.translation.copy(this.translation);f.rotation=this.rotation;f.scale=this.scale;return f},center:function(){var g=this.getBoundingClientRect();g.centroid={x:g.left+g.width/2,y:g.top+g.height/2};_.each(this.vertices,function(f){f.subSelf(g.centroid)});this.translation.addSelf(g.centroid);return this},remove:function(){if(!this.parent)return this;this.parent.remove(this);return this},getBoundingClientRect:function(){var g=
this.linewidth,f=Infinity,d=-Infinity,b=Infinity,a=-Infinity;_.each(this.vertices,function(e){var g=e.x;e=e.y;b=Math.min(e,b);f=Math.min(g,f);d=Math.max(g,d);a=Math.max(e,a)});var b=b-g,f=f-g,d=d+g,a=a+g,g=this._matrix.multiply(f,b,1),e=this._matrix.multiply(d,a,1);return{top:g.y,left:g.x,right:e.x,bottom:e.y,width:e.x-g.x,height:e.y-g.y}}})})();
