(function(){function t(e,n,r){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return e===n;if(e._chain&&(e=e._wrapped),n._chain&&(n=n._wrapped),e.isEqual&&A.isFunction(e.isEqual))return e.isEqual(n);if(n.isEqual&&A.isFunction(n.isEqual))return n.isEqual(e);var i=c.call(e);if(i!=c.call(n))return!1;switch(i){case"[object String]":return e==n+"";case"[object Number]":return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object RegExp]":return e.source==n.source&&e.global==n.global&&e.multiline==n.multiline&&e.ignoreCase==n.ignoreCase}if("object"!=typeof e||"object"!=typeof n)return!1;for(var a=r.length;a--;)if(r[a]==e)return!0;r.push(e);var o=0,s=!0;if("[object Array]"==i){if(o=e.length,s=o==n.length)for(;o--&&(s=o in e==o in n&&t(e[o],n[o],r)););}else{if("constructor"in e!="constructor"in n||e.constructor!=n.constructor)return!1;for(var u in e)if(A.has(e,u)&&(o++,!(s=A.has(n,u)&&t(e[u],n[u],r))))break;if(s){for(u in n)if(A.has(n,u)&&!o--)break;s=!o}}return r.pop(),s}var e=this,n=e._,r={},i=Array.prototype,a=Object.prototype,o=Function.prototype,s=i.slice,u=i.unshift,c=a.toString,l=a.hasOwnProperty,h=i.forEach,f=i.map,d=i.reduce,p=i.reduceRight,m=i.filter,v=i.every,g=i.some,y=i.indexOf,x=i.lastIndexOf,_=Array.isArray,b=Object.keys,w=o.bind,A=function(t){return new j(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=A),exports._=A):e._=A,A.VERSION="1.3.3";var T=A.each=A.forEach=function(t,e,n){if(null!=t)if(h&&t.forEach===h)t.forEach(e,n);else if(t.length===+t.length){for(var i=0,a=t.length;a>i;i++)if(i in t&&e.call(n,t[i],i,t)===r)return}else for(var o in t)if(A.has(t,o)&&e.call(n,t[o],o,t)===r)return};A.map=A.collect=function(t,e,n){var r=[];return null==t?r:f&&t.map===f?t.map(e,n):(T(t,function(t,i,a){r[r.length]=e.call(n,t,i,a)}),t.length===+t.length&&(r.length=t.length),r)},A.reduce=A.foldl=A.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),d&&t.reduce===d)return r&&(e=A.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(T(t,function(t,a,o){i?n=e.call(r,n,t,a,o):(n=t,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},A.reduceRight=A.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return r&&(e=A.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var a=A.toArray(t).reverse();return r&&!i&&(e=A.bind(e,r)),i?A.reduce(a,e,n,r):A.reduce(a,e)},A.find=A.detect=function(t,e,n){var r;return F(t,function(t,i,a){return e.call(n,t,i,a)?(r=t,!0):void 0}),r},A.filter=A.select=function(t,e,n){var r=[];return null==t?r:m&&t.filter===m?t.filter(e,n):(T(t,function(t,i,a){e.call(n,t,i,a)&&(r[r.length]=t)}),r)},A.reject=function(t,e,n){var r=[];return null==t?r:(T(t,function(t,i,a){e.call(n,t,i,a)||(r[r.length]=t)}),r)},A.every=A.all=function(t,e,n){var i=!0;return null==t?i:v&&t.every===v?t.every(e,n):(T(t,function(t,a,o){return(i=i&&e.call(n,t,a,o))?void 0:r}),!!i)};var F=A.some=A.any=function(t,e,n){e||(e=A.identity);var i=!1;return null==t?i:g&&t.some===g?t.some(e,n):(T(t,function(t,a,o){return i||(i=e.call(n,t,a,o))?r:void 0}),!!i)};A.include=A.contains=function(t,e){var n=!1;return null==t?n:y&&t.indexOf===y?-1!=t.indexOf(e):n=F(t,function(t){return t===e})},A.invoke=function(t,e){var n=s.call(arguments,2);return A.map(t,function(t){return(A.isFunction(e)?e||t:t[e]).apply(t,n)})},A.pluck=function(t,e){return A.map(t,function(t){return t[e]})},A.max=function(t,e,n){if(!e&&A.isArray(t)&&t[0]===+t[0])return Math.max.apply(Math,t);if(!e&&A.isEmpty(t))return-1/0;var r={computed:-1/0};return T(t,function(t,i,a){var o=e?e.call(n,t,i,a):t;o>=r.computed&&(r={value:t,computed:o})}),r.value},A.min=function(t,e,n){if(!e&&A.isArray(t)&&t[0]===+t[0])return Math.min.apply(Math,t);if(!e&&A.isEmpty(t))return 1/0;var r={computed:1/0};return T(t,function(t,i,a){var o=e?e.call(n,t,i,a):t;r.computed>o&&(r={value:t,computed:o})}),r.value},A.shuffle=function(t){var e,n=[];return T(t,function(t,r){e=Math.floor(Math.random()*(r+1)),n[r]=n[e],n[e]=t}),n},A.sortBy=function(t,e,n){var r=A.isFunction(e)?e:function(t){return t[e]};return A.pluck(A.map(t,function(t,e,i){return{value:t,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;return void 0===n?1:void 0===r?-1:r>n?-1:n>r?1:0}),"value")},A.groupBy=function(t,e){var n={},r=A.isFunction(e)?e:function(t){return t[e]};return T(t,function(t,e){var i=r(t,e);(n[i]||(n[i]=[])).push(t)}),n},A.sortedIndex=function(t,e,n){n||(n=A.identity);for(var r=0,i=t.length;i>r;){var a=r+i>>1;n(t[a])<n(e)?r=a+1:i=a}return r},A.toArray=function(t){return t?A.isArray(t)?s.call(t):A.isArguments(t)?s.call(t):t.toArray&&A.isFunction(t.toArray)?t.toArray():A.values(t):[]},A.size=function(t){return A.isArray(t)?t.length:A.keys(t).length},A.first=A.head=A.take=function(t,e,n){return null==e||n?t[0]:s.call(t,0,e)},A.initial=function(t,e,n){return s.call(t,0,t.length-(null==e||n?1:e))},A.last=function(t,e,n){return null==e||n?t[t.length-1]:s.call(t,Math.max(t.length-e,0))},A.rest=A.tail=function(t,e,n){return s.call(t,null==e||n?1:e)},A.compact=function(t){return A.filter(t,function(t){return!!t})},A.flatten=function(t,e){return A.reduce(t,function(t,n){return A.isArray(n)?t.concat(e?n:A.flatten(n)):(t[t.length]=n,t)},[])},A.without=function(t){return A.difference(t,s.call(arguments,1))},A.uniq=A.unique=function(t,e,n){var r=n?A.map(t,n):t,i=[];return 3>t.length&&(e=!0),A.reduce(r,function(n,r,a){return(e?A.last(n)===r&&n.length:A.include(n,r))||(n.push(r),i.push(t[a])),n},[]),i},A.union=function(){return A.uniq(A.flatten(arguments,!0))},A.intersection=A.intersect=function(t){var e=s.call(arguments,1);return A.filter(A.uniq(t),function(t){return A.every(e,function(e){return A.indexOf(e,t)>=0})})},A.difference=function(t){var e=A.flatten(s.call(arguments,1),!0);return A.filter(t,function(t){return!A.include(e,t)})},A.zip=function(){for(var t=s.call(arguments),e=A.max(A.pluck(t,"length")),n=Array(e),r=0;e>r;r++)n[r]=A.pluck(t,""+r);return n},A.indexOf=function(t,e,n){if(null==t)return-1;var r,i;if(n)return r=A.sortedIndex(t,e),t[r]===e?r:-1;if(y&&t.indexOf===y)return t.indexOf(e);for(r=0,i=t.length;i>r;r++)if(r in t&&t[r]===e)return r;return-1},A.lastIndexOf=function(t,e){if(null==t)return-1;if(x&&t.lastIndexOf===x)return t.lastIndexOf(e);for(var n=t.length;n--;)if(n in t&&t[n]===e)return n;return-1},A.range=function(t,e,n){1>=arguments.length&&(e=t||0,t=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=0,a=Array(r);r>i;)a[i++]=t,t+=n;return a};var E=function(){};A.bind=function(t,e){var n,r;if(t.bind===w&&w)return w.apply(t,s.call(arguments,1));if(!A.isFunction(t))throw new TypeError;return r=s.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,r.concat(s.call(arguments)));E.prototype=t.prototype;var i=new E,a=t.apply(i,r.concat(s.call(arguments)));return Object(a)===a?a:i}},A.bindAll=function(t){var e=s.call(arguments,1);return 0==e.length&&(e=A.functions(t)),T(e,function(e){t[e]=A.bind(t[e],t)}),t},A.memoize=function(t,e){var n={};return e||(e=A.identity),function(){var r=e.apply(this,arguments);return A.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},A.delay=function(t,e){var n=s.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},A.defer=function(t){return A.delay.apply(A,[t,1].concat(s.call(arguments,1)))},A.throttle=function(t,e){var n,r,i,a,o,s,u=A.debounce(function(){o=a=!1},e);return function(){n=this,r=arguments;var c=function(){i=null,o&&t.apply(n,r),u()};return i||(i=setTimeout(c,e)),a?o=!0:s=t.apply(n,r),u(),a=!0,s}},A.debounce=function(t,e,n){var r;return function(){var i=this,a=arguments,o=function(){r=null,n||t.apply(i,a)};n&&!r&&t.apply(i,a),clearTimeout(r),r=setTimeout(o,e)}},A.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}},A.wrap=function(t,e){return function(){var n=[t].concat(s.call(arguments,0));return e.apply(this,n)}},A.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},A.after=function(t,e){return 0>=t?e():function(){return 1>--t?e.apply(this,arguments):void 0}},A.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)A.has(t,n)&&(e[e.length]=n);return e},A.values=function(t){return A.map(t,A.identity)},A.functions=A.methods=function(t){var e=[];for(var n in t)A.isFunction(t[n])&&e.push(n);return e.sort()},A.extend=function(t){return T(s.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t},A.pick=function(t){var e={};return T(A.flatten(s.call(arguments,1)),function(n){n in t&&(e[n]=t[n])}),e},A.defaults=function(t){return T(s.call(arguments,1),function(e){for(var n in e)null==t[n]&&(t[n]=e[n])}),t},A.clone=function(t){return A.isObject(t)?A.isArray(t)?t.slice():A.extend({},t):t},A.tap=function(t,e){return e(t),t},A.isEqual=function(e,n){return t(e,n,[])},A.isEmpty=function(t){if(null==t)return!0;if(A.isArray(t)||A.isString(t))return 0===t.length;for(var e in t)if(A.has(t,e))return!1;return!0},A.isElement=function(t){return!(!t||1!=t.nodeType)},A.isArray=_||function(t){return"[object Array]"==c.call(t)},A.isObject=function(t){return t===Object(t)},A.isArguments=function(t){return"[object Arguments]"==c.call(t)},A.isArguments(arguments)||(A.isArguments=function(t){return!(!t||!A.has(t,"callee"))}),A.isFunction=function(t){return"[object Function]"==c.call(t)},A.isString=function(t){return"[object String]"==c.call(t)},A.isNumber=function(t){return"[object Number]"==c.call(t)},A.isFinite=function(t){return A.isNumber(t)&&isFinite(t)},A.isNaN=function(t){return t!==t},A.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},A.isDate=function(t){return"[object Date]"==c.call(t)},A.isRegExp=function(t){return"[object RegExp]"==c.call(t)},A.isNull=function(t){return null===t},A.isUndefined=function(t){return void 0===t},A.has=function(t,e){return l.call(t,e)},A.noConflict=function(){return e._=n,this},A.identity=function(t){return t},A.times=function(t,e,n){for(var r=0;t>r;r++)e.call(n,r)},A.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},A.result=function(t,e){if(null==t)return null;var n=t[e];return A.isFunction(n)?n.call(t):n},A.mixin=function(t){T(A.functions(t),function(e){V(e,A[e]=t[e])})};var k=0;A.uniqueId=function(t){var e=k++;return t?t+e:e},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/.^/,B={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var C in B)B[B[C]]=C;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,R=/\\(\\|'|r|n|t|u2028|u2029)/g,U=function(t){return t.replace(R,function(t,e){return B[e]})};A.template=function(t,e,n){n=A.defaults(n||{},A.templateSettings);var r="__p+='"+t.replace(M,function(t){return"\\"+B[t]}).replace(n.escape||S,function(t,e){return"'+\n_.escape("+U(e)+")+\n'"}).replace(n.interpolate||S,function(t,e){return"'+\n("+U(e)+")+\n'"}).replace(n.evaluate||S,function(t,e){return"';\n"+U(e)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=Function(n.variable||"obj","_",r);if(e)return i(e,A);var a=function(t){return i.call(this,t,A)};return a.source="function("+(n.variable||"obj")+"){\n"+r+"}",a},A.chain=function(t){return A(t).chain()};var j=function(t){this._wrapped=t};A.prototype=j.prototype;var P=function(t,e){return e?A(t).chain():t},V=function(t,e){j.prototype[t]=function(){var t=s.call(arguments);return u.call(t,this._wrapped),P(e.apply(A,t),this._chain)}};A.mixin(A),T(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];j.prototype[t]=function(){var n=this._wrapped;e.apply(n,arguments);var r=n.length;return"shift"!=t&&"splice"!=t||0!==r||delete n[0],P(n,this._chain)}}),T(["concat","join","slice"],function(t){var e=i[t];j.prototype[t]=function(){return P(e.apply(this._wrapped,arguments),this._chain)}}),j.prototype.chain=function(){return this._chain=!0,this},j.prototype.value=function(){return this._wrapped}}).call(this);var Backbone=Backbone||{};(function(){var t=[],e=t.slice,n=/\s+/,r=function(t,e,r,i){if(!r)return!0;if("object"==typeof r)for(var a in r)t[e].apply(t,[a,r[a]].concat(i));else{if(!n.test(r))return!0;for(var o=r.split(n),s=0,u=o.length;u>s;s++)t[e].apply(t,[o[s]].concat(i))}},i=function(t,e,n){var r,i=-1,a=e.length;switch(n.length){case 0:for(;a>++i;)(r=e[i]).callback.call(r.ctx);return;case 1:for(;a>++i;)(r=e[i]).callback.call(r.ctx,n[0]);return;case 2:for(;a>++i;)(r=e[i]).callback.call(r.ctx,n[0],n[1]);return;case 3:for(;a>++i;)(r=e[i]).callback.call(r.ctx,n[0],n[1],n[2]);return;default:for(;a>++i;)(r=e[i]).callback.apply(r.ctx,n)}},a=Backbone.Events={on:function(t,e,n){if(!r(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!r(this,"once",t,[e,n])||!e)return this;var i=this,a=_.once(function(){i.off(t,a),e.apply(this,arguments)});return a._callback=e,this.on(t,a,n),this},off:function(t,e,n){var i,a,o,s,u,c,l,h;if(!this._events||!r(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:_.keys(this._events),u=0,c=s.length;c>u;u++)if(t=s[u],i=this._events[t]){if(o=[],e||n)for(l=0,h=i.length;h>l;l++)a=i[l],(e&&e!==(a.callback._callback||a.callback)||n&&n!==a.context)&&o.push(a);this._events[t]=o}return this},trigger:function(t){if(!this._events)return this;var n=e.call(arguments,1);if(!r(this,"trigger",t,n))return this;var a=this._events[t],o=this._events.all;return a&&i(this,a,n),o&&i(this,o,arguments),this},listenTo:function(t,e,n){var r=this._listeners||(this._listeners={}),i=t._listenerId||(t._listenerId=_.uniqueId("l"));return r[i]=t,t.on(e,n||this,this),this},stopListening:function(t,e,n){var r=this._listeners;if(r){if(t)t.off(e,n,this),e||n||delete r[t._listenerId];else{for(var i in r)r[i].off(null,null,this);this._listeners={}}return this}}};a.bind=a.on,a.unbind=a.off})(),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),r=Math.max(0,16-(n-t)),i=window.setTimeout(function(){e(n+r)},r);return t=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){function t(){var t=document.body.getBoundingClientRect(),e=this.width=t.width,n=this.height=t.height;this.renderer.setSize(e,n),this.trigger(d.Events.resize,e,n)}var e=this,n=e.Two||{},r=Math.sin,i=Math.cos,a=Math.atan2,o=Math.sqrt,s=(Math.round,Math.abs),u=Math.PI,c=2*u,l=u/2,h=Math.pow,f={hasEventListeners:_.isFunction(e.addEventListener),bind:function(t,e,n,r){return this.hasEventListeners?t.addEventListener(e,n,!!r):t.attachEvent("on"+e,n),this},unbind:function(t,e,n,r){return this.hasEventListeners?t.removeEventListeners(e,n,!!r):t.detachEvent("on"+e,n),this}},d=e.Two=function(e){var n=_.defaults(e||{},{fullscreen:!1,width:640,height:480,type:d.Types.svg,autostart:!1});if(this.type=n.type,this.renderer=new d[this.type](this),d.Utils.setPlaying.call(this,n.autostart),this.frameCount=0,n.fullscreen){var r=_.bind(t,this);_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),f.bind(window,"resize",r),r()}else this.renderer.setSize(n.width,n.height),this.width=n.width,this.height=n.height;this.scene=new d.Group,this.renderer.add(this.scene),d.Instances.push(this)};_.extend(d,{Array:e.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change"},Resolution:8,Instances:[],noConflict:function(){return e.Two=n,this},Utils:{Curve:{CollinearityEpsilon:h(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01}},setPlaying:function(t){_.defer(_.bind(function(){this.playing=!!t},this))},applySvgAttributes:function(t,e){return e.cap="butt",e.join="bevel",_.each(t.attributes,function(t){var n=t.nodeName;switch(n){case"transform":break;case"visibility":e.visible=!!t.nodeValue;break;case"stroke-linecap":e.cap=t.nodeValue;break;case"stroke-linejoin":e.join=t.nodeValue;break;case"stroke-miterlimit":e.miter=t.nodeValue;break;case"stroke-width":e.linewidth=parseFloat(t.nodeValue);break;case"stroke-opacity":case"fill-opacity":e.opacity=t.nodeValue;break;case"fill":e.fill=t.nodeValue;break;case"stroke":e.stroke=t.nodeValue}}),e},read:{svg:function(){return d.Utils.read.g.apply(this,arguments)},g:function(t){var e=new d.Group;return this.add(e),_.each(t.childNodes,function(t){if(t.localName){var n=t.localName.toLowerCase();n in d.Utils.read&&(t=d.Utils.read[n].call(this,t),e.add(t))}},this),d.Utils.applySvgAttributes(t,e)},polygon:function(t,e){var n=t.points,r=_.map(_.range(n.numberOfItems),function(t){var e=n.getItem(t);return new d.Vector(e.x,e.y)}),i=new d.Polygon(r,!e).noStroke();return d.Utils.applySvgAttributes(t,i)},polyline:function(t){return d.Utils.read.polygon(t,!0)},path:function(t){var e=t.getAttribute("d"),n=_.flatten(_.map(_.compact(e.split(/M/g)),function(t){var e=_.map(_.compact(t.split(/m/g)),function(t,e){return 0>=e?t:"m"+t});return e[0]="M"+e[0],e}));n.length;var r=new d.Vector,i=new d.Vector,a=_.map(n,function(e){var n,a=!1,o=!1,s=_.flatten(_.map(e.match(/[a-z][^a-z]*/gi),function(t){var e,s,u,c=t[0],l=c.toLowerCase();n=t.slice(1).trim().split(/[\s,]+|(?=[+\-])/),a=c===l;var h,f,p,m,v,g,y,x,_;switch(l){case"z":o=!0;break;case"m":case"l":s=parseFloat(n[0]),u=parseFloat(n[1]),e=new d.Vector(s,u),a&&e.addSelf(r),r.copy(e);break;case"h":case"v":var b="h"===l?"x":"y",w="x"===b?"y":"x";e=new d.Vector,e[b]=parseFloat(n[0]),e[w]=r[w],a&&(e[b]+=r[b]),r.copy(e);break;case"s":case"c":h=r.x,f=r.y,"c"===l?(p=parseFloat(n[0]),m=parseFloat(n[1]),v=parseFloat(n[2]),g=parseFloat(n[3]),y=parseFloat(n[4]),x=parseFloat(n[5])):(_=(new d.Vector).copy(r).subSelf(i),p=parseFloat(_.x),m=parseFloat(_.y),v=parseFloat(n[0]),g=parseFloat(n[1]),y=parseFloat(n[2]),x=parseFloat(n[3])),a&&(p+=h,m+=f,v+=h,g+=f,y+=h,x+=f),e=d.Utils.subdivide(h,f,p,m,v,g,y,x),r.set(y,x),i.set(v,g);break;case"t":case"q":h=r.x,f=r.y,i.isZero()?(p=h,m=f):(p=i.x,f=i.y),"q"===l?(v=parseFloat(n[0]),g=parseFloat(n[1]),y=parseFloat(n[1]),x=parseFloat(n[2])):(_=(new d.Vector).copy(r).subSelf(i),v=parseFloat(_.x),g=parseFloat(_.y),y=parseFloat(n[0]),x=parseFloat(n[1])),a&&(p+=h,m+=f,v+=h,g+=f,y+=h,x+=f),e=d.Utils.subdivide(h,f,p,m,v,g,y,x),r.set(y,x),i.set(v,g);break;case"a":throw new d.Utils.Error("not yet able to interpret Elliptical Arcs.")}return e}));_.isUndefined(s[s.length-1])&&s.pop();var u=new d.Polygon(s,o).noStroke();return d.Utils.applySvgAttributes(t,u)});return a},circle:function(t){var e=parseFloat(t.getAttribute("cx")),n=parseFloat(t.getAttribute("cy")),a=parseFloat(t.getAttribute("r")),o=d.Resolution,s=_.map(_.range(o),function(t){var e=t/o,n=e*c,s=a*i(n),u=a*r(n);return new d.Vector(s,u)},this),u=new d.Polygon(s,!0,!0).noStroke();return u.translation.set(e,n),d.Utils.applySvgAttributes(t,u)},ellipse:function(t){var e=parseFloat(t.getAttribute("cx")),n=parseFloat(t.getAttribute("cy")),a=parseFloat(t.getAttribute("rx")),o=parseFloat(t.getAttribute("ry")),s=d.Resolution,u=_.map(_.range(s),function(t){var e=t/s,n=e*c,u=a*i(n),l=o*r(n);return new d.Vector(u,l)},this),l=new d.Polygon(u,!0,!0).noStroke();return l.translation.set(e,n),d.Utils.applySvgAttributes(t,l)},rect:function(t){var e=parseFloat(t.getAttribute("x")),n=parseFloat(t.getAttribute("y")),r=parseFloat(t.getAttribute("width")),i=parseFloat(t.getAttribute("height")),a=r/2,o=i/2,s=[new d.Vector(a,o),new d.Vector(-a,o),new d.Vector(-a,-o),new d.Vector(a,-o)],u=new d.Polygon(s,!0).noStroke();return u.translation.set(e+a,n+o),d.Utils.applySvgAttributes(t,u)},line:function(t){var e=parseFloat(t.getAttribute("x1")),n=parseFloat(t.getAttribute("y1")),r=parseFloat(t.getAttribute("x2")),i=parseFloat(t.getAttribute("y2")),a=r-e,o=i-n,s=a/2,u=o/2,c=[new d.Vector(-s,-u),new d.Vector(s,u)],l=new d.Polygon(c).noFill();return l.translation.set(e+s,n+u),d.Utils.applySvgAttributes(t,l)}},subdivide:function(t,e,n,r,i,o,l,h,f){var p,m,v=d.Utils.Curve.CollinearityEpsilon,g=d.Utils.Curve.RecursionLimit,y=d.Utils.Curve.CuspLimit,x=d.Utils.Curve.Tolerance;if(f=f||0,f>g)return[];var _=(t+n)/2,b=(e+r)/2,w=(n+i)/2,A=(r+o)/2,T=(i+l)/2,F=(o+h)/2,E=(_+w)/2,k=(b+A)/2,S=(w+T)/2,B=(A+F)/2,C=(E+S)/2,M=(k+B)/2,R=l-t,U=h-e,j=s((n-l)*U-(r-h)*R),P=s((i-l)*U-(o-h)*R);if(f>0){if(j>v&&P>v&&x.distance*(R*R+U*U)>=(j+P)*(j+P)){if(x.angle<x.epsilon)return[new d.Vector(C,M)];var V=a(o-r,i-n);if(p=s(V-a(r-e,n-t)),m=s(a(h-o,l-i)-V),p>=u&&(p=c-p),m>=u&&(m=c-m),x.angle>p+m)return[new d.Vector(C,M)];if(0!==y){if(p>y)return[new d.Vector(n,r)];if(m>y)return[new d.Vector(i,o)]}}}else if(j>v)if(x.distance*(R*R+U*U)>=j*j){if(x.angle<x.epsilon)return[new d.Vector(C,M)];if(p=s(a(o-r,i-n)-a(r-e,n-t)),p>=u&&(p=c-p),x.angle>p)return[new d.Vector(n,r),new d.Vector(i,o)];if(0!==y&&p>y)return[new d.Vector(n,r)]}else if(P>v){if(x.distance*(R*R+U*U)>=P*P){if(x.angle<x.epsilon)return[new d.Vector(C,M)];if(p=s(a(h-o,l-i)-a(o-r,i-n)),p>=u&&(p=c-p),x.angle>p)return[new d.Vector(n,r),new d.Vector(i,o)];if(0!==y&&p>y)return[new d.Vector2(i,o)]}}else if(R=C-(t+l)/2,U=M-(e+h)/2,x.distance>=R*R+U*U)return[new d.Vector(C,M)];return d.Utils.subdivide(t,e,_,b,E,k,C,M,f+1).concat(d.Utils.subdivide(C,M,S,B,T,F,l,h,f+1))},getCurveFromPoints:function(t,e){for(var n=[],r=t.length,i=r-1,a=0;r>a;a++){var o=t[a],s={x:o.x,y:o.y};n.push(s);var u=e?y(a-1,r):Math.max(a-1,0),c=e?y(a+1,r):Math.min(a+1,i),l=t[u],h=s,f=t[c];g(l,h,f),h.u.x||h.u.y||(h.u.x=h.x,h.u.y=h.y),h.v.x||h.v.y||(h.v.x=h.x,h.v.y=h.y)}return n},getControlPoints:function(t,e,n){var a,o,s=v(t,e),c=v(n,e),h=p(t,e),f=p(n,e),d=(s+c)/2;return 1e-4>h||1e-4>f?(e.u={x:e.x,y:e.y},e.v={x:e.x,y:e.y},e):(h*=.33,f*=.33,s>c?d+=l:d-=l,a={x:e.x+i(d)*h,y:e.y+r(d)*h},d-=u,o={x:e.x+i(d)*f,y:e.y+r(d)*f},e.u=a,e.v=o,e)},angleBetween:function(t,e){var n=t.x-e.x,r=t.y-e.y;return a(r,n)},distanceBetweenSquared:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},distanceBetween:function(t,e){return o(m(t,e))},mod:function(t,e){for(;0>t;)t+=e;return t%e},Error:function(t){this.name="two.js",this.message=t}}}),d.Utils.Error.prototype=Error(),d.Utils.Error.prototype.constructor=d.Utils.Error;var p=d.Utils.distanceBetween,m=d.Utils.distanceBetweenSquared,v=d.Utils.angleBetween,g=d.Utils.getControlPoints,y=(d.Utils.getCurveFromPoints,d.Utils.solveSegmentIntersection,d.Utils.decoupleShapes,d.Utils.mod);_.extend(d.prototype,Backbone.Events,{appendTo:function(t){return t.appendChild(this.renderer.domElement),this},play:function(){return d.Utils.setPlaying.call(this,!0),this.trigger(d.Events.play)},pause:function(){return this.playing=!1,this.trigger(d.Events.pause)},update:function(){this.frameCount++;var t=this.width,e=this.height,n=this.renderer;return(t!==n.width||e!==n.height)&&n.setSize(t,e),this.trigger(d.Events.update,this.frameCount),this.render()},render:function(){return this.renderer.render(),this.trigger(d.Events.render,this.frameCount)},add:function(t){var e=t;return _.isArray(t)||(e=_.toArray(arguments)),this.scene.add(e),this},makeLine:function(t,e,n,r){var i=n-t,a=r-e,o=i/2,s=a/2,u=[new d.Vector(-o,-s),new d.Vector(o,s)],c=new d.Polygon(u).noFill();return c.translation.set(t+o,e+s),this.scene.add(c),c},makeRectangle:function(t,e,n,r){var i=n/2,a=r/2,o=[new d.Vector(i,a),new d.Vector(-i,a),new d.Vector(-i,-a),new d.Vector(i,-a)],s=new d.Polygon(o,!0);return s.translation.set(t,e),this.scene.add(s),s},makeCircle:function(t,e,n){return this.makeEllipse(t,e,n,n)},makeEllipse:function(t,e,n,a){var o=d.Resolution,s=_.map(_.range(o),function(t){var e=t/o,s=e*c,u=n*i(s),l=a*r(s);return new d.Vector(u,l)},this),u=new d.Polygon(s,!0,!0);return u.translation.set(t,e),this.scene.add(u),u},makeCurve:function(t){var e=arguments.length,n=t;if(!_.isArray(t)){n=[];for(var r=0;e>r;r+=2){var i=arguments[r];if(!_.isNumber(i))break;var a=arguments[r+1];n.push(new d.Vector(i,a))}}var o=arguments[e-1],s=new d.Polygon(n,!(_.isBoolean(o)?o:void 0),!0),u=s.getBoundingClientRect(),c=u.left+u.width/2,l=u.top+u.height/2;return _.each(s.vertices,function(t){t.x-=c,t.y-=l}),s.translation.set(c,l),this.scene.add(s),s},makePolygon:function(t){var e=arguments.length,n=t;if(!_.isArray(t)){n=[];for(var r=0;e>r;r+=2){var i=arguments[r];if(!_.isNumber(i))break;var a=arguments[r+1];n.push(new d.Vector(i,a))}}var o=arguments[e-1],s=new d.Polygon(n,!(_.isBoolean(o)?o:void 0));return s.center(),this.scene.add(s),s},makeGroup:function(t){var e=t;_.isArray(t)||(e=_.toArray(arguments));var n=new d.Group;return this.scene.add(n),n.add(e),n},interpret:function(t){var e=t.tagName.toLowerCase();if(!(e in d.Utils.read))return null;var n=d.Utils.read[e].call(this,t);return this.add(n),n}}),function(){_.each(d.Instances,function(t){t.playing&&t.update()}),requestAnimationFrame(arguments.callee)}()}(),function(){var t=Two.Vector=function(t,e){t=t||0,e=e||0,Object.defineProperty(this,"x",{get:function(){return t},set:function(e){t=e,this.trigger("change","x")}}),Object.defineProperty(this,"y",{get:function(){return e},set:function(t){e=t,this.trigger("change","y")}})};_.extend(t,{}),_.extend(t.prototype,Backbone.Events,{set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new t(this.x,this.y)},add:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return t?(this.x/=t,this.y/=t):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},setLength:function(t){return this.normalize().multiplyScalar(t)},equals:function(t){return 1e-4>this.distanceTo(t)},lerp:function(t,e){var n=(t.x-this.x)*e+this.x,r=(t.y-this.y)*e+this.y;return this.set(n,r)},isZero:function(){return 1e-4>this.length()}})}(),function(){var t=(_.range(6),Math.cos),e=Math.sin,n=Math.tan,r=Two.Matrix=function(t){this.elements=new Two.Array(9);var e=t;_.isArray(e)||(e=_.toArray(arguments)),this.identity().set(e)};_.extend(r,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(t,e){if(3>=e.length){var n,r,i,a=e[0]||0,o=e[1]||0,s=e[2]||0,u=t;return n=u[0]*a+u[1]*o+u[2]*s,r=u[3]*a+u[4]*o+u[5]*s,i=u[6]*a+u[7]*o+u[8]*s,{x:n,y:r,z:i}}var c=t[0],l=t[1],h=t[2],f=t[3],d=t[4],p=t[5],m=t[6],v=t[7],g=t[8],y=e[0],x=e[1],_=e[2],b=e[3],w=e[4],A=e[5],T=e[6],F=e[7],E=e[8];return[c*y+l*b+h*T,c*x+l*w+h*F,c*_+l*A+h*E,f*y+d*b+p*T,f*x+d*w+p*F,f*_+d*A+p*E,m*y+v*b+g*T,m*x+v*w+g*F,m*_+v*A+g*E]}}),_.extend(r.prototype,{set:function(t){var e=t;return arguments.length,_.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(t,e){_.isNumber(t)&&(this.elements[e]=t)},this),this},identity:function(){return this.set(r.Identity),this},multiply:function(t,e,n,r,i){var a=arguments,o=a.length;if(1>=o)return _.each(this.elements,function(e,n){this.elements[n]=e*t},this),this;if(3>=o){var s,u,c;return t=t||0,e=e||0,n=n||0,i=this.elements,s=i[0]*t+i[1]*e+i[2]*n,u=i[3]*t+i[4]*e+i[5]*n,c=i[6]*t+i[7]*e+i[8]*n,{x:s,y:u,z:c}}var l=this.elements,h=a;return A0=l[0],A1=l[1],A2=l[2],A3=l[3],A4=l[4],A5=l[5],A6=l[6],A7=l[7],A8=l[8],B0=h[0],B1=h[1],B2=h[2],B3=h[3],B4=h[4],B5=h[5],B6=h[6],B7=h[7],B8=h[8],this.elements[0]=A0*B0+A1*B3+A2*B6,this.elements[1]=A0*B1+A1*B4+A2*B7,this.elements[2]=A0*B2+A1*B5+A2*B8,this.elements[3]=A3*B0+A4*B3+A5*B6,this.elements[4]=A3*B1+A4*B4+A5*B7,this.elements[5]=A3*B2+A4*B5+A5*B8,this.elements[6]=A6*B0+A7*B3+A8*B6,this.elements[7]=A6*B1+A7*B4+A8*B7,this.elements[8]=A6*B2+A7*B5+A8*B8,this},scale:function(t,e){var n=arguments.length;return 1>=n&&(e=t),this.multiply(t,0,0,0,e,0,0,0,1)},rotate:function(n){var r=t(n),i=e(n);return this.multiply(r,-i,0,i,r,0,0,0,1)},translate:function(t,e){return this.multiply(1,0,t,0,1,e,0,0,1)},skewX:function(t){var e=n(t);return this.multiply(1,e,0,0,1,0,0,0,1)},skewY:function(t){var e=n(t);return this.multiply(1,0,0,e,1,0,0,0,1)},toString:function(){return this.toArray().join(" ")},toArray:function(t){var e=this.elements,n=parseFloat(e[0].toFixed(3)),r=parseFloat(e[1].toFixed(3)),i=parseFloat(e[2].toFixed(3)),a=parseFloat(e[3].toFixed(3)),o=parseFloat(e[4].toFixed(3)),s=parseFloat(e[5].toFixed(3));if(t){var u=parseFloat(e[6].toFixed(3)),c=parseFloat(e[7].toFixed(3)),l=parseFloat(e[8].toFixed(3));return[n,a,u,r,o,c,i,s,l]}return[n,a,r,o,i,s]},clone:function(){var t=this.elements[0],e=this.elements[1],n=this.elements[2],r=this.elements[3],a=this.elements[4],o=this.elements[5];return g=this.elements[6],h=this.elements[7],i=this.elements[8],new Two.Matrix(t,e,n,r,a,o,g,h,i)}})}(),function(){function t(t){var e={},n=t.id,r=t.translation,i=t.rotation,s=t.scale,u=t.stroke,c=t.linewidth,l=t.fill,h=t.opacity,f=t.visible,d=t.cap,p=t.join,m=t.miter,v=t.curved,g=t.closed,y=t.vertices;return n&&(e.id=o.Identifier+n),r&&_.isNumber(s)&&_.isNumber(i)&&(e.transform="matrix("+(""+t._matrix)+")"),u&&(e.stroke=u),l&&(e.fill=l),h&&(e["stroke-opacity"]=e["fill-opacity"]=h),e.visibility=f?"visible":"hidden",d&&(e["stroke-linecap"]=d),p&&(e["stroke-linejoin"]=p),m&&(e["stroke-miterlimit"]=m),c&&(e["stroke-width"]=c),y&&(e.d=a.toString(y,g,v)),e}function e(t,e,n,r,i){switch(e){case"matrix":e="transform",n="matrix("+(""+n)+")";break;case"visible":e="visibility",n=n?"visible":"hidden";break;case"cap":e="stroke-linecap";break;case"join":e="stroke-linejoin";break;case"miter":e="stroke-miterlimit";break;case"linewidth":e="stroke-width";break;case"vertices":e="d",n=a.toString(n,r,i);break;case"opacity":return a.setAttributes(t,{"stroke-opacity":n,"fill-opacity":n}),void 0}t.setAttribute(e,n)}function n(){var t=this.count;return this.count++,t}var r=Two.Utils.getCurveFromPoints,i=Two.Utils.mod,a={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(t,e){var n=t.toLowerCase(),r=document.createElementNS(this.ns,n);return"svg"===n&&(e=_.defaults(e||{},{version:this.version})),_.isObject(e)&&this.setAttributes(r,e),r},setAttributes:function(t,e){return _.each(e,function(t,e){this.setAttribute(e,t)},t),this},removeAttributes:function(t,e){return _.each(e,function(t){this.removeAttribute(t)},t),this},toString:function(t,e,n){var a=t.length,o=a-1;if(!n)return _.map(t,function(t,n){var r;return r=0>=n?"M":"L",r+=" "+t.x.toFixed(3)+" "+t.y.toFixed(3),n>=o&&e&&(r+=" Z"),r}).join(" ");var s=r(t,e);return _.map(s,function(t,n){var r,u=e?i(n-1,a):Math.max(n-1,0),c=e?i(n+1,a):Math.min(n+1,o),l=s[u],h=s[c],f=l.v.x.toFixed(3),d=l.v.y.toFixed(3),p=t.u.x.toFixed(3),m=t.u.y.toFixed(3),v=t.x.toFixed(3),g=t.y.toFixed(3);return r=0>=n?"M "+v+" "+g:"C "+f+" "+d+" "+p+" "+m+" "+v+" "+g,n>=o&&e&&(f=t.v.x.toFixed(3),d=t.v.y.toFixed(3),p=h.u.x.toFixed(3),m=h.u.y.toFixed(3),v=h.x.toFixed(3),g=h.y.toFixed(3),r+=" C "+f+" "+d+" "+p+" "+m+" "+v+" "+g,r+=" Z"),r
}).join(" ")}},o=Two[Two.Types.svg]=function(){this.count=0,this.domElement=a.createElement("svg"),this.elements=[],this.domElement.style.visibility="hidden",this.unveil=_.once(_.bind(function(){this.domElement.style.visibility="visible"},this))};_.extend(o,{Identifier:"two-"}),_.extend(o.prototype,Backbone.Events,{setSize:function(t,e){return this.width=t,this.height=e,a.setAttributes(this.domElement,{width:t,height:e}),this},add:function(e){var r=(arguments.length,e),i=this.elements,o=this.domElement;return _.isArray(e)||(r=_.map(arguments,function(t){return t})),_.each(r,function(e){var r,s,u,c=e instanceof Two.Group;_.isUndefined(e.id)&&(e.id=n.call(this)),c?(s="g",_.isUndefined(e.parent)&&(e.parent=this,e.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this))),u=t(e),delete u.stroke,delete u.fill,delete u["fill-opacity"],delete u["stroke-opacity"],delete u["stroke-linecap"],delete u["stroke-linejoin"],delete u["stroke-miterlimit"],delete u["stroke-width"]):(s="path",u=t(e)),r=a.createElement(s,u),o.appendChild(r),i.push(r)},this),this},update:function(t,n,r,i,a){var o=this.elements,s=o[t];switch(n){case Two.Properties.hierarchy:_.each(r,function(t){s.appendChild(o[t])});break;case Two.Properties.demotion:_.each(r,function(t){s.removeChild(o[t])});break;default:e(s,n,r,i,a)}return this},render:function(){return this.unveil(),this}})}(),function(){function t(t){var e={},n=t.id,r=t._matrix,i=t.stroke,a=t.linewidth,o=t.fill,u=t.opacity,c=t.visible,l=t.cap,h=t.join,f=t.miter,d=t.curved,p=t.closed,m=t.vertices;return n&&(e.id=n),_.isObject(r)&&(e.matrix=r.toArray()),i&&(e.stroke=i),o&&(e.fill=o),_.isNumber(u)&&(e.opacity=u),l&&(e.cap=l),h&&(e.join=h),f&&(e.miter=f),a&&(e.linewidth=a),m&&(e.commands=s.toArray(m,d,p)),e.visible=!!c,e.curved=!!d,e.closed=!!p,e}function e(t,e,n,r,i){switch(e){case"matrix":e="matrix",n=n.toArray();break;case"vertices":e="commands",t.curved=i,t.closed=r,n=s.toArray(n,t.curved,t.closed)}t[e]=n}function n(){var t=this.count;return this.count++,t}var r=Two.Utils.getCurveFromPoints,i=Two.Utils.mod,a=function(t){_.each(t,function(t,e){this[e]=t},this),this.children={}};_.extend(a.prototype,{appendChild:function(t){var e=t.parent,n=t.id;return _.isUndefined(e)||delete e.children[n],this.children[n]=t,t.parent=this,this},removeChild:function(t){return delete this.children[t.id],this},render:function(t){var e=this.matrix;return t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),_.each(this.children,function(e){e.render(t)}),t.restore(),this}});var o=function(t){_.each(t,function(t,e){this[e]=t},this)};_.extend(o.prototype,{render:function(t){var e=this.matrix,n=this.stroke,r=this.linewidth,a=this.fill,o=this.opacity,s=this.visible,u=this.cap,c=this.join,l=this.miter,h=this.curved,f=this.closed,d=this.commands,p=d.length,m=p-1;return s?(t.save(),e&&t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),a&&(t.fillStyle=a),n&&(t.strokeStyle=n),r&&(t.lineWidth=r),l&&(t.miterLimit=l),c&&(t.lineJoin=c),u&&(t.lineCap=u),_.isNumber(o)&&(t.globalAlpha=o),t.beginPath(),_.each(d,function(e,n){var r=e.x.toFixed(3),a=e.y.toFixed(3);if(h){var o=f?i(n-1,p):Math.max(n-1,0),s=f?i(n+1,p):Math.min(n+1,m),u=d[o],c=d[s],l=u.v.x.toFixed(3),v=u.v.y.toFixed(3),g=e.u.x.toFixed(3),y=e.u.y.toFixed(3);0>=n?t.moveTo(r,a):(t.bezierCurveTo(l,v,g,y,r,a),n>=m&&f&&(l=e.v.x.toFixed(3),v=e.v.y.toFixed(3),g=c.u.x.toFixed(3),y=c.u.y.toFixed(3),r=c.x.toFixed(3),a=c.y.toFixed(3),t.bezierCurveTo(l,v,g,y,r,a)))}else 0>=n?t.moveTo(r,a):t.lineTo(r,a)}),f&&!h&&t.closePath(),t.fill(),t.stroke(),t.restore(),void 0):this}});var s={toArray:function(t,e,n){return t.length,e?r(t,n):_.map(t,function(t){return{x:t.x,y:t.y}})}},u=Two[Two.Types.canvas]=function(){this.count=0,this.domElement=document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.elements=[],this.stage=null};_.extend(u,{}),_.extend(u,{Group:a,Element:o,getStyles:t,setStyles:e,Utils:s}),_.extend(u.prototype,Backbone.Events,{setSize:function(t,e){return this.width=this.domElement.width=t,this.height=this.domElement.height=e,_.extend(this.domElement.style,{width:this.width+"px",height:this.height+"px"}),this},add:function(t){var e=Object.getPrototypeOf(this);constructor=e.constructor;var r=(arguments.length,t),i=this.elements,a=(this.domElement,constructor.Group),o=constructor.Element,s=constructor.getStyles;return _.isArray(t)||(r=_.map(arguments,function(t){return t})),_.each(r,function(t){var e,r,u=t instanceof Two.Group,c=_.isNull(this.stage);_.isUndefined(t.id)&&(t.id=n.call(this)),u?(r=s.call(this,t),delete r.stroke,delete r.fill,delete r.opacity,delete r.cap,delete r.join,delete r.miter,delete r.linewidth,e=new a(r),c&&(this.stage=e,this.stage.object=t,t.parent=this,t.unbind(Two.Events.change).bind(Two.Events.change,_.bind(this.update,this)))):e=new o(s.call(this,t)),i.push(e),c||this.stage.appendChild(e)},this),this},update:function(t,e,n,r,i,a){var o=Object.getPrototypeOf(this),s=o.constructor,u=this.elements,c=u[t];switch(e){case Two.Properties.hierarchy:_.each(n,function(t){c.appendChild(u[t])});break;case Two.Properties.demotion:_.each(n,function(t){c.removeChild(u[t]),this.elements[t]=null},this);break;default:s.setStyles.call(this,c,e,n,r,i,a)}return this},render:function(){return _.isNull(this.stage)?this:(this.ctx.clearRect(0,0,this.width,this.height),this.stage.render(this.ctx),this)}})}(),function(){function t(t){var e={},n=t.id,r=t._matrix,a=t.stroke,o=t.linewidth,c=t.fill,l=t.opacity,h=t.visible,f=t.cap,d=t.join,p=t.miter,m=t.curved,v=t.closed,g=t.vertices;return n&&(e.id=n),_.isObject(r)&&(e.matrix=e._matrix=r.toArray(!0),e.scale=e._scale=1),a&&(e.stroke=a),c&&(e.fill=c),_.isNumber(l)&&(e.opacity=l),f&&(e.cap=f),d&&(e.join=d),p&&(e.miter=p),o&&(e.linewidth=o),g&&(e.vertices=i(g,m,v),e.commands=e.vertices,e.rect=u.getBoundingClientRect(e.commands,e.linewidth,e.curved),e.triangles=u.getTriangles(e.rect)),e.visible=!!h,e.curved=!!m,e.closed=!!v,t instanceof Two.Polygon&&(u.updateBuffer(this.ctx,e,this.program),s.prototype.updateTexture.call(e,this.ctx)),e}function e(t,e,n,r,a,o){var s=!1;/matrix/.test(e)?(t[e]=n.toArray(!0),_.isNumber(r)&&(s=t.scale!==r,t.scale=r),t.updateMatrix()):/(stroke|fill|opacity|cap|join|miter|linewidth)/.test(e)?(t[e]=n,t.rect=u.getBoundingClientRect(t.commands,t.linewidth,t.curved),t.triangles=u.getTriangles(t.rect),u.updateBuffer(this.ctx,t,this.program),s=!0):"vertices"===e?(_.isUndefined(r)||(t.closed=r),_.isUndefined(a)||(t.curved=a),o?t.commands=i(n,t.curved,t.closed):(t.vertices=i(n,t.curved,t.closed),t.commands=t.vertices),t.rect=u.getBoundingClientRect(t.vertices,t.linewidth,t.curved),t.triangles=u.getTriangles(t.rect),u.updateBuffer(this.ctx,t,this.program),s=!0):t[e]=n,s&&t.updateTexture(this.ctx)}var n=Two[Two.Types.canvas],r=Two.Matrix.Multiply,i=Two[Two.Types.canvas].Utils.toArray,a=Two.Utils.mod,o=function(t){n.Group.call(this,t)};_.extend(o.prototype,n.Group.prototype,{appendChild:function(){return n.Group.prototype.appendChild.apply(this,arguments),this.updateMatrix(),this},updateTexture:function(t){return _.each(this.children,function(e){e.updateTexture(t)}),this},updateMatrix:function(t){var e=t&&t._matrix||this.parent&&this.parent._matrix,n=t&&t._scale||this.parent&&this.parent._scale;return e?(this._matrix=r(this.matrix,e),this._scale=this.scale*n,_.each(this.children,function(t){t.updateMatrix(this)},this),this):this},render:function(t,e){_.each(this.children,function(n){n.render(t,e)})}});var s=function(t){n.Element.call(this,t)};_.extend(s.prototype,n.Element.prototype,{updateMatrix:function(t){var e=t&&t._matrix||this.parent&&this.parent._matrix,n=t&&t._scale||this.parent&&this.parent._scale;return e?(this._matrix=r(this.matrix,e),this._scale=this.scale*n,this):this},updateTexture:function(t){return u.updateTexture(t,this),this},render:function(t,e){return this.visible&&this.opacity&&this.buffer?(t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordsBuffer),t.vertexAttribPointer(e.textureCoords,2,t.FLOAT,!1,0,0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniformMatrix3fv(e.matrix,!1,this._matrix),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.vertexAttribPointer(e.position,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,6),this):this}});var u={canvas:document.createElement("canvas"),uv:new Two.Array([0,0,1,0,0,1,0,1,1,0,1,1]),getBoundingClientRect:function(t,e,n){var r=1/0,i=-1/0,a=1/0,o=-1/0;_.each(t,function(t){var e,s,u,c,l=t.x,h=t.y;a=Math.min(h,a),r=Math.min(l,r),i=Math.max(l,i),o=Math.max(h,o),n&&(e=t.u.x,s=t.u.y,u=t.v.x,c=t.v.y,a=Math.min(s,c,a),r=Math.min(e,u,r),i=Math.max(e,u,i),o=Math.max(s,c,o))}),_.isNumber(e)&&(a-=e,r-=e,i+=e,o+=e);var s=i-r,u=o-a,c={x:Math.abs(r),y:Math.abs(a)};return{top:a,left:r,right:i,bottom:o,width:s,height:u,centroid:c}},getTriangles:function(t){var e=t.top,n=t.left,r=t.right,i=t.bottom;return new Two.Array([n,e,r,e,n,i,n,i,r,e,r,i])},updateCanvas:function(t){var e=t.commands,n=this.canvas,r=this.ctx,i=t._scale,o=t.stroke,s=t.linewidth*i,u=t.fill,c=t.opacity,l=t.cap,h=t.join,f=t.miter,d=t.curved,p=t.closed,m=e.length,v=m-1;n.width=Math.max(Math.ceil(t.rect.width*i),1),n.height=Math.max(Math.ceil(t.rect.height*i),1);var g=t.rect.centroid,y=g.x*i,x=g.y*i;r.clearRect(0,0,n.width,n.height),u&&(r.fillStyle=u),o&&(r.strokeStyle=o),s&&(r.lineWidth=s),f&&(r.miterLimit=f),h&&(r.lineJoin=h),l&&(r.lineCap=l),_.isNumber(c)&&(r.globalAlpha=c),r.beginPath(),_.each(e,function(t,n){var o=(t.x*i+y).toFixed(3),s=(t.y*i+x).toFixed(3);if(d){var u=p?a(n-1,m):Math.max(n-1,0),c=p?a(n+1,m):Math.min(n+1,v),l=e[u],h=e[c],f=(l.v.x*i+y).toFixed(3),g=(l.v.y*i+x).toFixed(3),_=(t.u.x*i+y).toFixed(3),b=(t.u.y*i+x).toFixed(3);0>=n?r.moveTo(o,s):(r.bezierCurveTo(f,g,_,b,o,s),n>=v&&p&&(f=(t.v.x*i+y).toFixed(3),g=(t.v.y*i+x).toFixed(3),_=(h.u.x*i+y).toFixed(3),b=(h.u.y*i+x).toFixed(3),o=(h.x*i+y).toFixed(3),s=(h.y*i+x).toFixed(3),r.bezierCurveTo(f,g,_,b,o,s)))}else 0>=n?r.moveTo(o,s):r.lineTo(o,s)}),p&&!d&&r.closePath(),r.fill(),r.stroke()},updateTexture:function(t,e){this.updateCanvas(e),e.texture&&t.deleteTexture(e.texture),t.bindBuffer(t.ARRAY_BUFFER,e.textureCoordsBuffer),e.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,e.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(t,e,n){_.isObject(e.buffer)&&t.deleteBuffer(e.buffer),e.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.enableVertexAttribArray(n.position),t.bufferData(t.ARRAY_BUFFER,e.triangles,t.STATIC_DRAW),_.isObject(e.textureCoordsBuffer)&&t.deleteBuffer(e.textureCoordsBuffer),e.textureCoordsBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e.textureCoordsBuffer),t.enableVertexAttribArray(n.textureCoords),t.bufferData(t.ARRAY_BUFFER,this.uv,t.STATIC_DRAW)},program:{create:function(t,e){var n=t.createProgram();_.each(e,function(e){t.attachShader(n,e)}),t.linkProgram(n);var r=t.getProgramParameter(n,t.LINK_STATUS);if(!r)throw error=t.getProgramInfoLog(n),t.deleteProgram(n),new Two.Utils.Error("unable to link program: "+error);return n}},shaders:{create:function(t,e,n){var r=t.createShader(t[n]);t.shaderSource(r,e),t.compileShader(r);var i=t.getShaderParameter(r,t.COMPILE_STATUS);if(!i){var a=t.getShaderInfoLog(r);throw t.deleteShader(r),new Two.Utils.Error("unable to compile shader "+r+": "+a)}return r},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};u.ctx=u.canvas.getContext("2d");var c=Two[Two.Types.webgl]=function(t){this.count=0,this.domElement=document.createElement("canvas"),this.elements=[],this.stage=null;var e=_.defaults(t||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!1}),n=this.ctx=this.domElement.getContext("webgl",e)||this.domElement.getContext("experimental-webgl",e);if(!this.ctx)throw new Two.Utils.Error("unable to create a webgl context. Try using another renderer.");var r=u.shaders.create(n,u.shaders.vertex,u.shaders.types.vertex),i=u.shaders.create(n,u.shaders.fragment,u.shaders.types.fragment);this.program=u.program.create(n,[r,i]),n.useProgram(this.program),this.program.position=n.getAttribLocation(this.program,"a_position"),this.program.matrix=n.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=n.getAttribLocation(this.program,"a_textureCoords"),n.disable(n.DEPTH_TEST),n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)};_.extend(c,{Group:o,Element:s,getStyles:t,setStyles:e}),_.extend(c.prototype,Backbone.Events,n.prototype,{setSize:function(t,e){n.prototype.setSize.apply(this,arguments),this.ctx.viewport(0,0,t,e);var r=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(r,t,e),this},render:function(){return _.isNull(this.stage)?this:(this.stage.render(this.ctx,this.program),this)}})}(),function(){var t=Two.Shape=function(e){this._matrix=new Two.Matrix;var n=_.debounce(_.bind(function(){var t=this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation);this.trigger(Two.Events.change,this.id,"matrix",t,this.scale)},this),0);return this._rotation="rotation",Object.defineProperty(this,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,n()}}),this._scale="scale",Object.defineProperty(this,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,n()}}),this.translation=new Two.Vector,this.rotation=0,this.scale=1,this.translation.bind(Two.Events.change,n),e?this:(t.MakeGetterSetter(this,t.Properties),this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="round",this.join="round",this.miter=1,void 0)};_.extend(t,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter"],MakeGetterSetter:function(t,e){_.isArray(e)||(e=[e]),_.each(e,function(e){var n="_"+e;Object.defineProperty(t,e,{get:function(){return this[n]},set:function(t){this[n]=t,this.trigger(Two.Events.change,this.id,e,t,this)}})})}}),_.extend(t.prototype,Backbone.Events,{addTo:function(t){return t.add(this),this},noFill:function(){return this.fill="rgba(0,0,0,0)",this},noStroke:function(){return this.stroke="rgba(0,0,0,0)",this},clone:function(){var e=new t;return e.translation.copy(this.translation),_.each(t.Properties,function(t){e[t]=this[t]},this),this}})}(),function(){var t=Two.Group=function(){Two.Shape.call(this,!0),delete this.stroke,delete this.fill,delete this.linewidth,delete this.opacity,delete this.cap,delete this.join,delete this.miter,t.MakeGetterSetter(this,Two.Shape.Properties),this.children={}};_.extend(t,{MakeGetterSetter:function(t,e){_.isArray(e)||(e=[e]),_.each(e,function(e){var n="_"+e;Object.defineProperty(t,e,{get:function(){return this[n]},set:function(t){this[n]=t,_.each(this.children,function(n){n[e]=t})}})})}}),_.extend(t.prototype,Two.Shape.prototype,{clone:function(e){e=e||this.parent;var n=_.map(this.children,function(t){return t.clone(e)}),r=new t;return e.add(r),r.add(n),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,r},center:function(){var t=this.getBoundingClientRect();return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},_.each(this.children,function(e){e.translation.subSelf(t.centroid)}),this.translation.copy(t.centroid),this},add:function(t){var e=(arguments.length,t),n=this.children,r=this.parent,i=[];_.isArray(t)||(e=_.toArray(arguments));var a=_.bind(function(t,e,n,r,i,a){this.trigger(Two.Events.change,t,e,n,r,i,a)},this);return _.each(e,function(t){var e=t.id,o=t.parent;_.isUndefined(e)&&(r.add(t),e=t.id),_.isUndefined(n[e])&&(o&&delete o.children[e],n[e]=t,t.parent=this,t.unbind(Two.Events.change).bind(Two.Events.change,a),i.push(e))},this),i.length>0&&this.trigger(Two.Events.change,this.id,Two.Properties.hierarchy,i),this},remove:function(t){var e=arguments.length,n=t,r=this.children,i=this.parent,a=[];return 0>=e&&i?(i.remove(this),this):(_.isArray(t)||(n=_.toArray(arguments)),_.each(n,function(t){var e=t.id;t.children,e in r&&(delete r[e],t.unbind(Two.Events.change),a.push(e))}),a.length>0&&this.trigger(Two.Events.change,this.id,Two.Properties.demotion,a),this)},getBoundingClientRect:function(){var t=1/0,e=-1/0,n=1/0,r=-1/0;_.each(this.children,function(i){var a=i.getBoundingClientRect();n&&t&&e&&r&&(n=Math.min(a.top,n),t=Math.min(a.left,t),e=Math.max(a.right,e),r=Math.max(a.bottom,r))},this);var i=this._matrix.multiply(t,n,1),a=this._matrix.multiply(e,r,1);return{top:i.y,left:i.x,right:a.x,bottom:a.y,width:a.x-i.x,height:a.y-i.y}},noFill:function(){return _.each(this.children,function(t){t.noFill()}),this},noStroke:function(){return _.each(this.children,function(t){t.noStroke()}),this}})}(),function(){var t=Math.min,e=Math.max,n=Math.round,r=Two.Polygon=function(r,i,a){Two.Shape.call(this),i=!!i,a=!!a;var o=0,s=1,u=!1,c=r.slice(0),l=_.debounce(_.bind(function(){var t,e,r,l;if(u){t=this.vertices.length,l=t-1,e=n(o*l),r=n(s*l),c.length=0;for(var h=e;r+1>h;h++){var f=this.vertices[h];c.push(new Two.Vector(f.x,f.y))}}this.trigger(Two.Events.change,this.id,"vertices",c,i,a,u),u=!1},this),0);Object.defineProperty(this,"closed",{get:function(){return i},set:function(t){i=!!t,l()}}),Object.defineProperty(this,"curved",{get:function(){return a},set:function(t){a=!!t,l()}}),Object.defineProperty(this,"beginning",{get:function(){return o},set:function(n){o=t(e(n,0),1),u=!0,l()}}),Object.defineProperty(this,"ending",{get:function(){return s},set:function(n){s=t(e(n,0),1),u=!0,l()}}),this.vertices=r.slice(0),_.each(this.vertices,function(t){t.bind(Two.Events.change,l)},this),l()};_.extend(r,{}),_.extend(r.prototype,Two.Shape.prototype,{clone:function(){var t=_.map(this.vertices,function(t){return new Two.Vector(t.x,t.y)}),e=new r(t,this.closed,this.curved);return _.each(Two.Shape.Properties,function(t){e[t]=this[t]},this),e.translation.copy(this.translation),e.rotation=this.rotation,e.scale=this.scale,e},center:function(){var t=this.getBoundingClientRect();return t.centroid={x:t.left+t.width/2,y:t.top+t.height/2},_.each(this.vertices,function(e){e.subSelf(t.centroid)}),this.translation.addSelf(t.centroid),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(){var t=this.linewidth,e=1/0,n=-1/0,r=1/0,i=-1/0;_.each(this.vertices,function(t){var a=t.x,o=t.y;r=Math.min(o,r),e=Math.min(a,e),n=Math.max(a,n),i=Math.max(o,i)}),r-=t,e-=t,n+=t,i+=t;var a=this._matrix.multiply(e,r,1),o=this._matrix.multiply(n,i,1);return{top:a.y,left:a.x,right:o.x,bottom:o.y,width:o.x-a.x,height:o.y-a.y}}})}();